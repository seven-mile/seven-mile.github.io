{"version":3,"file":"component---src-templates-blog-post-typst-js-5f04fc921a60d52120c5.js","mappings":"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","sources":["webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/options.init.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/internal.types.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/render/canvas/view.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/wasm.mjs","webpack://gatsby-starter-blog/./node_modules/idb/build/wrap-idb-value.js","webpack://gatsby-starter-blog/./node_modules/idb/build/index.js","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/init.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/dom/typst-doc.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/dom/typst-cancel.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/dom.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/renderer.mjs","webpack://gatsby-starter-blog/./node_modules/@myriaddreamin/typst.ts/dist/esm/compiler.mjs","webpack://gatsby-starter-blog/./src/components/typst-doc.tsx","webpack://gatsby-starter-blog/./src/templates/blog-post-typst.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/a-possible-prototype.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/array-buffer-basic-detection.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/array-buffer-view-core.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/correct-prototype-getter.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/define-built-in-accessor.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/function-uncurry-this-accessor.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/function-uncurry-this-clause.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/is-possible-prototype.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/object-get-prototype-of.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/object-set-prototype-of.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/to-offset.js","webpack://gatsby-starter-blog/./node_modules/core-js/internals/to-positive-integer.js","webpack://gatsby-starter-blog/./node_modules/core-js/modules/es.typed-array.set.js","webpack://gatsby-starter-blog/./node_modules/core-js/modules/es.typed-array.sort.js"],"sourcesContent":["/**\n * this mark is used to identify the beforeBuild stage\n * @description will not be used in runtime code\n */\nconst BeforeBuildSymbol = Symbol('beforeBuild');\n/** @internal */\nconst _textFonts = [\n    'LinLibertine_R.ttf',\n    'LinLibertine_RB.ttf',\n    'LinLibertine_RBI.ttf',\n    'LinLibertine_RI.ttf',\n    'NewCMMath-Book.otf',\n    'NewCMMath-Regular.otf',\n    'NewCM10-Regular.otf',\n    'NewCM10-Bold.otf',\n    'NewCM10-Italic.otf',\n    'NewCM10-BoldItalic.otf',\n    'DejaVuSansMono.ttf',\n    'DejaVuSansMono-Bold.ttf',\n    'DejaVuSansMono-Oblique.ttf',\n    'DejaVuSansMono-BoldOblique.ttf',\n];\n/** @internal */\nconst _cjkFonts = [\n    'InriaSerif-Bold.ttf',\n    'InriaSerif-BoldItalic.ttf',\n    'InriaSerif-Italic.ttf',\n    'InriaSerif-Regular.ttf',\n    'Roboto-Regular.ttf',\n    'NotoSerifCJKsc-Regular.otf',\n];\n/** @internal */\nconst _emojiFonts = ['TwitterColorEmoji.ttf', 'NotoColorEmoji.ttf'];\n/**\n * disable default font assets\n */\nexport function disableDefaultFontAssets() {\n    return preloadRemoteFonts([], { assets: false });\n}\n/**\n * preload font assets\n */\nexport function preloadFontAssets(options) {\n    return preloadRemoteFonts([], options);\n}\n/**\n * preload remote fonts\n *\n * @param fonts - url path to font files\n * @returns {BeforeBuildFn}\n * @example\n * ```typescript\n * import { init, preloadRemoteFonts } from 'typst';\n * init({\n *   beforeBuild: [\n *     preloadRemoteFonts([\n *      'https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2', // remote url\n *      'dist/fonts/Roboto-Regular.ttf', // relative to the root of the website\n *     ]),\n *   ],\n * });\n * ```\n */\nexport function preloadRemoteFonts(userFonts, options) {\n    const fonts = [...userFonts];\n    if (options &&\n        options?.assets !== false &&\n        options?.assets?.length &&\n        options?.assets?.length > 0) {\n        let assetUrlPrefix = options.assetUrlPrefix ??\n            'https://raw.githubusercontent.com/Myriad-Dreamin/typst/assets-fonts';\n        if (assetUrlPrefix[assetUrlPrefix.length - 1] !== '/') {\n            assetUrlPrefix += '/';\n        }\n        const prefix = (f) => f.map(font => assetUrlPrefix + font);\n        for (const asset of options.assets) {\n            switch (asset) {\n                case 'text':\n                    fonts.push(...prefix(_textFonts));\n                    break;\n                case 'cjk':\n                    fonts.push(...prefix(_cjkFonts));\n                    break;\n                case 'emoji':\n                    fonts.push(...prefix(_emojiFonts));\n                    break;\n            }\n        }\n    }\n    const loader = async (_, { ref, builder }) => {\n        if (options?.fetcher) {\n            ref.setFetcher(options.fetcher);\n        }\n        await ref.loadFonts(builder, fonts);\n    };\n    loader._preloadRemoteFontOptions = options;\n    return loader;\n}\n/**\n * preload system fonts\n * @param byFamily - filter system fonts to preload by family name\n * @returns {BeforeBuildFn}\n * @example\n * ```typescript\n * import { init, preloadSystemFonts } from 'typst';\n * init({\n *   beforeBuild: [\n *     preloadSystemFonts({\n *       byFamily: ['Roboto'], // preload fonts by family name\n *     }),\n *   ],\n * });\n * ```\n */\nexport function preloadSystemFonts({ byFamily }) {\n    return async (_, { builder }) => {\n        const t = performance.now();\n        if ('queryLocalFonts' in window) {\n            const fonts = await window.queryLocalFonts();\n            byFamily = byFamily ?? [];\n            for (const font of fonts) {\n                if (!byFamily.includes(font.family)) {\n                    continue;\n                }\n                const data = await (await font.blob()).arrayBuffer();\n                await builder.add_raw_font(new Uint8Array(data));\n            }\n        }\n        const t2 = performance.now();\n        console.log('preload system font time used:', t2 - t);\n    };\n}\n/**\n * (compile only) set pacoage registry\n *\n * @param accessModel: when compiling, the pacoage registry is used to access the\n * data of files\n * @returns {BeforeBuildFn}\n */\nexport function withPackageRegistry(packageRegistry) {\n    return async (_, { builder }) => {\n        return new Promise(resolve => {\n            builder.set_package_registry(packageRegistry, function (spec) {\n                return packageRegistry.resolve(spec, this);\n            });\n            resolve();\n        });\n    };\n}\n/**\n * (compile only) set access model\n *\n * @param accessModel: when compiling, the access model is used to access the\n * data of files\n * @returns {BeforeBuildFn}\n */\nexport function withAccessModel(accessModel) {\n    return async (_, ctx) => {\n        if (ctx.alreadySetAccessModel) {\n            throw new Error(`already set some assess model before: ${ctx.alreadySetAccessModel.constructor?.name}(${ctx.alreadySetAccessModel})`);\n        }\n        ctx.alreadySetAccessModel = accessModel;\n        return new Promise(resolve => {\n            ctx.builder.set_access_model(accessModel, (path) => {\n                const lastModified = accessModel.getMTime(path);\n                if (lastModified) {\n                    return lastModified.getTime();\n                }\n                return 0;\n            }, (path) => {\n                return accessModel.isFile(path) || false;\n            }, (path) => {\n                return accessModel.getRealPath(path) || path;\n            }, (path) => {\n                return accessModel.readAll(path);\n            });\n            resolve();\n        });\n    };\n}\n// todo: search browser\n// searcher.search_browser().await?;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aW9ucy5pbml0Lm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcHRpb25zLmluaXQubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBOzs7R0FHRztBQUNILE1BQU0saUJBQWlCLEdBQWtCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQWlEL0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFhO0lBQzNCLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsc0JBQXNCO0lBQ3RCLHFCQUFxQjtJQUNyQixvQkFBb0I7SUFDcEIsdUJBQXVCO0lBQ3ZCLHFCQUFxQjtJQUNyQixrQkFBa0I7SUFDbEIsb0JBQW9CO0lBQ3BCLHdCQUF3QjtJQUN4QixvQkFBb0I7SUFDcEIseUJBQXlCO0lBQ3pCLDRCQUE0QjtJQUM1QixnQ0FBZ0M7Q0FDakMsQ0FBQztBQUNGLGdCQUFnQjtBQUNoQixNQUFNLFNBQVMsR0FBYTtJQUMxQixxQkFBcUI7SUFDckIsMkJBQTJCO0lBQzNCLHVCQUF1QjtJQUN2Qix3QkFBd0I7SUFDeEIsb0JBQW9CO0lBQ3BCLDRCQUE0QjtDQUM3QixDQUFDO0FBQ0YsZ0JBQWdCO0FBQ2hCLE1BQU0sV0FBVyxHQUFhLENBQUMsdUJBQXVCLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQW1DOUU7O0dBRUc7QUFDSCxNQUFNLFVBQVUsd0JBQXdCO0lBQ3RDLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQixDQUFDLE9BQWlDO0lBQ2pFLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLFNBQWtDLEVBQ2xDLE9BQWdDO0lBRWhDLE1BQU0sS0FBSyxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQztJQUM3QixJQUNFLE9BQU87UUFDUCxPQUFPLEVBQUUsTUFBTSxLQUFLLEtBQUs7UUFDekIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNO1FBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFDM0I7UUFDQSxJQUFJLGNBQWMsR0FDaEIsT0FBTyxDQUFDLGNBQWM7WUFDdEIscUVBQXFFLENBQUM7UUFDeEUsSUFBSSxjQUFjLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUU7WUFDckQsY0FBYyxJQUFJLEdBQUcsQ0FBQztTQUN2QjtRQUNELE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3JFLEtBQUssTUFBTSxLQUFLLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtZQUNsQyxRQUFRLEtBQUssRUFBRTtnQkFDYixLQUFLLE1BQU07b0JBQ1QsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNsQyxNQUFNO2dCQUNSLEtBQUssS0FBSztvQkFDUixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7b0JBQ2pDLE1BQU07Z0JBQ1IsS0FBSyxPQUFPO29CQUNWLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztvQkFDbkMsTUFBTTthQUNUO1NBQ0Y7S0FDRjtJQUVELE1BQU0sTUFBTSxHQUFHLEtBQUssRUFBRSxDQUFrQixFQUFFLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBZSxFQUFFLEVBQUU7UUFDekUsSUFBSSxPQUFPLEVBQUUsT0FBTyxFQUFFO1lBQ3BCLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2pDO1FBQ0QsTUFBTSxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN0QyxDQUFDLENBQUM7SUFDRixNQUFNLENBQUMseUJBQXlCLEdBQUcsT0FBTyxDQUFDO0lBQzNDLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRDs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFDSCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxRQUFRLEVBQTJCO0lBQ3RFLE9BQU8sS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBZSxFQUFFLEVBQUU7UUFDM0MsTUFBTSxDQUFDLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTVCLElBQUksaUJBQWlCLElBQUksTUFBTSxFQUFFO1lBQy9CLE1BQU0sS0FBSyxHQUdMLE1BQU8sTUFBYyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBRTlDLFFBQVEsR0FBRyxRQUFRLElBQUksRUFBRSxDQUFDO1lBRTFCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO2dCQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUU7b0JBQ25DLFNBQVM7aUJBQ1Y7Z0JBRUQsTUFBTSxJQUFJLEdBQWdCLE1BQU0sQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNsRSxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNsRDtTQUNGO1FBRUQsTUFBTSxFQUFFLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxNQUFNLFVBQVUsbUJBQW1CLENBQUMsZUFBZ0M7SUFDbEUsT0FBTyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFlLEVBQUUsRUFBRTtRQUMzQyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQzNCLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxlQUFlLEVBQUUsVUFBVSxJQUFpQjtnQkFDdkUsT0FBTyxlQUFlLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3QyxDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsTUFBTSxVQUFVLGVBQWUsQ0FBQyxXQUEwQjtJQUN4RCxPQUFPLEtBQUssRUFBRSxDQUFDLEVBQUUsR0FBZ0IsRUFBRSxFQUFFO1FBQ25DLElBQUksR0FBRyxDQUFDLHFCQUFxQixFQUFFO1lBQzdCLE1BQU0sSUFBSSxLQUFLLENBQ2IseUNBQXlDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsSUFBSSxJQUFJLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxDQUNySCxDQUFDO1NBQ0g7UUFDRCxHQUFHLENBQUMscUJBQXFCLEdBQUcsV0FBVyxDQUFDO1FBQ3hDLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDM0IsR0FBRyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FDMUIsV0FBVyxFQUNYLENBQUMsSUFBWSxFQUFFLEVBQUU7Z0JBQ2YsTUFBTSxZQUFZLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxZQUFZLEVBQUU7b0JBQ2hCLE9BQU8sWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO2lCQUMvQjtnQkFDRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUMsRUFDRCxDQUFDLElBQVksRUFBRSxFQUFFO2dCQUNmLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUM7WUFDM0MsQ0FBQyxFQUNELENBQUMsSUFBWSxFQUFFLEVBQUU7Z0JBQ2YsT0FBTyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztZQUMvQyxDQUFDLEVBQ0QsQ0FBQyxJQUFZLEVBQUUsRUFBRTtnQkFDZixPQUFPLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkMsQ0FBQyxDQUNGLENBQUM7WUFDRixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQW1CRCx1QkFBdUI7QUFDdkIsb0NBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWlnbm9yZVxyXG5pbXBvcnQgdHlwZSAqIGFzIHR5cHN0UmVuZGVyZXIgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXInO1xyXG5pbXBvcnQgdHlwZSAqIGFzIHR5cHN0Q29tcGlsZXIgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtd2ViLWNvbXBpbGVyJztcclxuaW1wb3J0IHR5cGUgeyBGc0FjY2Vzc01vZGVsLCBQYWNrYWdlUmVnaXN0cnksIFBhY2thZ2VTcGVjIH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xyXG5pbXBvcnQgdHlwZSB7IFdlYkFzc2VtYmx5TW9kdWxlUmVmIH0gZnJvbSAnLi93YXNtLm1qcyc7XHJcblxyXG4vKipcclxuICogc3RhZ2VkIG9wdGlvbnMgZnVuY3Rpb25cclxuICogQHRlbXBsYXRlIFMgLSBzdGFnZSBtYXJrXHJcbiAqIEB0ZW1wbGF0ZSBUIC0gY29udGV4dCB0eXBlXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBTdGFnZWRPcHRGbjxTIGV4dGVuZHMgc3ltYm9sLCBUID0gYW55PiA9IChzOiBTLCB0OiBUKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuLyoqXHJcbiAqIHRoaXMgbWFyayBpcyB1c2VkIHRvIGlkZW50aWZ5IHRoZSBiZWZvcmVCdWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gd2lsbCBub3QgYmUgdXNlZCBpbiBydW50aW1lIGNvZGVcclxuICovXHJcbmNvbnN0IEJlZm9yZUJ1aWxkU3ltYm9sOiB1bmlxdWUgc3ltYm9sID0gU3ltYm9sKCdiZWZvcmVCdWlsZCcpO1xyXG5cclxuLyoqXHJcbiAqIHRoaXMgbWFyayBpcyB1c2VkIHRvIGlkZW50aWZ5IHRoZSBiZWZvcmVCdWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gY2Fubm90IGJlIGNyZWF0ZWQgYnkgYW55IHJ1bnRpbWUgY29kZVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgQmVmb3JlQnVpbGRNYXJrID0gdHlwZW9mIEJlZm9yZUJ1aWxkU3ltYm9sO1xyXG5cclxuLyoqXHJcbiAqIGJlZm9yZSBidWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gcG9zc2libGUgY3JlYXRlZCBieTpcclxuICogICAtIHByZWxvYWRSZW1vdGVGb250c1xyXG4gKiAgIC0gcHJlbG9hZFN5c3RlbUZvbnRzXHJcbiAqICAgLSB3aXRoQWNjZXNzTW9kZWxcclxuICogICAtIHdpdGhQYWNrYWdlUmVnaXN0cnlcclxuICovXHJcbmV4cG9ydCB0eXBlIEJlZm9yZUJ1aWxkRm4gPSBTdGFnZWRPcHRGbjxCZWZvcmVCdWlsZE1hcms+O1xyXG5cclxuLyoqXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7QmVmb3JlQnVpbGRGbltdfSBiZWZvcmVCdWlsZCAtIGNhbGxiYWNrcyBiZWZvcmUgYnVpbGQgc3RhZ2VcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgSW5pdE9wdGlvbnMge1xyXG4gIC8qKlxyXG4gICAqIGNhbGxiYWNrcyBiZWZvcmUgYnVpbGQgc3RhZ2VcclxuICAgKlxyXG4gICAqIGJlZm9yZSBidWlsZCBzdGFnZSwgdGhlIHJlZ2lzdGVyZWQgZnVuY3Rpb25zIHdpbGwgYmUgZXhlY3V0ZWQgaW4gb3JkZXJcclxuICAgKiBwb3NzaWJsZSBvcHRpb25zOlxyXG4gICAqIC0gcHJlbG9hZFJlbW90ZUZvbnRzXHJcbiAgICogLSBwcmVsb2FkU3lzdGVtRm9udHNcclxuICAgKiAtIHdpdGhBY2Nlc3NNb2RlbFxyXG4gICAqL1xyXG4gIGJlZm9yZUJ1aWxkOiBCZWZvcmVCdWlsZEZuW107XHJcblxyXG4gIC8qKlxyXG4gICAqIGNhbGxiYWNrcyB0byBmZXRjaCB0aGUgd2FzbSBtb2R1bGUgd3JhcHBlclxyXG4gICAqL1xyXG4gIGdldFdyYXBwZXI/KCk6IFByb21pc2U8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICogY2FsbGJhY2tzIHRvIGZldGNoIHRoZSB3YXNtIG1vZHVsZVxyXG4gICAqXHJcbiAgICogVGhlcmUgYXJlIG1hbnkgd2F5cyB0byBwcm92aWRlIGEgd2FzbSBtb2R1bGUsIHNlZVxyXG4gICAqIHtAbGluayBXZWJBc3NlbWJseU1vZHVsZVJlZn0gZm9yIG1vcmUgZGV0YWlscy4gSWYgeW91IGRvbid0IHByb3ZpZGUgYSB3YXNtXHJcbiAgICogbW9kdWxlLCB0aGUgZGVmYXVsdCBtb2R1bGUgd2lsbCBiZSB1c2VkLlxyXG4gICAqL1xyXG4gIGdldE1vZHVsZSgpOiBXZWJBc3NlbWJseU1vZHVsZVJlZiB8IFByb21pc2U8V2ViQXNzZW1ibHlNb2R1bGVSZWY+O1xyXG59XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmNvbnN0IF90ZXh0Rm9udHM6IHN0cmluZ1tdID0gW1xyXG4gICdMaW5MaWJlcnRpbmVfUi50dGYnLFxyXG4gICdMaW5MaWJlcnRpbmVfUkIudHRmJyxcclxuICAnTGluTGliZXJ0aW5lX1JCSS50dGYnLFxyXG4gICdMaW5MaWJlcnRpbmVfUkkudHRmJyxcclxuICAnTmV3Q01NYXRoLUJvb2sub3RmJyxcclxuICAnTmV3Q01NYXRoLVJlZ3VsYXIub3RmJyxcclxuICAnTmV3Q00xMC1SZWd1bGFyLm90ZicsXHJcbiAgJ05ld0NNMTAtQm9sZC5vdGYnLFxyXG4gICdOZXdDTTEwLUl0YWxpYy5vdGYnLFxyXG4gICdOZXdDTTEwLUJvbGRJdGFsaWMub3RmJyxcclxuICAnRGVqYVZ1U2Fuc01vbm8udHRmJyxcclxuICAnRGVqYVZ1U2Fuc01vbm8tQm9sZC50dGYnLFxyXG4gICdEZWphVnVTYW5zTW9uby1PYmxpcXVlLnR0ZicsXHJcbiAgJ0RlamFWdVNhbnNNb25vLUJvbGRPYmxpcXVlLnR0ZicsXHJcbl07XHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuY29uc3QgX2Nqa0ZvbnRzOiBzdHJpbmdbXSA9IFtcclxuICAnSW5yaWFTZXJpZi1Cb2xkLnR0ZicsXHJcbiAgJ0lucmlhU2VyaWYtQm9sZEl0YWxpYy50dGYnLFxyXG4gICdJbnJpYVNlcmlmLUl0YWxpYy50dGYnLFxyXG4gICdJbnJpYVNlcmlmLVJlZ3VsYXIudHRmJyxcclxuICAnUm9ib3RvLVJlZ3VsYXIudHRmJyxcclxuICAnTm90b1NlcmlmQ0pLc2MtUmVndWxhci5vdGYnLFxyXG5dO1xyXG4vKiogQGludGVybmFsICovXHJcbmNvbnN0IF9lbW9qaUZvbnRzOiBzdHJpbmdbXSA9IFsnVHdpdHRlckNvbG9yRW1vamkudHRmJywgJ05vdG9Db2xvckVtb2ppLnR0ZiddO1xyXG5cclxudHlwZSBBdmFpbGFibGVGb250QXNzZXQgPSAndGV4dCcgfCAnY2prJyB8ICdlbW9qaSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBwcmVsb2FkIGZvbnQgYXNzZXRzIG9yIGRvbid0IHByZWxvYWQgYW55IGZvbnQgYXNzZXRzXHJcbiAgICogQGRlZmF1bHQgWyd0ZXh0J11cclxuICAgKi9cclxuICBhc3NldHM/OiBBdmFpbGFibGVGb250QXNzZXRbXSB8IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBjdXN0b21pemUgdXJsIHByZWZpeCBmb3IgZGVmYXVsdCBhc3NldHMgZnJvbSByZW1vdGVcclxuICAgKlxyXG4gICAqIFRoZSBkZWZhdWx0IGFzc2V0cyBhcmUgaG9zdGVkIG9uIGdpdGh1YiwgeW91IGNhbiBkb3dubG9hZCB0aGVtIGFuZCBob3N0XHJcbiAgICogdGhlbSBvbiB5b3VyIG93biBzZXJ2ZXIsIHdoaWNoIGlzIG1vcmUgcHJhY3RpY2FsIGZvciBwcm9kdWN0aW9uLlxyXG4gICAqXHJcbiAgICogSG9zdGVkIGF0OiBodHRwczovL2dpdGh1Yi5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvdHJlZS9hc3NldHMtZm9udHNcclxuICAgKiBMaXN0IG9mIGFzc2V0czpcclxuICAgKiBTZWUge0BsaW5rIF90ZXh0Rm9udHN9LCB7QGxpbmsgX2Nqa0ZvbnRzfSwgYW5kIHtAbGluayBfZW1vamlGb250c31cclxuICAgKlxyXG4gICAqIEBkZWZhdWx0ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvYXNzZXRzLWZvbnRzLycnXHJcbiAgICovXHJcbiAgYXNzZXRVcmxQcmVmaXg/OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIGN1c3RvbSBmZXRjaGVyXHJcbiAgICogTm90ZTogdGhlIGRlZmF1bHQgZmV0Y2hlciBmb3Igbm9kZS5qcyBkb2VzIG5vdCBjYWNoZSBhbnkgZm9udHNcclxuICAgKiBAZGVmYXVsdCBmZXRjaFxyXG4gICAqL1xyXG4gIGZldGNoZXI/OiB0eXBlb2YgZmV0Y2g7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyBleHRlbmRzIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHt9XHJcblxyXG4vKipcclxuICogZGlzYWJsZSBkZWZhdWx0IGZvbnQgYXNzZXRzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGlzYWJsZURlZmF1bHRGb250QXNzZXRzKCk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBwcmVsb2FkUmVtb3RlRm9udHMoW10sIHsgYXNzZXRzOiBmYWxzZSB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgZm9udCBhc3NldHNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkRm9udEFzc2V0cyhvcHRpb25zPzogTG9hZFJlbW90ZUFzc2V0c09wdGlvbnMpOiBCZWZvcmVCdWlsZEZuIHtcclxuICByZXR1cm4gcHJlbG9hZFJlbW90ZUZvbnRzKFtdLCBvcHRpb25zKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgcmVtb3RlIGZvbnRzXHJcbiAqXHJcbiAqIEBwYXJhbSBmb250cyAtIHVybCBwYXRoIHRvIGZvbnQgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgaW5pdCwgcHJlbG9hZFJlbW90ZUZvbnRzIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBpbml0KHtcclxuICogICBiZWZvcmVCdWlsZDogW1xyXG4gKiAgICAgcHJlbG9hZFJlbW90ZUZvbnRzKFtcclxuICogICAgICAnaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbS9zL3JvYm90by92MjcvS0ZPbUNucUV1OTJGcjFNdTRteEtLVFUxS2cud29mZjInLCAvLyByZW1vdGUgdXJsXHJcbiAqICAgICAgJ2Rpc3QvZm9udHMvUm9ib3RvLVJlZ3VsYXIudHRmJywgLy8gcmVsYXRpdmUgdG8gdGhlIHJvb3Qgb2YgdGhlIHdlYnNpdGVcclxuICogICAgIF0pLFxyXG4gKiAgIF0sXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkUmVtb3RlRm9udHMoXHJcbiAgdXNlckZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSxcclxuICBvcHRpb25zPzogTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyxcclxuKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgY29uc3QgZm9udHMgPSBbLi4udXNlckZvbnRzXTtcclxuICBpZiAoXHJcbiAgICBvcHRpb25zICYmXHJcbiAgICBvcHRpb25zPy5hc3NldHMgIT09IGZhbHNlICYmXHJcbiAgICBvcHRpb25zPy5hc3NldHM/Lmxlbmd0aCAmJlxyXG4gICAgb3B0aW9ucz8uYXNzZXRzPy5sZW5ndGggPiAwXHJcbiAgKSB7XHJcbiAgICBsZXQgYXNzZXRVcmxQcmVmaXggPVxyXG4gICAgICBvcHRpb25zLmFzc2V0VXJsUHJlZml4ID8/XHJcbiAgICAgICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvYXNzZXRzLWZvbnRzJztcclxuICAgIGlmIChhc3NldFVybFByZWZpeFthc3NldFVybFByZWZpeC5sZW5ndGggLSAxXSAhPT0gJy8nKSB7XHJcbiAgICAgIGFzc2V0VXJsUHJlZml4ICs9ICcvJztcclxuICAgIH1cclxuICAgIGNvbnN0IHByZWZpeCA9IChmOiBzdHJpbmdbXSkgPT4gZi5tYXAoZm9udCA9PiBhc3NldFVybFByZWZpeCArIGZvbnQpO1xyXG4gICAgZm9yIChjb25zdCBhc3NldCBvZiBvcHRpb25zLmFzc2V0cykge1xyXG4gICAgICBzd2l0Y2ggKGFzc2V0KSB7XHJcbiAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChfdGV4dEZvbnRzKSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdjamsnOlxyXG4gICAgICAgICAgZm9udHMucHVzaCguLi5wcmVmaXgoX2Nqa0ZvbnRzKSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdlbW9qaSc6XHJcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChfZW1vamlGb250cykpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IGxvYWRlciA9IGFzeW5jIChfOiBCZWZvcmVCdWlsZE1hcmssIHsgcmVmLCBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucz8uZmV0Y2hlcikge1xyXG4gICAgICByZWYuc2V0RmV0Y2hlcihvcHRpb25zLmZldGNoZXIpO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgcmVmLmxvYWRGb250cyhidWlsZGVyLCBmb250cyk7XHJcbiAgfTtcclxuICBsb2FkZXIuX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgcmV0dXJuIGxvYWRlcjtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgc3lzdGVtIGZvbnRzXHJcbiAqIEBwYXJhbSBieUZhbWlseSAtIGZpbHRlciBzeXN0ZW0gZm9udHMgdG8gcHJlbG9hZCBieSBmYW1pbHkgbmFtZVxyXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBpbXBvcnQgeyBpbml0LCBwcmVsb2FkU3lzdGVtRm9udHMgfSBmcm9tICd0eXBzdCc7XHJcbiAqIGluaXQoe1xyXG4gKiAgIGJlZm9yZUJ1aWxkOiBbXHJcbiAqICAgICBwcmVsb2FkU3lzdGVtRm9udHMoe1xyXG4gKiAgICAgICBieUZhbWlseTogWydSb2JvdG8nXSwgLy8gcHJlbG9hZCBmb250cyBieSBmYW1pbHkgbmFtZVxyXG4gKiAgICAgfSksXHJcbiAqICAgXSxcclxuICogfSk7XHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByZWxvYWRTeXN0ZW1Gb250cyh7IGJ5RmFtaWx5IH06IHsgYnlGYW1pbHk/OiBzdHJpbmdbXSB9KTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCB7IGJ1aWxkZXIgfTogSW5pdENvbnRleHQpID0+IHtcclxuICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICBpZiAoJ3F1ZXJ5TG9jYWxGb250cycgaW4gd2luZG93KSB7XHJcbiAgICAgIGNvbnN0IGZvbnRzOiB7XHJcbiAgICAgICAgZmFtaWx5OiBzdHJpbmc7XHJcbiAgICAgICAgYmxvYigpOiBQcm9taXNlPEJsb2I+O1xyXG4gICAgICB9W10gPSBhd2FpdCAod2luZG93IGFzIGFueSkucXVlcnlMb2NhbEZvbnRzKCk7XHJcblxyXG4gICAgICBieUZhbWlseSA9IGJ5RmFtaWx5ID8/IFtdO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBmb250IG9mIGZvbnRzKSB7XHJcbiAgICAgICAgaWYgKCFieUZhbWlseS5pbmNsdWRlcyhmb250LmZhbWlseSkpIHtcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0YTogQXJyYXlCdWZmZXIgPSBhd2FpdCAoYXdhaXQgZm9udC5ibG9iKCkpLmFycmF5QnVmZmVyKCk7XHJcbiAgICAgICAgYXdhaXQgYnVpbGRlci5hZGRfcmF3X2ZvbnQobmV3IFVpbnQ4QXJyYXkoZGF0YSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGNvbnNvbGUubG9nKCdwcmVsb2FkIHN5c3RlbSBmb250IHRpbWUgdXNlZDonLCB0MiAtIHQpO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAoY29tcGlsZSBvbmx5KSBzZXQgcGFjb2FnZSByZWdpc3RyeVxyXG4gKlxyXG4gKiBAcGFyYW0gYWNjZXNzTW9kZWw6IHdoZW4gY29tcGlsaW5nLCB0aGUgcGFjb2FnZSByZWdpc3RyeSBpcyB1c2VkIHRvIGFjY2VzcyB0aGVcclxuICogZGF0YSBvZiBmaWxlc1xyXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoUGFja2FnZVJlZ2lzdHJ5KHBhY2thZ2VSZWdpc3RyeTogUGFja2FnZVJlZ2lzdHJ5KTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCB7IGJ1aWxkZXIgfTogSW5pdENvbnRleHQpID0+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgYnVpbGRlci5zZXRfcGFja2FnZV9yZWdpc3RyeShwYWNrYWdlUmVnaXN0cnksIGZ1bmN0aW9uIChzcGVjOiBQYWNrYWdlU3BlYykge1xyXG4gICAgICAgIHJldHVybiBwYWNrYWdlUmVnaXN0cnkucmVzb2x2ZShzcGVjLCB0aGlzKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJlc29sdmUoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAoY29tcGlsZSBvbmx5KSBzZXQgYWNjZXNzIG1vZGVsXHJcbiAqXHJcbiAqIEBwYXJhbSBhY2Nlc3NNb2RlbDogd2hlbiBjb21waWxpbmcsIHRoZSBhY2Nlc3MgbW9kZWwgaXMgdXNlZCB0byBhY2Nlc3MgdGhlXHJcbiAqIGRhdGEgb2YgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFjY2Vzc01vZGVsKGFjY2Vzc01vZGVsOiBGc0FjY2Vzc01vZGVsKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCBjdHg6IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBpZiAoY3R4LmFscmVhZHlTZXRBY2Nlc3NNb2RlbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgYGFscmVhZHkgc2V0IHNvbWUgYXNzZXNzIG1vZGVsIGJlZm9yZTogJHtjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsLmNvbnN0cnVjdG9yPy5uYW1lfSgke2N0eC5hbHJlYWR5U2V0QWNjZXNzTW9kZWx9KWAsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsID0gYWNjZXNzTW9kZWw7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIGN0eC5idWlsZGVyLnNldF9hY2Nlc3NfbW9kZWwoXHJcbiAgICAgICAgYWNjZXNzTW9kZWwsXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbGFzdE1vZGlmaWVkID0gYWNjZXNzTW9kZWwuZ2V0TVRpbWUocGF0aCk7XHJcbiAgICAgICAgICBpZiAobGFzdE1vZGlmaWVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsYXN0TW9kaWZpZWQuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwuaXNGaWxlKHBhdGgpIHx8IGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc01vZGVsLmdldFJlYWxQYXRoKHBhdGgpIHx8IHBhdGg7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwucmVhZEFsbChwYXRoKTtcclxuICAgICAgICB9LFxyXG4gICAgICApO1xyXG4gICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogQGludGVybmFsIGJ1aWxkZXJcclxuICovXHJcbnR5cGUgQnVpbGRlciA9IHR5cHN0UmVuZGVyZXIuVHlwc3RSZW5kZXJlckJ1aWxkZXIgJiB0eXBzdENvbXBpbGVyLlR5cHN0Q29tcGlsZXJCdWlsZGVyO1xyXG5cclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBidWlsZCBjb250ZXh0XHJcbiAqL1xyXG5pbnRlcmZhY2UgSW5pdENvbnRleHQge1xyXG4gIHJlZjoge1xyXG4gICAgc2V0RmV0Y2hlcihmZXRjaGVyOiB0eXBlb2YgZmV0Y2gpOiB2b2lkO1xyXG4gICAgbG9hZEZvbnRzKGJ1aWxkZXI6IEJ1aWxkZXIsIGZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSk6IFByb21pc2U8dm9pZD47XHJcbiAgfTtcclxuICBidWlsZGVyOiBCdWlsZGVyO1xyXG4gIGFscmVhZHlTZXRBY2Nlc3NNb2RlbDogYW55O1xyXG59XHJcblxyXG4vLyB0b2RvOiBzZWFyY2ggYnJvd3NlclxyXG4vLyBzZWFyY2hlci5zZWFyY2hfYnJvd3NlcigpLmF3YWl0PztcclxuIl19","export const kObject = Symbol.for('reflexo-obj');\n/**\n * The page information of a Typst document.\n * @property {number} pageOffset - The offset of the page.\n * @property {number} width - The width of the page in pt.\n * @property {number} height - The height of the page in pt.\n */\nexport class PageInfo {\n    pageOffset;\n    width;\n    height;\n}\nexport var TypstDefaultParams;\n(function (TypstDefaultParams) {\n    TypstDefaultParams[TypstDefaultParams[\"PIXEL_PER_PT\"] = 3] = \"PIXEL_PER_PT\";\n})(TypstDefaultParams = TypstDefaultParams || (TypstDefaultParams = {}));\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW50ZXJuYWwudHlwZXMubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2ludGVybmFsLnR5cGVzLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUVqRDs7Ozs7R0FLRztBQUNILE1BQU0sT0FBTyxRQUFRO0lBQ25CLFVBQVUsQ0FBUztJQUNuQixLQUFLLENBQVM7SUFDZCxNQUFNLENBQVM7Q0FDaEI7QUE0REQsTUFBTSxDQUFOLElBQWtCLGtCQUVqQjtBQUZELFdBQWtCLGtCQUFrQjtJQUNsQywyRUFBZ0IsQ0FBQTtBQUNsQixDQUFDLEVBRmlCLGtCQUFrQixHQUFsQixrQkFBa0IsS0FBbEIsa0JBQWtCLFFBRW5DIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGtPYmplY3QgPSBTeW1ib2wuZm9yKCdyZWZsZXhvLW9iaicpO1xyXG5cclxuLyoqXHJcbiAqIFRoZSBwYWdlIGluZm9ybWF0aW9uIG9mIGEgVHlwc3QgZG9jdW1lbnQuXHJcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwYWdlT2Zmc2V0IC0gVGhlIG9mZnNldCBvZiB0aGUgcGFnZS5cclxuICogQHByb3BlcnR5IHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBwYWdlIGluIHB0LlxyXG4gKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcGFnZSBpbiBwdC5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBQYWdlSW5mbyB7XHJcbiAgcGFnZU9mZnNldDogbnVtYmVyO1xyXG4gIHdpZHRoOiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRnNBY2Nlc3NNb2RlbCB7XHJcbiAgZ2V0TVRpbWUocGF0aDogc3RyaW5nKTogRGF0ZSB8IHVuZGVmaW5lZDtcclxuICBpc0ZpbGUocGF0aDogc3RyaW5nKTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcclxuICBnZXRSZWFsUGF0aChwYXRoOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgcmVhZEFsbChwYXRoOiBzdHJpbmcpOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBhY2thZ2VTcGVjIHtcclxuICBuYW1lc3BhY2U6IHN0cmluZztcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgdmVyc2lvbjogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBhY2thZ2VSZXNvbHZlQ29udGV4dCB7XHJcbiAgdW50YXIoZGF0YTogVWludDhBcnJheSwgY2I6IChwYXRoOiBzdHJpbmcsIGRhdGE6IFVpbnQ4QXJyYXksIG10aW1lOiBudW1iZXIpID0+IHZvaWQpOiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBhY2thZ2VSZWdpc3RyeSB7XHJcbiAgcmVzb2x2ZShwYXRoOiBQYWNrYWdlU3BlYywgY29udGV4dDogUGFja2FnZVJlc29sdmVDb250ZXh0KTogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBvaW50IHtcclxuICB4OiBudW1iZXI7XHJcbiAgeTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFJlY3Qge1xyXG4gIGxvOiBQb2ludDtcclxuICBoaTogUG9pbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFRyYW5zZm9ybU1hdHJpeCA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcclxuXHJcbi8vI3JlZ2lvbiBTZW1hbnRpYyB0b2tlbnM6IGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy84NjQxNVxyXG5leHBvcnQgaW50ZXJmYWNlIFNlbWFudGljVG9rZW5zTGVnZW5kIHtcclxuICByZWFkb25seSB0b2tlblR5cGVzOiBzdHJpbmdbXTtcclxuICByZWFkb25seSB0b2tlbk1vZGlmaWVyczogc3RyaW5nW107XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VtYW50aWNUb2tlbnMge1xyXG4gIC8qKlxyXG4gICAqIFRoZSByZXN1bHQgaWQgb2YgdGhlIHRva2Vucy5cclxuICAgKlxyXG4gICAqIFRoaXMgaXMgdGhlIGlkIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gYERvY3VtZW50U2VtYW50aWNUb2tlbnNQcm92aWRlci5wcm92aWRlRG9jdW1lbnRTZW1hbnRpY1Rva2Vuc0VkaXRzYCAoaWYgaW1wbGVtZW50ZWQpLlxyXG4gICAqL1xyXG4gIHJlYWRvbmx5IHJlc3VsdElkPzogc3RyaW5nO1xyXG4gIHJlYWRvbmx5IGRhdGE6IFVpbnQzMkFycmF5O1xyXG59XHJcbi8vI2VuZHJlZ2lvblxyXG5cclxuLyoqXHJcbiAqIFRoZSByZXN1bHQgb2YgcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gYSBjYW52YXMuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlckNhbnZhc1Jlc3VsdCB7XHJcbiAgY2FjaGVLZXk6IHN0cmluZztcclxuICBodG1sU2VtYW50aWNzOiBzdHJpbmdbXTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGVudW0gVHlwc3REZWZhdWx0UGFyYW1zIHtcclxuICBQSVhFTF9QRVJfUFQgPSAzLFxyXG59XHJcbiJdfQ==","import { TypstDefaultParams } from '../../internal.types.mjs';\n/** @internal */\nexport class RenderView {\n    pageInfos;\n    loadPageCount;\n    imageScaleFactor;\n    container;\n    canvasList;\n    textLayerList;\n    commonList;\n    textLayerParentList;\n    semanticLayerList;\n    constructor(pageInfos, container, options) {\n        this.pageInfos = pageInfos;\n        this.imageScaleFactor = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;\n        container.innerHTML = '';\n        container.style.width = '100%';\n        // canvas[data-typst-session='{}']\n        /// refer html elements\n        this.container = container;\n        this.canvasList = new Array(this.loadPageCount);\n        this.textLayerList = new Array(this.loadPageCount);\n        this.commonList = new Array(this.loadPageCount);\n        this.textLayerParentList = new Array(this.loadPageCount);\n        this.semanticLayerList = new Array(this.loadPageCount);\n        const createOver = (i, pageAst, commonDiv) => {\n            const width = Math.ceil(pageAst.width) * this.imageScaleFactor;\n            const height = Math.ceil(pageAst.height) * this.imageScaleFactor;\n            const canvas = (this.canvasList[i] = document.createElement('canvas'));\n            const semanticLayer = (this.semanticLayerList[i] = document.createElement('div'));\n            const textLayer = (this.textLayerList[i] = document.createElement('div'));\n            const textLayerParent = (this.textLayerParentList[i] = document.createElement('div'));\n            const ctx = canvas.getContext('2d');\n            if (ctx) {\n                const canvasDiv = document.createElement('div');\n                canvas.width = width;\n                canvas.height = height;\n                canvasDiv.appendChild(canvas);\n                // canvasDiv.style.zIndex = '-1';\n                // canvas.style.zIndex = '-1';\n                commonDiv.appendChild(canvasDiv);\n                canvasDiv.style.position = 'absolute';\n            }\n            {\n                textLayerParent.appendChild(textLayer);\n                textLayerParent.className = 'typst-html-semantics';\n                /// on width change\n                const containerWidth = container.offsetWidth;\n                const originalScale = containerWidth / pageAst.width;\n                textLayerParent.style.width = `${containerWidth}px`;\n                textLayerParent.style.height = `${pageAst.height * originalScale}px`;\n                // --data-text-width\n                textLayerParent.style.setProperty('--data-text-width', `${originalScale}px`);\n                textLayerParent.style.setProperty('--data-text-height', `${originalScale}px`);\n                // textLayerParent.style.position = 'absolute';\n                commonDiv.classList.add('typst-page');\n                commonDiv.classList.add('canvas');\n                commonDiv.style.width = `${containerWidth}px`;\n                commonDiv.style.height = `${height * originalScale}px`;\n                commonDiv.style.position = 'relative';\n                // textLayerParent.style.zIndex = '1';\n                semanticLayer.appendChild(textLayerParent);\n                commonDiv.appendChild(semanticLayer);\n            }\n        };\n        for (let i = 0; i < this.pageInfos.length; i++) {\n            const pageAst = this.pageInfos[i];\n            // const commonDiv = document.createElement('div');\n            let commonDiv = undefined;\n            commonDiv = this.commonList[i] = document.createElement('div');\n            container.appendChild(commonDiv);\n            createOver(i, pageAst, commonDiv);\n        }\n    }\n    resetLayout() {\n        /// resize again to avoid bad width change after render\n        for (let i = 0; i < this.pageInfos.length; i++) {\n            const pageAst = this.pageInfos[i];\n            const width = Math.ceil(pageAst.width) * this.imageScaleFactor;\n            const height = Math.ceil(pageAst.height) * this.imageScaleFactor;\n            const canvasDiv = this.canvasList[i].parentElement;\n            if (!canvasDiv) {\n                throw new Error(`canvasDiv is null for page ${i}, canvas list length ${this.canvasList.length}`);\n            }\n            const commonDiv = this.commonList[i];\n            const textLayerParent = this.textLayerParentList[i];\n            /// on width change\n            const containerWidth = this.container.offsetWidth;\n            const originalScale = containerWidth / width;\n            textLayerParent.style.width = `${containerWidth}px`;\n            textLayerParent.style.height = `${height * originalScale}px`;\n            commonDiv.style.width = `${containerWidth}px`;\n            commonDiv.style.height = `${height * originalScale}px`;\n            // compute scaling factor according to the paper size\n            const currentScale = this.container.offsetWidth / width;\n            canvasDiv.style.transformOrigin = '0px 0px';\n            canvasDiv.style.transform = `scale(${currentScale})`;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcmVuZGVyL2NhbnZhcy92aWV3Lm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUl4RSxnQkFBZ0I7QUFDaEIsTUFBTSxPQUFPLFVBQVU7SUFZWjtJQVhULGFBQWEsQ0FBUztJQUN0QixnQkFBZ0IsQ0FBUztJQUV6QixTQUFTLENBQWM7SUFDdkIsVUFBVSxDQUFzQjtJQUNoQyxhQUFhLENBQW1CO0lBQ2hDLFVBQVUsQ0FBbUI7SUFDN0IsbUJBQW1CLENBQW1CO0lBQ3RDLGlCQUFpQixDQUFtQjtJQUVwQyxZQUNTLFNBQXFCLEVBQzVCLFNBQXNCLEVBQ3RCLE9BQThCO1FBRnZCLGNBQVMsR0FBVCxTQUFTLENBQVk7UUFJNUIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksa0JBQWtCLENBQUMsWUFBWSxDQUFDO1FBRTlFLFNBQVMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztRQUUvQixrQ0FBa0M7UUFFbEMsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDekQsSUFB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cmFtcyB9IGZyb20gJy4uLy4uL2ludGVybmFsLnR5cGVzLm1qcyc7XHJcbmltcG9ydCB7IFJlbmRlclRvQ2FudmFzT3B0aW9ucyB9IGZyb20gJy4uLy4uL29wdGlvbnMucmVuZGVyLm1qcyc7XHJcbmltcG9ydCB7IFBhZ2VWaWV3cG9ydCB9IGZyb20gJy4vdmlld3BvcnQubWpzJztcclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGNsYXNzIFJlbmRlclZpZXcge1xyXG4gIGxvYWRQYWdlQ291bnQ6IG51bWJlcjtcclxuICBpbWFnZVNjYWxlRmFjdG9yOiBudW1iZXI7XHJcblxyXG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXTtcclxuICB0ZXh0TGF5ZXJMaXN0OiBIVE1MRGl2RWxlbWVudFtdO1xyXG4gIGNvbW1vbkxpc3Q6IEhUTUxEaXZFbGVtZW50W107XHJcbiAgdGV4dExheWVyUGFyZW50TGlzdDogSFRNTERpdkVsZW1lbnRbXTtcclxuICBzZW1hbnRpY0xheWVyTGlzdDogSFRNTERpdkVsZW1lbnRbXTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgcGFnZUluZm9zOiBQYWdlSW5mb1tdLFxyXG4gICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcclxuICAgIG9wdGlvbnM6IFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcclxuICApIHtcclxuICAgIHRoaXMuaW1hZ2VTY2FsZUZhY3RvciA9IG9wdGlvbnMucGl4ZWxQZXJQdCA/PyBUeXBzdERlZmF1bHRQYXJhbXMuUElYRUxfUEVSX1BUO1xyXG5cclxuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcclxuICAgIGNvbnRhaW5lci5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuXHJcbiAgICAvLyBjYW52YXNbZGF0YS10eXBzdC1zZXNzaW9uPSd7fSddXHJcblxyXG4gICAgLy8vIHJlZmVyIGh0bWwgZWxlbWVudHNcclxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgdGhpcy5jYW52YXNMaXN0ID0gbmV3IEFycmF5KHRoaXMubG9hZFBhZ2VDb3VudCk7XHJcbiAgICB0aGlzLnRleHRMYXllckxpc3QgPSBuZXcgQXJyYXkodGhpcy5sb2FkUGFnZUNvdW50KTtcclxuICAgIHRoaXMuY29tbW9uTGlzdCA9IG5ldyBBcnJheSh0aGlzLmxvYWRQYWdlQ291bnQpO1xyXG4gICAgdGhpcy50ZXh0TGF5ZXJQYXJlbnRMaXN0ID0gbmV3IEFycmF5KHRoaXMubG9hZFBhZ2VDb3VudCk7XHJcbiAgICB0aGlzLnNlbWFudGljTGF5ZXJMaXN0ID0gbmV3IEFycmF5KHRoaXMubG9hZFBhZ2VDb3VudCk7XHJcblxyXG4gICAgY29uc3QgY3JlYXRlT3ZlciA9IChpOiBudW1iZXIsIHBhZ2VBc3Q6IFBhZ2VJbmZvLCBjb21tb25EaXY6IEhUTUxEaXZFbGVtZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5jZWlsKHBhZ2VBc3Qud2lkdGgpICogdGhpcy5pbWFnZVNjYWxlRmFjdG9yO1xyXG4gICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmNlaWwocGFnZUFzdC5oZWlnaHQpICogdGhpcy5pbWFnZVNjYWxlRmFjdG9yO1xyXG5cclxuICAgICAgY29uc3QgY2FudmFzID0gKHRoaXMuY2FudmFzTGlzdFtpXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpKTtcclxuICAgICAgY29uc3Qgc2VtYW50aWNMYXllciA9ICh0aGlzLnNlbWFudGljTGF5ZXJMaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xyXG4gICAgICBjb25zdCB0ZXh0TGF5ZXIgPSAodGhpcy50ZXh0TGF5ZXJMaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xyXG4gICAgICBjb25zdCB0ZXh0TGF5ZXJQYXJlbnQgPSAodGhpcy50ZXh0TGF5ZXJQYXJlbnRMaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xyXG5cclxuICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgIGlmIChjdHgpIHtcclxuICAgICAgICBjb25zdCBjYW52YXNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAgICAgY2FudmFzRGl2LmFwcGVuZENoaWxkKGNhbnZhcyk7XHJcbiAgICAgICAgLy8gY2FudmFzRGl2LnN0eWxlLnpJbmRleCA9ICctMSc7XHJcbiAgICAgICAgLy8gY2FudmFzLnN0eWxlLnpJbmRleCA9ICctMSc7XHJcbiAgICAgICAgY29tbW9uRGl2LmFwcGVuZENoaWxkKGNhbnZhc0Rpdik7XHJcbiAgICAgICAgY2FudmFzRGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgfVxyXG5cclxuICAgICAge1xyXG4gICAgICAgIHRleHRMYXllclBhcmVudC5hcHBlbmRDaGlsZCh0ZXh0TGF5ZXIpO1xyXG5cclxuICAgICAgICB0ZXh0TGF5ZXJQYXJlbnQuY2xhc3NOYW1lID0gJ3R5cHN0LWh0bWwtc2VtYW50aWNzJztcclxuXHJcbiAgICAgICAgLy8vIG9uIHdpZHRoIGNoYW5nZVxyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsU2NhbGUgPSBjb250YWluZXJXaWR0aCAvIHBhZ2VBc3Qud2lkdGg7XHJcbiAgICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLndpZHRoID0gYCR7Y29udGFpbmVyV2lkdGh9cHhgO1xyXG4gICAgICAgIHRleHRMYXllclBhcmVudC5zdHlsZS5oZWlnaHQgPSBgJHtwYWdlQXN0LmhlaWdodCAqIG9yaWdpbmFsU2NhbGV9cHhgO1xyXG4gICAgICAgIC8vIC0tZGF0YS10ZXh0LXdpZHRoXHJcbiAgICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLnNldFByb3BlcnR5KCctLWRhdGEtdGV4dC13aWR0aCcsIGAke29yaWdpbmFsU2NhbGV9cHhgKTtcclxuICAgICAgICB0ZXh0TGF5ZXJQYXJlbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tZGF0YS10ZXh0LWhlaWdodCcsIGAke29yaWdpbmFsU2NhbGV9cHhgKTtcclxuICAgICAgICAvLyB0ZXh0TGF5ZXJQYXJlbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgIGNvbW1vbkRpdi5jbGFzc0xpc3QuYWRkKCd0eXBzdC1wYWdlJyk7XHJcbiAgICAgICAgY29tbW9uRGl2LmNsYXNzTGlzdC5hZGQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGNvbW1vbkRpdi5zdHlsZS53aWR0aCA9IGAke2NvbnRhaW5lcldpZHRofXB4YDtcclxuICAgICAgICBjb21tb25EaXYuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0ICogb3JpZ2luYWxTY2FsZX1weGA7XHJcbiAgICAgICAgY29tbW9uRGl2LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuXHJcbiAgICAgICAgLy8gdGV4dExheWVyUGFyZW50LnN0eWxlLnpJbmRleCA9ICcxJztcclxuICAgICAgICBzZW1hbnRpY0xheWVyLmFwcGVuZENoaWxkKHRleHRMYXllclBhcmVudCk7XHJcbiAgICAgICAgY29tbW9uRGl2LmFwcGVuZENoaWxkKHNlbWFudGljTGF5ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYWdlSW5mb3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgcGFnZUFzdCA9IHRoaXMucGFnZUluZm9zW2ldO1xyXG5cclxuICAgICAgLy8gY29uc3QgY29tbW9uRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIGxldCBjb21tb25EaXY6IEhUTUxEaXZFbGVtZW50IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgY29tbW9uRGl2ID0gdGhpcy5jb21tb25MaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb21tb25EaXYpO1xyXG4gICAgICBjcmVhdGVPdmVyKGksIHBhZ2VBc3QsIGNvbW1vbkRpdik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXNldExheW91dCgpIHtcclxuICAgIC8vLyByZXNpemUgYWdhaW4gdG8gYXZvaWQgYmFkIHdpZHRoIGNoYW5nZSBhZnRlciByZW5kZXJcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYWdlSW5mb3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgcGFnZUFzdCA9IHRoaXMucGFnZUluZm9zW2ldO1xyXG4gICAgICBjb25zdCB3aWR0aCA9IE1hdGguY2VpbChwYWdlQXN0LndpZHRoKSAqIHRoaXMuaW1hZ2VTY2FsZUZhY3RvcjtcclxuICAgICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5jZWlsKHBhZ2VBc3QuaGVpZ2h0KSAqIHRoaXMuaW1hZ2VTY2FsZUZhY3RvcjtcclxuXHJcbiAgICAgIGNvbnN0IGNhbnZhc0RpdiA9IHRoaXMuY2FudmFzTGlzdFtpXS5wYXJlbnRFbGVtZW50O1xyXG4gICAgICBpZiAoIWNhbnZhc0Rpdikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgIGBjYW52YXNEaXYgaXMgbnVsbCBmb3IgcGFnZSAke2l9LCBjYW52YXMgbGlzdCBsZW5ndGggJHt0aGlzLmNhbnZhc0xpc3QubGVuZ3RofWAsXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBjb21tb25EaXYgPSB0aGlzLmNvbW1vbkxpc3RbaV07XHJcbiAgICAgIGNvbnN0IHRleHRMYXllclBhcmVudCA9IHRoaXMudGV4dExheWVyUGFyZW50TGlzdFtpXTtcclxuXHJcbiAgICAgIC8vLyBvbiB3aWR0aCBjaGFuZ2VcclxuICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aDtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxTY2FsZSA9IGNvbnRhaW5lcldpZHRoIC8gd2lkdGg7XHJcbiAgICAgIHRleHRMYXllclBhcmVudC5zdHlsZS53aWR0aCA9IGAke2NvbnRhaW5lcldpZHRofXB4YDtcclxuICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLmhlaWdodCA9IGAke2hlaWdodCAqIG9yaWdpbmFsU2NhbGV9cHhgO1xyXG4gICAgICBjb21tb25EaXYuc3R5bGUud2lkdGggPSBgJHtjb250YWluZXJXaWR0aH1weGA7XHJcbiAgICAgIGNvbW1vbkRpdi5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHQgKiBvcmlnaW5hbFNjYWxlfXB4YDtcclxuXHJcbiAgICAgIC8vIGNvbXB1dGUgc2NhbGluZyBmYWN0b3IgYWNjb3JkaW5nIHRvIHRoZSBwYXBlciBzaXplXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRTY2FsZSA9IHRoaXMuY29udGFpbmVyLm9mZnNldFdpZHRoIC8gd2lkdGg7XHJcbiAgICAgIGNhbnZhc0Rpdi5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnMHB4IDBweCc7XHJcbiAgICAgIGNhbnZhc0Rpdi5zdHlsZS50cmFuc2Zvcm0gPSBgc2NhbGUoJHtjdXJyZW50U2NhbGV9KWA7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==","/**\n * @internal\n */\nconst once = (fn) => {\n    let called = false;\n    let res;\n    return () => {\n        if (called) {\n            return res;\n        }\n        called = true;\n        return (res = fn());\n    };\n};\n/** @internal */\nexport class LazyWasmModule {\n    wasmBin;\n    initOnce;\n    constructor(initFn) {\n        if (typeof initFn !== 'function') {\n            throw new Error('initFn is not a function');\n        }\n        this.initOnce = once(async () => {\n            await initFn(this.wasmBin);\n        });\n    }\n    async init(module) {\n        this.wasmBin = module;\n        await this.initOnce();\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FzbS5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvd2FzbS5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBV0E7O0dBRUc7QUFDSCxNQUFNLElBQUksR0FBRyxDQUFnQixFQUFXLEVBQUUsRUFBRTtJQUMxQyxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDbkIsSUFBSSxHQUFNLENBQUM7SUFDWCxPQUFPLEdBQUcsRUFBRTtRQUNWLElBQUksTUFBTSxFQUFFO1lBQ1YsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUNELE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDZCxPQUFPLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBS0YsZ0JBQWdCO0FBQ2hCLE1BQU0sT0FBTyxjQUFjO0lBQ2pCLE9BQU8sQ0FBc0I7SUFDN0IsUUFBUSxDQUFzQjtJQUV0QyxZQUFZLE1BQXdEO1FBQ2xFLElBQUksT0FBTyxNQUFNLEtBQUssVUFBVSxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztTQUM3QztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQzlCLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQTZEO1FBQ3RFLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLE1BQU0sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3hCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUaGUgcmVmZXJlbmNlIG9mIGEgV2ViQXNzZW1ibHkgbW9kdWxlIHdoaWNoIGlzIGNvcGllZCBmcm9tIHRoZSB3YXNtLWJpbmRnZW5cclxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcnVzdHdhc20vd2FzbS1iaW5kZ2VuL2Jsb2IvMmM2MjI3MTVjOWU2NjAyZjdiYjM3NzgyOGM3MmY3OTUzYjE3OGVkNy9jcmF0ZXMvY2xpLXN1cHBvcnQvc3JjL2pzL21vZC5ycyNMNjU2XHJcbiAqXHJcbiAqIFlvdXIgbW9zdCBjb21tb24gdXNlIGNhc2Ugd2lsbCBiZSB0byBwYXNzIGEgVVJMIHRvIGEgd2FzbSBmaWxlIGhlcmUuXHJcbiAqICsgYFdlYkFzc2VtYmx5Lk1vZHVsZWAgLSBBbiBpbnN0YW50aWF0ZWQgd2FzbSBtb2R1bGUuXHJcbiAqICsgYFVSTGAgLSBSZW1vdGUgdXJsIHRvIGEgd2FzbSBmaWxlXHJcbiAqICsgYEJ1ZmZlclNvdXJjZWAgLSBBbiBBcnJheUJ1ZmZlclZpZXcgb3IgYW4gQXJyYXlCdWZmZXJcclxuICovXHJcbmV4cG9ydCB0eXBlIFdlYkFzc2VtYmx5TW9kdWxlUmVmID0gUmVxdWVzdEluZm8gfCBVUkwgfCBSZXNwb25zZSB8IEJ1ZmZlclNvdXJjZSB8IFdlYkFzc2VtYmx5Lk1vZHVsZTtcclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IG9uY2UgPSA8VCBleHRlbmRzIGFueT4oZm46ICgpID0+IFQpID0+IHtcclxuICBsZXQgY2FsbGVkID0gZmFsc2U7XHJcbiAgbGV0IHJlczogVDtcclxuICByZXR1cm4gKCkgPT4ge1xyXG4gICAgaWYgKGNhbGxlZCkge1xyXG4gICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG4gICAgY2FsbGVkID0gdHJ1ZTtcclxuICAgIHJldHVybiAocmVzID0gZm4oKSk7XHJcbiAgfTtcclxufTtcclxuXHJcbi8qKiBAaW50ZXJuYWwgY29waWVkIGZyb20gd2FzbS1iaW5kZ2VuICovXHJcbnR5cGUgV2FzbU1vZHVsZUluaXRQYXJhbSA9IFdlYkFzc2VtYmx5TW9kdWxlUmVmIHwgUHJvbWlzZTxXZWJBc3NlbWJseU1vZHVsZVJlZj4gfCB1bmRlZmluZWQ7XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmV4cG9ydCBjbGFzcyBMYXp5V2FzbU1vZHVsZSB7XHJcbiAgcHJpdmF0ZSB3YXNtQmluOiBXYXNtTW9kdWxlSW5pdFBhcmFtO1xyXG4gIHByaXZhdGUgaW5pdE9uY2U6ICgpID0+IFByb21pc2U8dm9pZD47XHJcblxyXG4gIGNvbnN0cnVjdG9yKGluaXRGbjogKHBhcmFtOiBXYXNtTW9kdWxlSW5pdFBhcmFtKSA9PiBQcm9taXNlPHVua25vd24+KSB7XHJcbiAgICBpZiAodHlwZW9mIGluaXRGbiAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2luaXRGbiBpcyBub3QgYSBmdW5jdGlvbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW5pdE9uY2UgPSBvbmNlKGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgaW5pdEZuKHRoaXMud2FzbUJpbik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGluaXQobW9kdWxlPzogV2ViQXNzZW1ibHlNb2R1bGVSZWYgfCBQcm9taXNlPFdlYkFzc2VtYmx5TW9kdWxlUmVmPikge1xyXG4gICAgdGhpcy53YXNtQmluID0gbW9kdWxlO1xyXG4gICAgYXdhaXQgdGhpcy5pbml0T25jZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","import * as idb from 'idb';\n/** @internal */\nexport const globalFontPromises = [];\nasync function addPartialFonts({ builder, hooks }) {\n    const t = performance.now();\n    if ('queryLocalFonts' in window) {\n        const fonts = await window.queryLocalFonts();\n        console.log('local fonts count:', fonts.length);\n        const db = await idb.openDB('typst-ts-store', 1, {\n            upgrade(db) {\n                db.createObjectStore('font-information', {\n                    keyPath: 'postscriptName',\n                });\n            },\n        });\n        const information = await Promise.all(fonts.map(async (font) => {\n            const postscriptName = font.postscriptName;\n            return (await db.get('font-information', postscriptName))?.info;\n        }));\n        const get_font_info = builder.handler_for_font_info();\n        await builder.add_web_fonts(fonts.map((font, font_idx) => {\n            let gettingBuffer = false;\n            let readyBuffer = undefined;\n            const fullName = font.fullName;\n            const postscriptName = font.postscriptName;\n            const prev = information[font_idx];\n            if (prev) {\n                console.log('prev', postscriptName, prev);\n            }\n            return {\n                family: font.family,\n                style: font.style,\n                fullName: fullName,\n                postscriptName: postscriptName,\n                ref: font,\n                info: information[font_idx],\n                blob: (idx) => {\n                    console.log(this, font, idx);\n                    if (readyBuffer) {\n                        return readyBuffer;\n                    }\n                    if (gettingBuffer) {\n                        return;\n                    }\n                    gettingBuffer = true;\n                    globalFontPromises.push((async () => {\n                        const blob = await font.blob();\n                        const buffer = await blob.arrayBuffer();\n                        readyBuffer = buffer;\n                        const realFontInfo = get_font_info(new Uint8Array(buffer));\n                        console.log(realFontInfo);\n                        db.put('font-information', {\n                            fullName,\n                            postscriptName,\n                            info: realFontInfo,\n                        });\n                        return { buffer, idx };\n                    })());\n                },\n            };\n        }));\n    }\n    const t2 = performance.now();\n    console.log('addPartialFonts time used:', t2 - t);\n}\nclass ComponentBuilder {\n    loadedFonts = new Set();\n    fetcher = fetch;\n    setFetcher(fetcher) {\n        this.fetcher = fetcher;\n    }\n    async loadFonts(builder, fonts) {\n        const escapeImport = new Function('m', 'return import(m)');\n        const fetcher = (this.fetcher ||= await (async function () {\n            const { fetchBuilder, FileSystemCache } = await escapeImport('node-fetch-cache');\n            const cache = new FileSystemCache({\n                /// By default, we don't have a complicated cache policy.\n                cacheDirectory: '.cache/typst/fonts',\n            });\n            const cachedFetcher = fetchBuilder.withCache(cache);\n            return function (input, init) {\n                const timeout = setTimeout(() => {\n                    console.warn('font fetching is stucking:', input);\n                }, 15000);\n                return cachedFetcher(input, init).finally(() => {\n                    clearTimeout(timeout);\n                });\n            };\n        })());\n        const fontsToLoad = fonts.filter(font => {\n            if (font instanceof Uint8Array) {\n                return true;\n            }\n            if (this.loadedFonts.has(font)) {\n                return false;\n            }\n            this.loadedFonts.add(font);\n            return true;\n        });\n        const fontLists = await Promise.all(fontsToLoad.map(async (font) => {\n            if (font instanceof Uint8Array) {\n                await builder.add_raw_font(font);\n                return;\n            }\n            return new Uint8Array(await (await fetcher(font)).arrayBuffer());\n        }));\n        for (const font of fontLists) {\n            if (!font) {\n                continue;\n            }\n            await builder.add_raw_font(font);\n        }\n    }\n    async build(options, builder, hooks) {\n        /// build typst component\n        const buildCtx = { ref: this, builder, hooks };\n        for (const fn of options?.beforeBuild ?? []) {\n            await fn(undefined, buildCtx);\n        }\n        // await addPartialFonts(buildCtx);\n        if (hooks.latelyBuild) {\n            hooks.latelyBuild(buildCtx);\n        }\n        const component = await builder.build();\n        return component;\n    }\n}\n/** @internal */\nexport async function buildComponent(options, gModule, Builder, hooks) {\n    /// init typst wasm module\n    await gModule.init(options?.getModule?.());\n    return await new ComponentBuilder().build(options, new Builder(), hooks);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5pdC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxLQUFLLEdBQUcsTUFBTSxLQUFLLENBQUM7QUEwQjNCLGdCQUFnQjtBQUNoQixNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBb0QsRUFBRSxDQUFDO0FBRXRGLEtBQUssVUFBVSxlQUFlLENBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFrQjtJQUNsRSxNQUFNLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7SUFFNUIsSUFBSSxpQkFBaUIsSUFBSSxNQUFNLEVBQUU7UUFDL0IsTUFBTSxLQUFLLEdBQVUsTUFBTyxNQUFjLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFaEQsTUFBTSxFQUFFLEdBQUcsTUFBTSxHQUFHLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUMsRUFBRTtZQUMvQyxPQUFPLENBQUMsRUFBRTtnQkFDUixFQUFFLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCLEVBQUU7b0JBQ3ZDLE9BQU8sRUFBRSxnQkFBZ0I7aUJBQzFCLENBQUMsQ0FBQztZQUNMLENBQUM7U0FDRixDQUFDLENBQUM7UUFFSCxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ25DLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFDLElBQUksRUFBQyxFQUFFO1lBQ3JCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7WUFFM0MsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FDSCxDQUFDO1FBRUYsTUFBTSxhQUFhLEdBQUksT0FB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QU0sSUFBSSxnQkFBZ0IsRUFBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxPQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM5RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmVmb3JlQnVpbGRNYXJrLCBJbml0T3B0aW9ucyB9IGZyb20gJy4vb3B0aW9ucy5pbml0Lm1qcyc7XHJcbmltcG9ydCB7IExhenlXYXNtTW9kdWxlIH0gZnJvbSAnLi93YXNtLm1qcyc7XHJcbmltcG9ydCAqIGFzIGlkYiBmcm9tICdpZGInO1xyXG5cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFR5cHN0Q29tbW9uQnVpbGRlcjxUPiB7XHJcbiAgZnJlZSgpOiB2b2lkO1xyXG5cclxuICBhZGRfcmF3X2ZvbnQoZm9udF9idWZmZXI6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICBhZGRfd2ViX2ZvbnRzKGZvbnQ6IGFueVtdKTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgYnVpbGQoKTogUHJvbWlzZTxUPjtcclxufVxyXG5cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudEJ1aWxkSG9va3Mge1xyXG4gIGxhdGVseUJ1aWxkPzogKGN0eDogdW5rbm93bikgPT4gdm9pZDtcclxufVxyXG5cclxuaW50ZXJmYWNlIEluaXRDb250ZXh0PFQ+IHtcclxuICByZWY6IHtcclxuICAgIGxvYWRGb250cyhidWlsZGVyOiBUeXBzdENvbW1vbkJ1aWxkZXI8VD4sIGZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSk6IFByb21pc2U8dm9pZD47XHJcbiAgfTtcclxuICBidWlsZGVyOiBUeXBzdENvbW1vbkJ1aWxkZXI8VD47XHJcbiAgaG9va3M6IENvbXBvbmVudEJ1aWxkSG9va3M7XHJcbn1cclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGNvbnN0IGdsb2JhbEZvbnRQcm9taXNlczogUHJvbWlzZTx7IGJ1ZmZlcjogQXJyYXlCdWZmZXI7IGlkeDogbnVtYmVyIH0+W10gPSBbXTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGFkZFBhcnRpYWxGb250czxUPih7IGJ1aWxkZXIsIGhvb2tzIH06IEluaXRDb250ZXh0PFQ+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3QgdCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICBpZiAoJ3F1ZXJ5TG9jYWxGb250cycgaW4gd2luZG93KSB7XHJcbiAgICBjb25zdCBmb250czogYW55W10gPSBhd2FpdCAod2luZG93IGFzIGFueSkucXVlcnlMb2NhbEZvbnRzKCk7XHJcbiAgICBjb25zb2xlLmxvZygnbG9jYWwgZm9udHMgY291bnQ6JywgZm9udHMubGVuZ3RoKTtcclxuXHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGlkYi5vcGVuREIoJ3R5cHN0LXRzLXN0b3JlJywgMSwge1xyXG4gICAgICB1cGdyYWRlKGRiKSB7XHJcbiAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoJ2ZvbnQtaW5mb3JtYXRpb24nLCB7XHJcbiAgICAgICAgICBrZXlQYXRoOiAncG9zdHNjcmlwdE5hbWUnLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgaW5mb3JtYXRpb24gPSBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgZm9udHMubWFwKGFzeW5jIGZvbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBvc3RzY3JpcHROYW1lID0gZm9udC5wb3N0c2NyaXB0TmFtZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIChhd2FpdCBkYi5nZXQoJ2ZvbnQtaW5mb3JtYXRpb24nLCBwb3N0c2NyaXB0TmFtZSkpPy5pbmZvO1xyXG4gICAgICB9KSxcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgZ2V0X2ZvbnRfaW5mbyA9IChidWlsZGVyIGFzIGFueSkuaGFuZGxlcl9mb3JfZm9udF9pbmZvKCk7XHJcblxyXG4gICAgYXdhaXQgYnVpbGRlci5hZGRfd2ViX2ZvbnRzKFxyXG4gICAgICBmb250cy5tYXAoKGZvbnQsIGZvbnRfaWR4KSA9PiB7XHJcbiAgICAgICAgbGV0IGdldHRpbmdCdWZmZXIgPSBmYWxzZTtcclxuICAgICAgICBsZXQgcmVhZHlCdWZmZXI6IEFycmF5QnVmZmVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IGZ1bGxOYW1lID0gZm9udC5mdWxsTmFtZTtcclxuICAgICAgICBjb25zdCBwb3N0c2NyaXB0TmFtZSA9IGZvbnQucG9zdHNjcmlwdE5hbWU7XHJcblxyXG4gICAgICAgIGNvbnN0IHByZXYgPSBpbmZvcm1hdGlvbltmb250X2lkeF07XHJcbiAgICAgICAgaWYgKHByZXYpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdwcmV2JywgcG9zdHNjcmlwdE5hbWUsIHByZXYpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgZmFtaWx5OiBmb250LmZhbWlseSxcclxuICAgICAgICAgIHN0eWxlOiBmb250LnN0eWxlLFxyXG4gICAgICAgICAgZnVsbE5hbWU6IGZ1bGxOYW1lLFxyXG4gICAgICAgICAgcG9zdHNjcmlwdE5hbWU6IHBvc3RzY3JpcHROYW1lLFxyXG4gICAgICAgICAgcmVmOiBmb250LFxyXG4gICAgICAgICAgaW5mbzogaW5mb3JtYXRpb25bZm9udF9pZHhdLFxyXG4gICAgICAgICAgYmxvYjogKGlkeDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMsIGZvbnQsIGlkeCk7XHJcbiAgICAgICAgICAgIGlmIChyZWFkeUJ1ZmZlcikge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZWFkeUJ1ZmZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZ2V0dGluZ0J1ZmZlcikge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXR0aW5nQnVmZmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ2xvYmFsRm9udFByb21pc2VzLnB1c2goXHJcbiAgICAgICAgICAgICAgKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2I6IEJsb2IgPSBhd2FpdCBmb250LmJsb2IoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKTtcclxuICAgICAgICAgICAgICAgIHJlYWR5QnVmZmVyID0gYnVmZmVyO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVhbEZvbnRJbmZvID0gZ2V0X2ZvbnRfaW5mbyhuZXcgVWludDhBcnJheShidWZmZXIpKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlYWxGb250SW5mbyk7XHJcblxyXG4gICAgICAgICAgICAgICAgZGIucHV0KCdmb250LWluZm9ybWF0aW9uJywge1xyXG4gICAgICAgICAgICAgICAgICBmdWxsTmFtZSxcclxuICAgICAgICAgICAgICAgICAgcG9zdHNjcmlwdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIGluZm86IHJlYWxGb250SW5mbyxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB7IGJ1ZmZlciwgaWR4IH07XHJcbiAgICAgICAgICAgICAgfSkoKSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgfSksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICBjb25zb2xlLmxvZygnYWRkUGFydGlhbEZvbnRzIHRpbWUgdXNlZDonLCB0MiAtIHQpO1xyXG59XHJcblxyXG5jbGFzcyBDb21wb25lbnRCdWlsZGVyPFQ+IHtcclxuICBsb2FkZWRGb250cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xyXG4gIGZldGNoZXI/OiB0eXBlb2YgZmV0Y2ggPSBmZXRjaDtcclxuXHJcbiAgc2V0RmV0Y2hlcihmZXRjaGVyOiB0eXBlb2YgZmV0Y2gpOiB2b2lkIHtcclxuICAgIHRoaXMuZmV0Y2hlciA9IGZldGNoZXI7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2FkRm9udHMoYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+LCBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkpW10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGVzY2FwZUltcG9ydCA9IG5ldyBGdW5jdGlvbignbScsICdyZXR1cm4gaW1wb3J0KG0pJyk7XHJcbiAgICBjb25zdCBmZXRjaGVyID0gKHRoaXMuZmV0Y2hlciB8fD0gYXdhaXQgKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgeyBmZXRjaEJ1aWxkZXIsIEZpbGVTeXN0ZW1DYWNoZSB9ID0gYXdhaXQgZXNjYXBlSW1wb3J0KCdub2RlLWZldGNoLWNhY2hlJyk7XHJcbiAgICAgIGNvbnN0IGNhY2hlID0gbmV3IEZpbGVTeXN0ZW1DYWNoZSh7XHJcbiAgICAgICAgLy8vIEJ5IGRlZmF1bHQsIHdlIGRvbid0IGhhdmUgYSBjb21wbGljYXRlZCBjYWNoZSBwb2xpY3kuXHJcbiAgICAgICAgY2FjaGVEaXJlY3Rvcnk6ICcuY2FjaGUvdHlwc3QvZm9udHMnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGNhY2hlZEZldGNoZXIgPSBmZXRjaEJ1aWxkZXIud2l0aENhY2hlKGNhY2hlKTtcclxuXHJcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQ6IFJlcXVlc3RJbmZvIHwgVVJMLCBpbml0PzogUmVxdWVzdEluaXQpIHtcclxuICAgICAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ2ZvbnQgZmV0Y2hpbmcgaXMgc3R1Y2tpbmc6JywgaW5wdXQpO1xyXG4gICAgICAgIH0sIDE1MDAwKTtcclxuICAgICAgICByZXR1cm4gY2FjaGVkRmV0Y2hlcihpbnB1dCwgaW5pdCkuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcbiAgICB9KSgpKTtcclxuXHJcbiAgICBjb25zdCBmb250c1RvTG9hZCA9IGZvbnRzLmZpbHRlcihmb250ID0+IHtcclxuICAgICAgaWYgKGZvbnQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLmxvYWRlZEZvbnRzLmhhcyhmb250KSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5sb2FkZWRGb250cy5hZGQoZm9udCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZm9udExpc3RzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgIGZvbnRzVG9Mb2FkLm1hcChhc3luYyBmb250ID0+IHtcclxuICAgICAgICBpZiAoZm9udCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcclxuICAgICAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KGZvbnQpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGF3YWl0IChhd2FpdCBmZXRjaGVyKGZvbnQpKS5hcnJheUJ1ZmZlcigpKTtcclxuICAgICAgfSksXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250TGlzdHMpIHtcclxuICAgICAgaWYgKCFmb250KSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgYXdhaXQgYnVpbGRlci5hZGRfcmF3X2ZvbnQoZm9udCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBidWlsZChcclxuICAgIG9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+IHwgdW5kZWZpbmVkLFxyXG4gICAgYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+LFxyXG4gICAgaG9va3M6IENvbXBvbmVudEJ1aWxkSG9va3MsXHJcbiAgKTogUHJvbWlzZTxUPiB7XHJcbiAgICAvLy8gYnVpbGQgdHlwc3QgY29tcG9uZW50XHJcbiAgICBjb25zdCBidWlsZEN0eDogSW5pdENvbnRleHQ8VD4gPSB7IHJlZjogdGhpcywgYnVpbGRlciwgaG9va3MgfTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGZuIG9mIG9wdGlvbnM/LmJlZm9yZUJ1aWxkID8/IFtdKSB7XHJcbiAgICAgIGF3YWl0IGZuKHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIEJlZm9yZUJ1aWxkTWFyaywgYnVpbGRDdHgpO1xyXG4gICAgfVxyXG4gICAgLy8gYXdhaXQgYWRkUGFydGlhbEZvbnRzKGJ1aWxkQ3R4KTtcclxuXHJcbiAgICBpZiAoaG9va3MubGF0ZWx5QnVpbGQpIHtcclxuICAgICAgaG9va3MubGF0ZWx5QnVpbGQoYnVpbGRDdHgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbXBvbmVudCA9IGF3YWl0IGJ1aWxkZXIuYnVpbGQoKTtcclxuXHJcbiAgICByZXR1cm4gY29tcG9uZW50O1xyXG4gIH1cclxufVxyXG5cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYnVpbGRDb21wb25lbnQ8VD4oXHJcbiAgb3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz4gfCB1bmRlZmluZWQsXHJcbiAgZ01vZHVsZTogTGF6eVdhc21Nb2R1bGUsXHJcbiAgQnVpbGRlcjogeyBuZXcgKCk6IFR5cHN0Q29tbW9uQnVpbGRlcjxUPiB9LFxyXG4gIGhvb2tzOiBDb21wb25lbnRCdWlsZEhvb2tzLFxyXG4pOiBQcm9taXNlPFQ+IHtcclxuICAvLy8gaW5pdCB0eXBzdCB3YXNtIG1vZHVsZVxyXG4gIGF3YWl0IGdNb2R1bGUuaW5pdChvcHRpb25zPy5nZXRNb2R1bGU/LigpKTtcclxuXHJcbiAgcmV0dXJuIGF3YWl0IG5ldyBDb21wb25lbnRCdWlsZGVyPFQ+KCkuYnVpbGQob3B0aW9ucywgbmV3IEJ1aWxkZXIoKSwgaG9va3MpO1xyXG59XHJcbiJdfQ==","export var PreviewMode;\n(function (PreviewMode) {\n    PreviewMode[PreviewMode[\"Doc\"] = 0] = \"Doc\";\n    PreviewMode[PreviewMode[\"Slide\"] = 1] = \"Slide\";\n})(PreviewMode = PreviewMode || (PreviewMode = {}));\nexport class TypstDocumentContext {\n    hookedElem;\n    kModule;\n    opts;\n    modes = [];\n    /// Configuration fields\n    /// enable partial rendering\n    partialRendering = true;\n    /// underlying renderer\n    renderMode = 'svg';\n    r = undefined;\n    /// preview mode\n    previewMode = PreviewMode.Doc;\n    /// whether this is a content preview\n    isContentPreview = false;\n    /// whether this content preview will mix outline titles\n    isMixinOutline = false;\n    /// background color\n    backgroundColor = 'black';\n    /// default page color (empty string means transparent)\n    pageColor = 'white';\n    /// pixel per pt\n    pixelPerPt = 3;\n    /// customized way to retrieving dom state\n    retrieveDOMState;\n    /// State fields\n    /// whether svg is updating (in triggerSvgUpdate)\n    isRendering = false;\n    /// whether kModule is initialized\n    moduleInitialized = false;\n    /// patch queue for updating data.\n    patchQueue = [];\n    /// resources to dispose\n    disposeList = [];\n    /// canvas render ctoken\n    canvasRenderCToken;\n    /// There are two scales in this class: The real scale is to adjust the size\n    /// of `hookedElem` to fit the svg. The virtual scale (scale ratio) is to let\n    /// user zoom in/out the svg. For example:\n    /// + the default value of virtual scale is 1, which means the svg is totally\n    ///   fit in `hookedElem`.\n    /// + if user set virtual scale to 0.5, then the svg will be zoomed out to fit\n    ///   in half width of `hookedElem`. \"real\" current scale of `hookedElem`\n    currentRealScale = 1;\n    /// \"virtual\" current scale of `hookedElem`\n    currentScaleRatio = 1;\n    /// timeout for delayed viewport change\n    vpTimeout = undefined;\n    /// sampled by last render time.\n    sampledRenderTime = 0;\n    /// page to partial render\n    partialRenderPage = 0;\n    /// outline data\n    outline = undefined;\n    /// cursor position in form of [page, x, y]\n    cursorPosition = undefined;\n    // id: number = rnd++;\n    /// Cache fields\n    /// cached state of container, default to retrieve state from `this.hookedElem`\n    cachedDOMState = {\n        width: 0,\n        height: 0,\n        window: {\n            innerWidth: 0,\n            innerHeight: 0,\n        },\n        boundingRect: {\n            left: 0,\n            top: 0,\n            right: 0,\n        },\n    };\n    constructor(opts) {\n        this.hookedElem = opts.hookedElem;\n        this.kModule = opts.kModule;\n        this.opts = opts || {};\n        /// Apply configuration\n        {\n            const { renderMode, previewMode, isContentPreview, retrieveDOMState } = opts || {};\n            this.partialRendering = false;\n            this.renderMode = renderMode ?? this.renderMode;\n            this.previewMode = previewMode ?? this.previewMode;\n            this.isContentPreview = isContentPreview || false;\n            this.retrieveDOMState =\n                retrieveDOMState ??\n                    (() => {\n                        return {\n                            width: this.hookedElem.offsetWidth,\n                            height: this.hookedElem.offsetHeight,\n                            window: {\n                                innerWidth: window.innerWidth,\n                                innerHeight: window.innerHeight,\n                            },\n                            boundingRect: this.hookedElem.getBoundingClientRect(),\n                        };\n                    });\n            this.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--typst-preview-background-color');\n        }\n        // if init scale == 1\n        // hide scrollbar if scale == 1\n        this.hookedElem.classList.add('hide-scrollbar-x');\n        this.hookedElem.parentElement?.classList.add('hide-scrollbar-x');\n        if (this.previewMode === PreviewMode.Slide) {\n            this.hookedElem.classList.add('hide-scrollbar-y');\n            this.hookedElem.parentElement?.classList.add('hide-scrollbar-y');\n        }\n        this.installCtrlWheelHandler();\n    }\n    reset() {\n        this.kModule.reset();\n        this.moduleInitialized = false;\n    }\n    dispose() {\n        const disposeList = this.disposeList;\n        this.disposeList = [];\n        disposeList.forEach(x => x());\n    }\n    static derive(ctx, mode) {\n        return ['rescale', 'rerender', 'postRender'].reduce((acc, x) => {\n            acc[x] = ctx[`${x}$${mode}`].bind(ctx);\n            console.assert(acc[x] !== undefined, `${x}$${mode} is undefined`);\n            return acc;\n        }, {});\n    }\n    registerMode(mode) {\n        const facade = TypstDocumentContext.derive(this, mode);\n        this.modes.push([mode, facade]);\n        if (mode === this.renderMode) {\n            this.r = facade;\n        }\n    }\n    installCtrlWheelHandler() {\n        // Ctrl+scroll rescaling\n        // will disable auto resizing\n        // fixed factors, same as pdf.js\n        const factors = [\n            0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.3, 1.5, 1.7, 1.9, 2.1, 2.4, 2.7, 3,\n            3.3, 3.7, 4.1, 4.6, 5.1, 5.7, 6.3, 7, 7.7, 8.5, 9.4, 10,\n        ];\n        const wheelEventHandler = (event) => {\n            if (event.ctrlKey) {\n                event.preventDefault();\n                // retrieve dom state before any operation\n                this.cachedDOMState = this.retrieveDOMState();\n                if (window.onresize !== null) {\n                    // is auto resizing\n                    window.onresize = null;\n                }\n                const prevScaleRatio = this.currentScaleRatio;\n                // Get wheel scroll direction and calculate new scale\n                if (event.deltaY < 0) {\n                    // enlarge\n                    if (this.currentScaleRatio >= factors.at(-1)) {\n                        // already large than max factor\n                        return;\n                    }\n                    else {\n                        this.currentScaleRatio = factors.filter(x => x > this.currentScaleRatio).at(0);\n                    }\n                }\n                else if (event.deltaY > 0) {\n                    // reduce\n                    if (this.currentScaleRatio <= factors.at(0)) {\n                        return;\n                    }\n                    else {\n                        this.currentScaleRatio = factors.filter(x => x < this.currentScaleRatio).at(-1);\n                    }\n                }\n                else {\n                    // no y-axis scroll\n                    return;\n                }\n                const scrollFactor = this.currentScaleRatio / prevScaleRatio;\n                const scrollX = event.pageX * (scrollFactor - 1);\n                const scrollY = event.pageY * (scrollFactor - 1);\n                // hide scrollbar if scale == 1\n                if (Math.abs(this.currentScaleRatio - 1) < 1e-5) {\n                    this.hookedElem.classList.add('hide-scrollbar-x');\n                    this.hookedElem.parentElement?.classList.add('hide-scrollbar-x');\n                    if (this.previewMode === PreviewMode.Slide) {\n                        this.hookedElem.classList.add('hide-scrollbar-y');\n                        this.hookedElem.parentElement?.classList.add('hide-scrollbar-y');\n                    }\n                }\n                else {\n                    this.hookedElem.classList.remove('hide-scrollbar-x');\n                    this.hookedElem.parentElement?.classList.remove('hide-scrollbar-x');\n                    if (this.previewMode === PreviewMode.Slide) {\n                        this.hookedElem.classList.remove('hide-scrollbar-y');\n                        this.hookedElem.parentElement?.classList.remove('hide-scrollbar-y');\n                    }\n                }\n                // reserve space to scroll down\n                const svg = this.hookedElem.firstElementChild;\n                if (svg) {\n                    const scaleRatio = this.getSvgScaleRatio();\n                    const dataHeight = Number.parseFloat(svg.getAttribute('data-height'));\n                    const scaledHeight = Math.ceil(dataHeight * scaleRatio);\n                    // we increase the height by 2 times.\n                    // The `2` is only a magic number that is large enough.\n                    this.hookedElem.style.height = `${scaledHeight * 2}px`;\n                }\n                // make sure the cursor is still on the same position\n                window.scrollBy(scrollX, scrollY);\n                // toggle scale change event\n                this.addViewportChange();\n                return false;\n            }\n        };\n        if (this.renderMode !== 'dom') {\n            const vscodeAPI = typeof acquireVsCodeApi !== 'undefined';\n            if (vscodeAPI) {\n                window.addEventListener('wheel', wheelEventHandler, {\n                    passive: false,\n                });\n                this.disposeList.push(() => {\n                    window.removeEventListener('wheel', wheelEventHandler);\n                });\n            }\n            else {\n                document.body.addEventListener('wheel', wheelEventHandler, {\n                    passive: false,\n                });\n                this.disposeList.push(() => {\n                    document.body.removeEventListener('wheel', wheelEventHandler);\n                });\n            }\n        }\n    }\n    /// Get current scale from html to svg\n    // Note: one should retrieve dom state before rescale\n    getSvgScaleRatio() {\n        const svg = this.hookedElem.firstElementChild;\n        if (!svg) {\n            return 0;\n        }\n        const container = this.cachedDOMState;\n        const svgWidth = Number.parseFloat(svg.getAttribute('data-width') || svg.getAttribute('width') || '1');\n        const svgHeight = Number.parseFloat(svg.getAttribute('data-height') || svg.getAttribute('height') || '1');\n        this.currentRealScale =\n            this.previewMode === PreviewMode.Slide\n                ? Math.min(container.width / svgWidth, container.height / svgHeight)\n                : container.width / svgWidth;\n        return this.currentRealScale * this.currentScaleRatio;\n    }\n    processQueue(svgUpdateEvent) {\n        const eventName = svgUpdateEvent[0];\n        switch (eventName) {\n            case 'new':\n            case 'diff-v1': {\n                if (eventName === 'new') {\n                    this.reset();\n                }\n                this.kModule.manipulateData({\n                    action: 'merge',\n                    data: svgUpdateEvent[1],\n                });\n                this.moduleInitialized = true;\n                return true;\n            }\n            case 'viewport-change': {\n                if (!this.moduleInitialized) {\n                    console.log('viewport-change before initialization');\n                    return false;\n                }\n                return true;\n            }\n            default:\n                console.log('svgUpdateEvent', svgUpdateEvent);\n                return false;\n        }\n    }\n    triggerUpdate() {\n        if (this.isRendering) {\n            return;\n        }\n        this.isRendering = true;\n        const doUpdate = async () => {\n            this.cachedDOMState = this.retrieveDOMState();\n            if (this.patchQueue.length === 0) {\n                this.isRendering = false;\n                this.postprocessChanges();\n                return;\n            }\n            try {\n                let t0 = performance.now();\n                const ctoken = this.canvasRenderCToken;\n                if (ctoken) {\n                    await ctoken.cancel();\n                    await ctoken.wait();\n                    this.canvasRenderCToken = undefined;\n                    console.log('cancel canvas rendering');\n                }\n                let needRerender = false;\n                // console.log('patchQueue', JSON.stringify(this.patchQueue.map(x => x[0])));\n                while (this.patchQueue.length > 0) {\n                    needRerender = this.processQueue(this.patchQueue.shift()) || needRerender;\n                }\n                // todo: trigger viewport change once\n                let t1 = performance.now();\n                if (needRerender) {\n                    this.r.rescale();\n                    await this.r.rerender();\n                    this.r.rescale();\n                }\n                let t2 = performance.now();\n                /// perf event\n                const d = (e, x, y) => `${e} ${(y - x).toFixed(2)} ms`;\n                this.sampledRenderTime = t2 - t0;\n                console.log([d('parse', t0, t1), d('rerender', t1, t2), d('total', t0, t2)].join(', '));\n                requestAnimationFrame(doUpdate);\n            }\n            catch (e) {\n                console.error(e);\n                this.isRendering = false;\n                this.postprocessChanges();\n            }\n        };\n        requestAnimationFrame(doUpdate);\n    }\n    postprocessChanges() {\n        this.r.postRender();\n        // todo: abstract this\n        if (this.previewMode === PreviewMode.Slide) {\n            document.querySelectorAll('.typst-page-number-indicator').forEach(x => {\n                x.textContent = `${this.kModule.retrievePagesInfo().length}`;\n            });\n        }\n    }\n    addChangement(change) {\n        if (change[0] === 'new') {\n            this.patchQueue.splice(0, this.patchQueue.length);\n        }\n        const pushChange = () => {\n            this.vpTimeout = undefined;\n            this.patchQueue.push(change);\n            this.triggerUpdate();\n        };\n        if (this.vpTimeout !== undefined) {\n            clearTimeout(this.vpTimeout);\n        }\n        if (change[0] === 'viewport-change' && this.isRendering) {\n            // delay viewport change a bit\n            this.vpTimeout = setTimeout(pushChange, this.sampledRenderTime || 100);\n        }\n        else {\n            pushChange();\n        }\n    }\n    addViewportChange() {\n        this.addChangement(['viewport-change', '']);\n    }\n}\nexport function provideDoc(Base) {\n    return class TypstDocument {\n        impl;\n        kModule;\n        constructor(options) {\n            if (options.isContentPreview) {\n                options.renderMode = 'canvas';\n            }\n            this.kModule = options.kModule;\n            this.impl = new Base(options);\n            if (!this.impl.r) {\n                throw new Error(`mode is not supported, ${options?.renderMode}`);\n            }\n            if (options.isContentPreview) {\n                // content preview has very bad performance without partial rendering\n                this.impl.partialRendering = true;\n                this.impl.pixelPerPt = 1;\n                this.impl.isMixinOutline = true;\n            }\n        }\n        dispose() {\n            this.impl.dispose();\n        }\n        reset() {\n            this.impl.reset();\n        }\n        addChangement(change) {\n            this.impl.addChangement(change);\n        }\n        addViewportChange() {\n            this.impl.addViewportChange();\n        }\n        setPageColor(color) {\n            this.impl.pageColor = color;\n            this.addViewportChange();\n        }\n        setPartialRendering(partialRendering) {\n            this.impl.partialRendering = partialRendering;\n        }\n        setCursor(page, x, y) {\n            this.impl.cursorPosition = [page, x, y];\n        }\n        setPartialPageNumber(page) {\n            if (page <= 0 || page > this.kModule.retrievePagesInfo().length) {\n                return false;\n            }\n            this.impl.partialRenderPage = page - 1;\n            this.addViewportChange();\n            return true;\n        }\n        getPartialPageNumber() {\n            return this.impl.partialRenderPage + 1;\n        }\n        setOutineData(outline) {\n            this.impl.outline = outline;\n            this.addViewportChange();\n        }\n    };\n}\nexport function composeDoc(Base, ...mixins) {\n    return mixins.reduce((acc, mixin) => mixin(acc), Base);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwc3QtZG9jLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb250cmliL2RvbS90eXBzdC1kb2MubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXVCQSxNQUFNLENBQU4sSUFBWSxXQUdYO0FBSEQsV0FBWSxXQUFXO0lBQ3JCLDJDQUFHLENBQUE7SUFDSCwrQ0FBSyxDQUFBO0FBQ1AsQ0FBQyxFQUhXLFdBQVcsR0FBWCxXQUFXLEtBQVgsV0FBVyxRQUd0QjtBQW9CRCxNQUFNLE9BQU8sb0JBQW9CO0lBQ3hCLFVBQVUsQ0FBYztJQUN4QixPQUFPLENBQWdCO0lBQ3ZCLElBQUksQ0FBSTtJQUNmLEtBQUssR0FBb0MsRUFBRSxDQUFDO0lBRTVDLHdCQUF3QjtJQUV4Qiw0QkFBNEI7SUFDNUIsZ0JBQWdCLEdBQVksSUFBSSxDQUFDO0lBQ2pDLHVCQUF1QjtJQUN2QixVQUFVLEdBQWUsS0FBSyxDQUFDO0lBQy9CLENBQUMsR0FBd0IsU0FBVSxDQUFDO0lBQ3BDLGdCQUFnQjtJQUNoQixXQUFXLEdBQWdCLFdBQVcsQ0FBQyxHQUFHLENBQUM7SUFDM0MscUNBQXFDO0lBQ3JDLGdCQUFnQixHQUFZLEtBQUssQ0FBQztJQUNsQyx3REFBd0Q7SUFDeEQsY0FBYyxHQUFZLEtBQUssQ0FBQztJQUNoQyxvQkFBb0I7SUFDcEIsZUFBZSxHQUFXLE9BQU8sQ0FBQztJQUNsQyx1REFBdUQ7SUFDdkQsU0FBUyxHQUFXLE9BQU8sQ0FBQztJQUM1QixnQkFBZ0I7SUFDaEIsVUFBVSxHQUFXLENBQUMsQ0FBQztJQUN2QiwwQ0FBMEM7SUFDMUMsZ0JBQWdCLENBQTBCO0lBRTFDLGdCQUFnQjtJQUVoQixpREFBaUQ7SUFDakQsV0FBVyxHQUFZLEtBQUssQ0FBQztJQUM3QixrQ0FBa0M7SUFDbEMsaUJBQWlCLEdBQVksS0FBSyxDQUFDO0lBQ25DLGtDQUFrQztJQUNsQyxVQUFVLEdBQXVCLEVBQUUsQ0FBQztJQUNwQyx3QkFBd0I7SUFDeEIsV0FBVyxHQUFtQixFQUFFLENBQUM7SUFDakMsd0JBQXdCO0lBQ3hCLGtCQUFrQixDQUEwQjtJQUU1Qyw0RUFBNEU7SUFDNUUsNkVBQTZFO0lBQzdFLDBDQUEwQztJQUMxQyw2RUFBNkU7SUFDN0UsMEJBQTBCO0lBQzFCLDhFQUE4RTtJQUM5RSx5RUFBeUU7SUFDekUsZ0JBQWdCLEdBQVcsQ0FBQyxDQUFDO0lBQzdCLDJDQUEyQztJQUMzQyxpQkFBaUIsR0FBVyxDQUFDLENBQUM7SUFDOUIsdUNBQXVDO0lBQ3ZDLFNBQVMsR0FBUSxTQUFTLENBQUM7SUFDM0IsZ0NBQWdDO0lBQ2hDLGlCQUFpQixHQUFXLENBQUMsQ0FBQztJQUM5QiwwQkFBMEI7SUFDMUIsaUJBQWlCLEdBQVcsQ0FBQyxDQUFDO0lBQzlCLGdCQUFnQjtJQUNoQixPQUFPLEdBQVEsU0FBUyxDQUFDO0lBQ3pCLDJDQUEyQztJQUMzQyxjQUFjLEdBQThCLFNBQVMsQ0FBQztJQUN0RCxzQkFBc0I7SUFFdEIsZ0JBQWdCO0lBRWhCLCtFQUErRTtJQUMvRSxjQUFjLEdBQXNCO1FBQ2xDLEtBQUssRUFBRSxDQUFDO1FBQ1IsTUFBTSxFQUFFLENBQUM7UUFDVCxNQUFNLEVBQUU7WUFDTixVQUFVLEVBQUUsQ0FBQztZQUNiLFdBQVcsRUFBRSxDQUFDO1NBQ2Y7UUFDRCxZQUFZLEVBQUU7WUFDWixJQUFJLEVBQUUsQ0FBQztZQUNQLEdBQUcsRUFBRSxDQUFDO1lBQ04sS0FBSyxFQUFFLENBQUM7U0FDVDtLQUNGLENBQUM7SUFFRixZQUFZLElBQWlCO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNsQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBRXZCLHVCQUF1QjtRQUN2QjtZQUNFLE1BQU0sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNuRixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1lBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDaEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUNuRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLElBQUksS0FBSyxDQUFDO1lBQ2xELElBQUksQ0FBQyxnQkFBZ0I7Z0JBQ25CLGdCQUFnQjtvQkFDaEIsQ0FBQyxHQUFHLEVBQUU7d0JBQ0osT0FBTzs0QkFDTCxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXOzRCQUNsQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZOzRCQUNwQyxNQUFNLEVBQUU7Z0NBQ04sVUFBVSxFQUFFLE1BQU0sQ0FBQyxVQUFVO2dDQUM3QixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVc7NkJBQ2hDOzRCQUNELFlBQVksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLHFCQUFxQixFQUFFO3lCQUN0RCxDQUFDO29CQUNKLENBQUMsQ0FBQyxDQUFDO1lBQ0wsSUFBSSxDQUFDLGVBQWUsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsZ0JBQWdCLENBQ2hGLGtDQUFrQyxDQUNuQyxDQUFDO1NBQ0g7UUFFRCxxQkFBcUI7UUFDckIsK0JBQStCO1FBRS9CLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNqRSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssV0FBVyxDQUFDLEtBQUssRUFBRTtZQUMxQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNsRCxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7U0FDbEU7UUFFRCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBRUQsS0FBSztRQUNILElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztJQUNqQyxDQUFDO0lBRUQsT0FBTztRQUNMLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDckMsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDdEIsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBUSxFQUFFLElBQVk7UUFDbEMsT0FBTyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBUSxFQUFFLENBQVMsRUFBRSxFQUFFO1lBQzFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdkMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssU0FBUyxFQUFFLEdBQUcsQ0FBQyxJQUFJLElBQUksZUFBZSxDQUFDLENBQUM7WUFDbEUsT0FBTyxHQUFHLENBQUM7UUFDYixDQUFDLEVBQUUsRUFBeUIsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxZQUFZLENBQUMsSUFBUztRQUNwQixNQUFNLE1BQU0sR0FBRyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDaEMsSUFBSSxJQUFJLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUM1QixJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztTQUNqQjtJQUNILENBQUM7SUFFTyx1QkFBdUI7UUFDN0Isd0JBQXdCO1FBQ3hCLDZCQUE2QjtRQUM3QixnQ0FBZ0M7UUFDaEMsTUFBTSxPQUFPLEdBQUc7WUFDZCxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO1lBQ3pGLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtTQUN4RCxDQUFDO1FBQ0YsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLEtBQWlCLEVBQUUsRUFBRTtZQUM5QyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUU7Z0JBQ2pCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdkIsMENBQTBDO2dCQUMxQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUM5QyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssSUFBSSxFQUFFO29CQUM1QixtQkFBbUI7b0JBQ25CLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO2lCQUN4QjtnQkFDRCxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7Z0JBQzlDLHFEQUFxRDtnQkFDckQsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDcEIsVUFBVTtvQkFDVixJQUFJLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUU7d0JBQzdDLGdDQUFnQzt3QkFDaEMsT0FBTztxQkFDUjt5QkFBTTt3QkFDTCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFFLENBQUM7cUJBQ2pGO2lCQUNGO3FCQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQzNCLFNBQVM7b0JBQ1QsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUUsRUFBRTt3QkFDNUMsT0FBTztxQkFDUjt5QkFBTTt3QkFDTCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUUsQ0FBQztxQkFDbEY7aUJBQ0Y7cUJBQU07b0JBQ0wsbUJBQW1CO29CQUNuQixPQUFPO2lCQUNSO2dCQUNELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxjQUFjLENBQUM7Z0JBQzdELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELCtCQUErQjtnQkFDL0IsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUU7b0JBQy9DLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO29CQUNsRCxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7b0JBQ2pFLElBQUksSUFBSSxDQUFDLFdBQVcsS0FBSyxXQUFXLENBQUMsS0FBSyxFQUFFO3dCQUMxQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQzt3QkFDbEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO3FCQUNsRTtpQkFDRjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztvQkFDckQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO29CQUNwRSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssV0FBVyxDQUFDLEtBQUssRUFBRTt3QkFDMUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7d0JBQ3JELElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztxQkFDckU7aUJBQ0Y7Z0JBQ0QsK0JBQStCO2dCQUMvQixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFnQyxDQUFDO2dCQUM3RCxJQUFJLEdBQUcsRUFBRTtvQkFDUCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztvQkFDM0MsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBRSxDQUFDLENBQUM7b0JBQ3ZFLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxDQUFDO29CQUN4RCxxQ0FBcUM7b0JBQ3JDLHVEQUF1RDtvQkFDdkQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsWUFBWSxHQUFHLENBQUMsSUFBSSxDQUFDO2lCQUN4RDtnQkFDRCxxREFBcUQ7Z0JBQ3JELE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUNsQyw0QkFBNEI7Z0JBQzVCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUN6QixPQUFPLEtBQUssQ0FBQzthQUNkO1FBQ0gsQ0FBQyxDQUFDO1FBRUYsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLEtBQUssRUFBRTtZQUM3QixNQUFNLFNBQVMsR0FBRyxPQUFPLGdCQUFnQixLQUFLLFdBQVcsQ0FBQztZQUMxRCxJQUFJLFNBQVMsRUFBRTtnQkFDYixNQUFNLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFO29CQUNsRCxPQUFPLEVBQUUsS0FBSztpQkFDZixDQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO29CQUN6QixNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLGlCQUFpQixDQUFDLENBQUM7Z0JBQ3pELENBQUMsQ0FBQyxDQUFDO2FBQ0o7aUJBQU07Z0JBQ0wsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUU7b0JBQ3pELE9BQU8sRUFBRSxLQUFLO2lCQUNmLENBQUMsQ0FBQztnQkFDSCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7b0JBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLGlCQUFpQixDQUFDLENBQUM7Z0JBQ2hFLENBQUMsQ0FBQyxDQUFDO2FBQ0o7U0FDRjtJQUNILENBQUM7SUFFRCxzQ0FBc0M7SUFDdEMscURBQXFEO0lBQ3JELGdCQUFnQjtRQUNkLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQStCLENBQUM7UUFDNUQsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNSLE9BQU8sQ0FBQyxDQUFDO1NBQ1Y7UUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBRXRDLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQ2hDLEdBQUcsQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLElBQUksR0FBRyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLENBQ25FLENBQUM7UUFDRixNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUNqQyxHQUFHLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxDQUNyRSxDQUFDO1FBQ0YsSUFBSSxDQUFDLGdCQUFnQjtZQUNuQixJQUFJLENBQUMsV0FBVyxLQUFLLFdBQVcsQ0FBQyxLQUFLO2dCQUNwQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxHQUFHLFFBQVEsRUFBRSxTQUFTLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztnQkFDcEUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO1FBRWpDLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztJQUN4RCxDQUFDO0lBRU8sWUFBWSxDQUFDLGNBQWdDO1FBQ25ELE1BQU0sU0FBUyxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxRQUFRLFNBQVMsRUFBRTtZQUNqQixLQUFLLEtBQUssQ0FBQztZQUNYLEtBQUssU0FBUyxDQUFDLENBQUM7Z0JBQ2QsSUFBSSxTQUFTLEtBQUssS0FBSyxFQUFFO29CQUN2QixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7aUJBQ2Q7Z0JBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7b0JBQzFCLE1BQU0sRUFBRSxPQUFPO29CQUNmLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUEwQjtpQkFDakQsQ0FBQyxDQUFDO2dCQUVILElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7Z0JBQzlCLE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFDRCxLQUFLLGlCQUFpQixDQUFDLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7b0JBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLENBQUMsQ0FBQztvQkFDckQsT0FBTyxLQUFLLENBQUM7aUJBQ2Q7Z0JBQ0QsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNEO2dCQUNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsY0FBYyxDQUFDLENBQUM7Z0JBQzlDLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO0lBQ0gsQ0FBQztJQUVPLGFBQWE7UUFDbkIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLE1BQU0sUUFBUSxHQUFHLEtBQUssSUFBSSxFQUFFO1lBQzFCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFOUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO2dCQUN6QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztnQkFDMUIsT0FBTzthQUNSO1lBRUQsSUFBSTtnQkFDRixJQUFJLEVBQUUsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBRTNCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztnQkFDdkMsSUFBSSxNQUFNLEVBQUU7b0JBQ1YsTUFBTSxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7b0JBQ3RCLE1BQU0sTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO29CQUNwQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsU0FBUyxDQUFDO29CQUNwQyxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7aUJBQ3hDO2dCQUVELElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQztnQkFDekIsNkVBQTZFO2dCQUM3RSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDakMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUcsQ0FBQyxJQUFJLFlBQVksQ0FBQztpQkFDNUU7Z0JBRUQscUNBQXFDO2dCQUNyQyxJQUFJLEVBQUUsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzNCLElBQUksWUFBWSxFQUFFO29CQUNoQixJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO29CQUNqQixNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ3hCLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7aUJBQ2xCO2dCQUNELElBQUksRUFBRSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFFM0IsY0FBYztnQkFDZCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztnQkFDL0UsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUM7Z0JBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUV4RixxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNqQztZQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNWLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO2dCQUN6QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzthQUMzQjtRQUNILENBQUMsQ0FBQztRQUNGLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFTyxrQkFBa0I7UUFDeEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUVwQixzQkFBc0I7UUFDdEIsSUFBSSxJQUFJLENBQUMsV0FBVyxLQUFLLFdBQVcsQ0FBQyxLQUFLLEVBQUU7WUFDMUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLDhCQUE4QixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNwRSxDQUFDLENBQUMsV0FBVyxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQy9ELENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRUQsYUFBYSxDQUFDLE1BQXdCO1FBQ3BDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssRUFBRTtZQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuRDtRQUVELE1BQU0sVUFBVSxHQUFHLEdBQUcsRUFBRTtZQUN0QixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztZQUMzQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDdkIsQ0FBQyxDQUFDO1FBRUYsSUFBSSxJQUFJLENBQUMsU0FBUyxLQUFLLFNBQVMsRUFBRTtZQUNoQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzlCO1FBRUQsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssaUJBQWlCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUN2RCw4QkFBOEI7WUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUMsQ0FBQztTQUN4RTthQUFNO1lBQ0wsVUFBVSxFQUFFLENBQUM7U0FDZDtJQUNILENBQUM7SUFFRCxpQkFBaUI7UUFDZixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM5QyxDQUFDO0NBQ0Y7QUFpQkQsTUFBTSxVQUFVLFVBQVUsQ0FDeEIsSUFBcUI7SUFFckIsT0FBTyxNQUFNLGFBQWE7UUFDakIsSUFBSSxDQUFJO1FBQ1IsT0FBTyxDQUFnQjtRQUU5QixZQUFZLE9BQWdCO1lBQzFCLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFO2dCQUM1QixPQUFPLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQzthQUMvQjtZQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztZQUMvQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7YUFDbEU7WUFFRCxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDNUIscUVBQXFFO2dCQUNyRSxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztnQkFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7YUFDakM7UUFDSCxDQUFDO1FBRUQsT0FBTztZQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDdEIsQ0FBQztRQUVELEtBQUs7WUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3BCLENBQUM7UUFFRCxhQUFhLENBQUMsTUFBd0I7WUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUVELGlCQUFpQjtZQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNoQyxDQUFDO1FBRUQsWUFBWSxDQUFDLEtBQWE7WUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBQzVCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQzNCLENBQUM7UUFFRCxtQkFBbUIsQ0FBQyxnQkFBeUI7WUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQztRQUNoRCxDQUFDO1FBRUQsU0FBUyxDQUFDLElBQVksRUFBRSxDQUFTLEVBQUUsQ0FBUztZQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUVELG9CQUFvQixDQUFDLElBQVk7WUFDL0IsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGlCQUFpQixFQUFFLENBQUMsTUFBTSxFQUFFO2dCQUMvRCxPQUFPLEtBQUssQ0FBQzthQUNkO1lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELG9CQUFvQjtZQUNsQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFFRCxhQUFhLENBQUMsT0FBWTtZQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7WUFDNUIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDM0IsQ0FBQztLQUNGLENBQUM7QUFDSixDQUFDO0FBMEVELE1BQU0sVUFBVSxVQUFVLENBQTZCLElBQVcsRUFBRSxHQUFHLE1BQWE7SUFDbEYsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3pELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFJlbmRlclNlc3Npb24gfSBmcm9tICcuLi8uLi9yZW5kZXJlci5tanMnO1xyXG5pbXBvcnQgeyBUeXBzdENhbmNlbGxhdGlvblRva2VuIH0gZnJvbSAnLi90eXBzdC1jYW5jZWwubWpzJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29udGFpbmVyRE9NU3RhdGUge1xyXG4gIC8vLyBjYWNoZWQgYGhvb2tlZEVsZW0ub2Zmc2V0V2lkdGhgIG9yIGBob29rZWRFbGVtLmlubmVyV2lkdGhgXHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICAvLy8gY2FjaGVkIGBob29rZWRFbGVtLm9mZnNldEhlaWdodGAgb3IgYGhvb2tlZEVsZW0uaW5uZXJIZWlnaHRgXHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgd2luZG93OiB7XHJcbiAgICBpbm5lcldpZHRoOiBudW1iZXI7XHJcbiAgICBpbm5lckhlaWdodDogbnVtYmVyO1xyXG4gIH07XHJcbiAgLy8vIGNhY2hlZCBgaG9va2VkRWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKWBcclxuICAvLy8gV2Ugb25seSB1c2UgYGxlZnRgIGFuZCBgdG9wYCBoZXJlLlxyXG4gIGJvdW5kaW5nUmVjdDoge1xyXG4gICAgbGVmdDogbnVtYmVyO1xyXG4gICAgdG9wOiBudW1iZXI7XHJcbiAgICByaWdodDogbnVtYmVyO1xyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFJlbmRlck1vZGUgPSAnc3ZnJyB8ICdjYW52YXMnIHwgJ2RvbSc7XHJcblxyXG5leHBvcnQgZW51bSBQcmV2aWV3TW9kZSB7XHJcbiAgRG9jLFxyXG4gIFNsaWRlLFxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE9wdGlvbnMge1xyXG4gIGhvb2tlZEVsZW06IEhUTUxFbGVtZW50O1xyXG4gIGtNb2R1bGU6IFJlbmRlclNlc3Npb247XHJcbiAgcmVuZGVyTW9kZT86IFJlbmRlck1vZGU7XHJcbiAgcHJldmlld01vZGU/OiBQcmV2aWV3TW9kZTtcclxuICBpc0NvbnRlbnRQcmV2aWV3PzogYm9vbGVhbjtcclxuICBzb3VyY2VNYXBwaW5nPzogYm9vbGVhbjtcclxuICByZXRyaWV2ZURPTVN0YXRlPzogKCkgPT4gQ29udGFpbmVyRE9NU3RhdGU7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIEdDb25zdHJ1Y3RvcjxUID0ge30+ID0gbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gVDtcclxuXHJcbmludGVyZmFjZSBUeXBzdERvY3VtZW50RmFjYWRlIHtcclxuICByZXNjYWxlKCk6IHZvaWQ7XHJcbiAgcmVyZW5kZXIoKTogUHJvbWlzZTx2b2lkPjtcclxuICBwb3N0UmVuZGVyKCk6IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUeXBzdERvY3VtZW50Q29udGV4dDxPID0gYW55PiB7XHJcbiAgcHVibGljIGhvb2tlZEVsZW06IEhUTUxFbGVtZW50O1xyXG4gIHB1YmxpYyBrTW9kdWxlOiBSZW5kZXJTZXNzaW9uO1xyXG4gIHB1YmxpYyBvcHRzOiBPO1xyXG4gIG1vZGVzOiBbc3RyaW5nLCBUeXBzdERvY3VtZW50RmFjYWRlXVtdID0gW107XHJcblxyXG4gIC8vLyBDb25maWd1cmF0aW9uIGZpZWxkc1xyXG5cclxuICAvLy8gZW5hYmxlIHBhcnRpYWwgcmVuZGVyaW5nXHJcbiAgcGFydGlhbFJlbmRlcmluZzogYm9vbGVhbiA9IHRydWU7XHJcbiAgLy8vIHVuZGVybHlpbmcgcmVuZGVyZXJcclxuICByZW5kZXJNb2RlOiBSZW5kZXJNb2RlID0gJ3N2Zyc7XHJcbiAgcjogVHlwc3REb2N1bWVudEZhY2FkZSA9IHVuZGVmaW5lZCE7XHJcbiAgLy8vIHByZXZpZXcgbW9kZVxyXG4gIHByZXZpZXdNb2RlOiBQcmV2aWV3TW9kZSA9IFByZXZpZXdNb2RlLkRvYztcclxuICAvLy8gd2hldGhlciB0aGlzIGlzIGEgY29udGVudCBwcmV2aWV3XHJcbiAgaXNDb250ZW50UHJldmlldzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8vLyB3aGV0aGVyIHRoaXMgY29udGVudCBwcmV2aWV3IHdpbGwgbWl4IG91dGxpbmUgdGl0bGVzXHJcbiAgaXNNaXhpbk91dGxpbmU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAvLy8gYmFja2dyb3VuZCBjb2xvclxyXG4gIGJhY2tncm91bmRDb2xvcjogc3RyaW5nID0gJ2JsYWNrJztcclxuICAvLy8gZGVmYXVsdCBwYWdlIGNvbG9yIChlbXB0eSBzdHJpbmcgbWVhbnMgdHJhbnNwYXJlbnQpXHJcbiAgcGFnZUNvbG9yOiBzdHJpbmcgPSAnd2hpdGUnO1xyXG4gIC8vLyBwaXhlbCBwZXIgcHRcclxuICBwaXhlbFBlclB0OiBudW1iZXIgPSAzO1xyXG4gIC8vLyBjdXN0b21pemVkIHdheSB0byByZXRyaWV2aW5nIGRvbSBzdGF0ZVxyXG4gIHJldHJpZXZlRE9NU3RhdGU6ICgpID0+IENvbnRhaW5lckRPTVN0YXRlO1xyXG5cclxuICAvLy8gU3RhdGUgZmllbGRzXHJcblxyXG4gIC8vLyB3aGV0aGVyIHN2ZyBpcyB1cGRhdGluZyAoaW4gdHJpZ2dlclN2Z1VwZGF0ZSlcclxuICBpc1JlbmRlcmluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8vLyB3aGV0aGVyIGtNb2R1bGUgaXMgaW5pdGlhbGl6ZWRcclxuICBtb2R1bGVJbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8vLyBwYXRjaCBxdWV1ZSBmb3IgdXBkYXRpbmcgZGF0YS5cclxuICBwYXRjaFF1ZXVlOiBbc3RyaW5nLCBzdHJpbmddW10gPSBbXTtcclxuICAvLy8gcmVzb3VyY2VzIHRvIGRpc3Bvc2VcclxuICBkaXNwb3NlTGlzdDogKCgpID0+IHZvaWQpW10gPSBbXTtcclxuICAvLy8gY2FudmFzIHJlbmRlciBjdG9rZW5cclxuICBjYW52YXNSZW5kZXJDVG9rZW4/OiBUeXBzdENhbmNlbGxhdGlvblRva2VuO1xyXG5cclxuICAvLy8gVGhlcmUgYXJlIHR3byBzY2FsZXMgaW4gdGhpcyBjbGFzczogVGhlIHJlYWwgc2NhbGUgaXMgdG8gYWRqdXN0IHRoZSBzaXplXHJcbiAgLy8vIG9mIGBob29rZWRFbGVtYCB0byBmaXQgdGhlIHN2Zy4gVGhlIHZpcnR1YWwgc2NhbGUgKHNjYWxlIHJhdGlvKSBpcyB0byBsZXRcclxuICAvLy8gdXNlciB6b29tIGluL291dCB0aGUgc3ZnLiBGb3IgZXhhbXBsZTpcclxuICAvLy8gKyB0aGUgZGVmYXVsdCB2YWx1ZSBvZiB2aXJ0dWFsIHNjYWxlIGlzIDEsIHdoaWNoIG1lYW5zIHRoZSBzdmcgaXMgdG90YWxseVxyXG4gIC8vLyAgIGZpdCBpbiBgaG9va2VkRWxlbWAuXHJcbiAgLy8vICsgaWYgdXNlciBzZXQgdmlydHVhbCBzY2FsZSB0byAwLjUsIHRoZW4gdGhlIHN2ZyB3aWxsIGJlIHpvb21lZCBvdXQgdG8gZml0XHJcbiAgLy8vICAgaW4gaGFsZiB3aWR0aCBvZiBgaG9va2VkRWxlbWAuIFwicmVhbFwiIGN1cnJlbnQgc2NhbGUgb2YgYGhvb2tlZEVsZW1gXHJcbiAgY3VycmVudFJlYWxTY2FsZTogbnVtYmVyID0gMTtcclxuICAvLy8gXCJ2aXJ0dWFsXCIgY3VycmVudCBzY2FsZSBvZiBgaG9va2VkRWxlbWBcclxuICBjdXJyZW50U2NhbGVSYXRpbzogbnVtYmVyID0gMTtcclxuICAvLy8gdGltZW91dCBmb3IgZGVsYXllZCB2aWV3cG9ydCBjaGFuZ2VcclxuICB2cFRpbWVvdXQ6IGFueSA9IHVuZGVmaW5lZDtcclxuICAvLy8gc2FtcGxlZCBieSBsYXN0IHJlbmRlciB0aW1lLlxyXG4gIHNhbXBsZWRSZW5kZXJUaW1lOiBudW1iZXIgPSAwO1xyXG4gIC8vLyBwYWdlIHRvIHBhcnRpYWwgcmVuZGVyXHJcbiAgcGFydGlhbFJlbmRlclBhZ2U6IG51bWJlciA9IDA7XHJcbiAgLy8vIG91dGxpbmUgZGF0YVxyXG4gIG91dGxpbmU6IGFueSA9IHVuZGVmaW5lZDtcclxuICAvLy8gY3Vyc29yIHBvc2l0aW9uIGluIGZvcm0gb2YgW3BhZ2UsIHgsIHldXHJcbiAgY3Vyc29yUG9zaXRpb24/OiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPSB1bmRlZmluZWQ7XHJcbiAgLy8gaWQ6IG51bWJlciA9IHJuZCsrO1xyXG5cclxuICAvLy8gQ2FjaGUgZmllbGRzXHJcblxyXG4gIC8vLyBjYWNoZWQgc3RhdGUgb2YgY29udGFpbmVyLCBkZWZhdWx0IHRvIHJldHJpZXZlIHN0YXRlIGZyb20gYHRoaXMuaG9va2VkRWxlbWBcclxuICBjYWNoZWRET01TdGF0ZTogQ29udGFpbmVyRE9NU3RhdGUgPSB7XHJcbiAgICB3aWR0aDogMCxcclxuICAgIGhlaWdodDogMCxcclxuICAgIHdpbmRvdzoge1xyXG4gICAgICBpbm5lcldpZHRoOiAwLFxyXG4gICAgICBpbm5lckhlaWdodDogMCxcclxuICAgIH0sXHJcbiAgICBib3VuZGluZ1JlY3Q6IHtcclxuICAgICAgbGVmdDogMCxcclxuICAgICAgdG9wOiAwLFxyXG4gICAgICByaWdodDogMCxcclxuICAgIH0sXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0czogT3B0aW9ucyAmIE8pIHtcclxuICAgIHRoaXMuaG9va2VkRWxlbSA9IG9wdHMuaG9va2VkRWxlbTtcclxuICAgIHRoaXMua01vZHVsZSA9IG9wdHMua01vZHVsZTtcclxuICAgIHRoaXMub3B0cyA9IG9wdHMgfHwge307XHJcblxyXG4gICAgLy8vIEFwcGx5IGNvbmZpZ3VyYXRpb25cclxuICAgIHtcclxuICAgICAgY29uc3QgeyByZW5kZXJNb2RlLCBwcmV2aWV3TW9kZSwgaXNDb250ZW50UHJldmlldywgcmV0cmlldmVET01TdGF0ZSB9ID0gb3B0cyB8fCB7fTtcclxuICAgICAgdGhpcy5wYXJ0aWFsUmVuZGVyaW5nID0gZmFsc2U7XHJcbiAgICAgIHRoaXMucmVuZGVyTW9kZSA9IHJlbmRlck1vZGUgPz8gdGhpcy5yZW5kZXJNb2RlO1xyXG4gICAgICB0aGlzLnByZXZpZXdNb2RlID0gcHJldmlld01vZGUgPz8gdGhpcy5wcmV2aWV3TW9kZTtcclxuICAgICAgdGhpcy5pc0NvbnRlbnRQcmV2aWV3ID0gaXNDb250ZW50UHJldmlldyB8fCBmYWxzZTtcclxuICAgICAgdGhpcy5yZXRyaWV2ZURPTVN0YXRlID1cclxuICAgICAgICByZXRyaWV2ZURPTVN0YXRlID8/XHJcbiAgICAgICAgKCgpID0+IHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmhvb2tlZEVsZW0ub2Zmc2V0V2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5ob29rZWRFbGVtLm9mZnNldEhlaWdodCxcclxuICAgICAgICAgICAgd2luZG93OiB7XHJcbiAgICAgICAgICAgICAgaW5uZXJXaWR0aDogd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgICAgICAgaW5uZXJIZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYm91bmRpbmdSZWN0OiB0aGlzLmhvb2tlZEVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKFxyXG4gICAgICAgICctLXR5cHN0LXByZXZpZXctYmFja2dyb3VuZC1jb2xvcicsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgaW5pdCBzY2FsZSA9PSAxXHJcbiAgICAvLyBoaWRlIHNjcm9sbGJhciBpZiBzY2FsZSA9PSAxXHJcblxyXG4gICAgdGhpcy5ob29rZWRFbGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUtc2Nyb2xsYmFyLXgnKTtcclxuICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci14Jyk7XHJcbiAgICBpZiAodGhpcy5wcmV2aWV3TW9kZSA9PT0gUHJldmlld01vZGUuU2xpZGUpIHtcclxuICAgICAgdGhpcy5ob29rZWRFbGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUtc2Nyb2xsYmFyLXknKTtcclxuICAgICAgdGhpcy5ob29rZWRFbGVtLnBhcmVudEVsZW1lbnQ/LmNsYXNzTGlzdC5hZGQoJ2hpZGUtc2Nyb2xsYmFyLXknKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmluc3RhbGxDdHJsV2hlZWxIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMua01vZHVsZS5yZXNldCgpO1xyXG4gICAgdGhpcy5tb2R1bGVJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIGNvbnN0IGRpc3Bvc2VMaXN0ID0gdGhpcy5kaXNwb3NlTGlzdDtcclxuICAgIHRoaXMuZGlzcG9zZUxpc3QgPSBbXTtcclxuICAgIGRpc3Bvc2VMaXN0LmZvckVhY2goeCA9PiB4KCkpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGRlcml2ZShjdHg6IGFueSwgbW9kZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gWydyZXNjYWxlJywgJ3JlcmVuZGVyJywgJ3Bvc3RSZW5kZXInXS5yZWR1Y2UoKGFjYzogYW55LCB4OiBzdHJpbmcpID0+IHtcclxuICAgICAgYWNjW3hdID0gY3R4W2Ake3h9JCR7bW9kZX1gXS5iaW5kKGN0eCk7XHJcbiAgICAgIGNvbnNvbGUuYXNzZXJ0KGFjY1t4XSAhPT0gdW5kZWZpbmVkLCBgJHt4fSQke21vZGV9IGlzIHVuZGVmaW5lZGApO1xyXG4gICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwge30gYXMgVHlwc3REb2N1bWVudEZhY2FkZSk7XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck1vZGUobW9kZTogYW55KSB7XHJcbiAgICBjb25zdCBmYWNhZGUgPSBUeXBzdERvY3VtZW50Q29udGV4dC5kZXJpdmUodGhpcywgbW9kZSk7XHJcbiAgICB0aGlzLm1vZGVzLnB1c2goW21vZGUsIGZhY2FkZV0pO1xyXG4gICAgaWYgKG1vZGUgPT09IHRoaXMucmVuZGVyTW9kZSkge1xyXG4gICAgICB0aGlzLnIgPSBmYWNhZGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluc3RhbGxDdHJsV2hlZWxIYW5kbGVyKCkge1xyXG4gICAgLy8gQ3RybCtzY3JvbGwgcmVzY2FsaW5nXHJcbiAgICAvLyB3aWxsIGRpc2FibGUgYXV0byByZXNpemluZ1xyXG4gICAgLy8gZml4ZWQgZmFjdG9ycywgc2FtZSBhcyBwZGYuanNcclxuICAgIGNvbnN0IGZhY3RvcnMgPSBbXHJcbiAgICAgIDAuMSwgMC4yLCAwLjMsIDAuNCwgMC41LCAwLjYsIDAuNywgMC44LCAwLjksIDEsIDEuMSwgMS4zLCAxLjUsIDEuNywgMS45LCAyLjEsIDIuNCwgMi43LCAzLFxyXG4gICAgICAzLjMsIDMuNywgNC4xLCA0LjYsIDUuMSwgNS43LCA2LjMsIDcsIDcuNywgOC41LCA5LjQsIDEwLFxyXG4gICAgXTtcclxuICAgIGNvbnN0IHdoZWVsRXZlbnRIYW5kbGVyID0gKGV2ZW50OiBXaGVlbEV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChldmVudC5jdHJsS2V5KSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAvLyByZXRyaWV2ZSBkb20gc3RhdGUgYmVmb3JlIGFueSBvcGVyYXRpb25cclxuICAgICAgICB0aGlzLmNhY2hlZERPTVN0YXRlID0gdGhpcy5yZXRyaWV2ZURPTVN0YXRlKCk7XHJcbiAgICAgICAgaWYgKHdpbmRvdy5vbnJlc2l6ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgLy8gaXMgYXV0byByZXNpemluZ1xyXG4gICAgICAgICAgd2luZG93Lm9ucmVzaXplID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcHJldlNjYWxlUmF0aW8gPSB0aGlzLmN1cnJlbnRTY2FsZVJhdGlvO1xyXG4gICAgICAgIC8vIEdldCB3aGVlbCBzY3JvbGwgZGlyZWN0aW9uIGFuZCBjYWxjdWxhdGUgbmV3IHNjYWxlXHJcbiAgICAgICAgaWYgKGV2ZW50LmRlbHRhWSA8IDApIHtcclxuICAgICAgICAgIC8vIGVubGFyZ2VcclxuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2FsZVJhdGlvID49IGZhY3RvcnMuYXQoLTEpISkge1xyXG4gICAgICAgICAgICAvLyBhbHJlYWR5IGxhcmdlIHRoYW4gbWF4IGZhY3RvclxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2FsZVJhdGlvID0gZmFjdG9ycy5maWx0ZXIoeCA9PiB4ID4gdGhpcy5jdXJyZW50U2NhbGVSYXRpbykuYXQoMCkhO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFZID4gMCkge1xyXG4gICAgICAgICAgLy8gcmVkdWNlXHJcbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50U2NhbGVSYXRpbyA8PSBmYWN0b3JzLmF0KDApISkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2FsZVJhdGlvID0gZmFjdG9ycy5maWx0ZXIoeCA9PiB4IDwgdGhpcy5jdXJyZW50U2NhbGVSYXRpbykuYXQoLTEpITtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gbm8geS1heGlzIHNjcm9sbFxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzY3JvbGxGYWN0b3IgPSB0aGlzLmN1cnJlbnRTY2FsZVJhdGlvIC8gcHJldlNjYWxlUmF0aW87XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsWCA9IGV2ZW50LnBhZ2VYICogKHNjcm9sbEZhY3RvciAtIDEpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbFkgPSBldmVudC5wYWdlWSAqIChzY3JvbGxGYWN0b3IgLSAxKTtcclxuICAgICAgICAvLyBoaWRlIHNjcm9sbGJhciBpZiBzY2FsZSA9PSAxXHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMuY3VycmVudFNjYWxlUmF0aW8gLSAxKSA8IDFlLTUpIHtcclxuICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci14Jyk7XHJcbiAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0ucGFyZW50RWxlbWVudD8uY2xhc3NMaXN0LmFkZCgnaGlkZS1zY3JvbGxiYXIteCcpO1xyXG4gICAgICAgICAgaWYgKHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci15Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci15Jyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlLXNjcm9sbGJhci14Jyk7XHJcbiAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0ucGFyZW50RWxlbWVudD8uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZS1zY3JvbGxiYXIteCcpO1xyXG4gICAgICAgICAgaWYgKHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlLXNjcm9sbGJhci15Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlLXNjcm9sbGJhci15Jyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHJlc2VydmUgc3BhY2UgdG8gc2Nyb2xsIGRvd25cclxuICAgICAgICBjb25zdCBzdmcgPSB0aGlzLmhvb2tlZEVsZW0uZmlyc3RFbGVtZW50Q2hpbGQhIGFzIFNWR0VsZW1lbnQ7XHJcbiAgICAgICAgaWYgKHN2Zykge1xyXG4gICAgICAgICAgY29uc3Qgc2NhbGVSYXRpbyA9IHRoaXMuZ2V0U3ZnU2NhbGVSYXRpbygpO1xyXG4gICAgICAgICAgY29uc3QgZGF0YUhlaWdodCA9IE51bWJlci5wYXJzZUZsb2F0KHN2Zy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JykhKTtcclxuICAgICAgICAgIGNvbnN0IHNjYWxlZEhlaWdodCA9IE1hdGguY2VpbChkYXRhSGVpZ2h0ICogc2NhbGVSYXRpbyk7XHJcbiAgICAgICAgICAvLyB3ZSBpbmNyZWFzZSB0aGUgaGVpZ2h0IGJ5IDIgdGltZXMuXHJcbiAgICAgICAgICAvLyBUaGUgYDJgIGlzIG9ubHkgYSBtYWdpYyBudW1iZXIgdGhhdCBpcyBsYXJnZSBlbm91Z2guXHJcbiAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0uc3R5bGUuaGVpZ2h0ID0gYCR7c2NhbGVkSGVpZ2h0ICogMn1weGA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgY3Vyc29yIGlzIHN0aWxsIG9uIHRoZSBzYW1lIHBvc2l0aW9uXHJcbiAgICAgICAgd2luZG93LnNjcm9sbEJ5KHNjcm9sbFgsIHNjcm9sbFkpO1xyXG4gICAgICAgIC8vIHRvZ2dsZSBzY2FsZSBjaGFuZ2UgZXZlbnRcclxuICAgICAgICB0aGlzLmFkZFZpZXdwb3J0Q2hhbmdlKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0aGlzLnJlbmRlck1vZGUgIT09ICdkb20nKSB7XHJcbiAgICAgIGNvbnN0IHZzY29kZUFQSSA9IHR5cGVvZiBhY3F1aXJlVnNDb2RlQXBpICE9PSAndW5kZWZpbmVkJztcclxuICAgICAgaWYgKHZzY29kZUFQSSkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHdoZWVsRXZlbnRIYW5kbGVyLCB7XHJcbiAgICAgICAgICBwYXNzaXZlOiBmYWxzZSxcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmRpc3Bvc2VMaXN0LnB1c2goKCkgPT4ge1xyXG4gICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3doZWVsJywgd2hlZWxFdmVudEhhbmRsZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignd2hlZWwnLCB3aGVlbEV2ZW50SGFuZGxlciwge1xyXG4gICAgICAgICAgcGFzc2l2ZTogZmFsc2UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kaXNwb3NlTGlzdC5wdXNoKCgpID0+IHtcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCB3aGVlbEV2ZW50SGFuZGxlcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vLyBHZXQgY3VycmVudCBzY2FsZSBmcm9tIGh0bWwgdG8gc3ZnXHJcbiAgLy8gTm90ZTogb25lIHNob3VsZCByZXRyaWV2ZSBkb20gc3RhdGUgYmVmb3JlIHJlc2NhbGVcclxuICBnZXRTdmdTY2FsZVJhdGlvKCkge1xyXG4gICAgY29uc3Qgc3ZnID0gdGhpcy5ob29rZWRFbGVtLmZpcnN0RWxlbWVudENoaWxkIGFzIFNWR0VsZW1lbnQ7XHJcbiAgICBpZiAoIXN2Zykge1xyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNhY2hlZERPTVN0YXRlO1xyXG5cclxuICAgIGNvbnN0IHN2Z1dpZHRoID0gTnVtYmVyLnBhcnNlRmxvYXQoXHJcbiAgICAgIHN2Zy5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2lkdGgnKSB8fCBzdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpIHx8ICcxJyxcclxuICAgICk7XHJcbiAgICBjb25zdCBzdmdIZWlnaHQgPSBOdW1iZXIucGFyc2VGbG9hdChcclxuICAgICAgc3ZnLmdldEF0dHJpYnV0ZSgnZGF0YS1oZWlnaHQnKSB8fCBzdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSB8fCAnMScsXHJcbiAgICApO1xyXG4gICAgdGhpcy5jdXJyZW50UmVhbFNjYWxlID1cclxuICAgICAgdGhpcy5wcmV2aWV3TW9kZSA9PT0gUHJldmlld01vZGUuU2xpZGVcclxuICAgICAgICA/IE1hdGgubWluKGNvbnRhaW5lci53aWR0aCAvIHN2Z1dpZHRoLCBjb250YWluZXIuaGVpZ2h0IC8gc3ZnSGVpZ2h0KVxyXG4gICAgICAgIDogY29udGFpbmVyLndpZHRoIC8gc3ZnV2lkdGg7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFJlYWxTY2FsZSAqIHRoaXMuY3VycmVudFNjYWxlUmF0aW87XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByb2Nlc3NRdWV1ZShzdmdVcGRhdGVFdmVudDogW3N0cmluZywgc3RyaW5nXSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZXZlbnROYW1lID0gc3ZnVXBkYXRlRXZlbnRbMF07XHJcbiAgICBzd2l0Y2ggKGV2ZW50TmFtZSkge1xyXG4gICAgICBjYXNlICduZXcnOlxyXG4gICAgICBjYXNlICdkaWZmLXYxJzoge1xyXG4gICAgICAgIGlmIChldmVudE5hbWUgPT09ICduZXcnKSB7XHJcbiAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMua01vZHVsZS5tYW5pcHVsYXRlRGF0YSh7XHJcbiAgICAgICAgICBhY3Rpb246ICdtZXJnZScsXHJcbiAgICAgICAgICBkYXRhOiBzdmdVcGRhdGVFdmVudFsxXSBhcyB1bmtub3duIGFzIFVpbnQ4QXJyYXksXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubW9kdWxlSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgJ3ZpZXdwb3J0LWNoYW5nZSc6IHtcclxuICAgICAgICBpZiAoIXRoaXMubW9kdWxlSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCd2aWV3cG9ydC1jaGFuZ2UgYmVmb3JlIGluaXRpYWxpemF0aW9uJyk7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3N2Z1VwZGF0ZUV2ZW50Jywgc3ZnVXBkYXRlRXZlbnQpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdHJpZ2dlclVwZGF0ZSgpIHtcclxuICAgIGlmICh0aGlzLmlzUmVuZGVyaW5nKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmlzUmVuZGVyaW5nID0gdHJ1ZTtcclxuICAgIGNvbnN0IGRvVXBkYXRlID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICB0aGlzLmNhY2hlZERPTVN0YXRlID0gdGhpcy5yZXRyaWV2ZURPTVN0YXRlKCk7XHJcblxyXG4gICAgICBpZiAodGhpcy5wYXRjaFF1ZXVlLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHRoaXMuaXNSZW5kZXJpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnBvc3Rwcm9jZXNzQ2hhbmdlcygpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBsZXQgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICAgICAgY29uc3QgY3Rva2VuID0gdGhpcy5jYW52YXNSZW5kZXJDVG9rZW47XHJcbiAgICAgICAgaWYgKGN0b2tlbikge1xyXG4gICAgICAgICAgYXdhaXQgY3Rva2VuLmNhbmNlbCgpO1xyXG4gICAgICAgICAgYXdhaXQgY3Rva2VuLndhaXQoKTtcclxuICAgICAgICAgIHRoaXMuY2FudmFzUmVuZGVyQ1Rva2VuID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ2NhbmNlbCBjYW52YXMgcmVuZGVyaW5nJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbmVlZFJlcmVuZGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3BhdGNoUXVldWUnLCBKU09OLnN0cmluZ2lmeSh0aGlzLnBhdGNoUXVldWUubWFwKHggPT4geFswXSkpKTtcclxuICAgICAgICB3aGlsZSAodGhpcy5wYXRjaFF1ZXVlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIG5lZWRSZXJlbmRlciA9IHRoaXMucHJvY2Vzc1F1ZXVlKHRoaXMucGF0Y2hRdWV1ZS5zaGlmdCgpISkgfHwgbmVlZFJlcmVuZGVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdG9kbzogdHJpZ2dlciB2aWV3cG9ydCBjaGFuZ2Ugb25jZVxyXG4gICAgICAgIGxldCB0MSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICAgIGlmIChuZWVkUmVyZW5kZXIpIHtcclxuICAgICAgICAgIHRoaXMuci5yZXNjYWxlKCk7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnIucmVyZW5kZXIoKTtcclxuICAgICAgICAgIHRoaXMuci5yZXNjYWxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0MiA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgICAgICAvLy8gcGVyZiBldmVudFxyXG4gICAgICAgIGNvbnN0IGQgPSAoZTogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gYCR7ZX0gJHsoeSAtIHgpLnRvRml4ZWQoMil9IG1zYDtcclxuICAgICAgICB0aGlzLnNhbXBsZWRSZW5kZXJUaW1lID0gdDIgLSB0MDtcclxuICAgICAgICBjb25zb2xlLmxvZyhbZCgncGFyc2UnLCB0MCwgdDEpLCBkKCdyZXJlbmRlcicsIHQxLCB0MiksIGQoJ3RvdGFsJywgdDAsIHQyKV0uam9pbignLCAnKSk7XHJcblxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShkb1VwZGF0ZSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIHRoaXMuaXNSZW5kZXJpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnBvc3Rwcm9jZXNzQ2hhbmdlcygpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRvVXBkYXRlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcG9zdHByb2Nlc3NDaGFuZ2VzKCkge1xyXG4gICAgdGhpcy5yLnBvc3RSZW5kZXIoKTtcclxuXHJcbiAgICAvLyB0b2RvOiBhYnN0cmFjdCB0aGlzXHJcbiAgICBpZiAodGhpcy5wcmV2aWV3TW9kZSA9PT0gUHJldmlld01vZGUuU2xpZGUpIHtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnR5cHN0LXBhZ2UtbnVtYmVyLWluZGljYXRvcicpLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgeC50ZXh0Q29udGVudCA9IGAke3RoaXMua01vZHVsZS5yZXRyaWV2ZVBhZ2VzSW5mbygpLmxlbmd0aH1gO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFkZENoYW5nZW1lbnQoY2hhbmdlOiBbc3RyaW5nLCBzdHJpbmddKSB7XHJcbiAgICBpZiAoY2hhbmdlWzBdID09PSAnbmV3Jykge1xyXG4gICAgICB0aGlzLnBhdGNoUXVldWUuc3BsaWNlKDAsIHRoaXMucGF0Y2hRdWV1ZS5sZW5ndGgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHB1c2hDaGFuZ2UgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMudnBUaW1lb3V0ID0gdW5kZWZpbmVkO1xyXG4gICAgICB0aGlzLnBhdGNoUXVldWUucHVzaChjaGFuZ2UpO1xyXG4gICAgICB0aGlzLnRyaWdnZXJVcGRhdGUoKTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHRoaXMudnBUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudnBUaW1lb3V0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hhbmdlWzBdID09PSAndmlld3BvcnQtY2hhbmdlJyAmJiB0aGlzLmlzUmVuZGVyaW5nKSB7XHJcbiAgICAgIC8vIGRlbGF5IHZpZXdwb3J0IGNoYW5nZSBhIGJpdFxyXG4gICAgICB0aGlzLnZwVGltZW91dCA9IHNldFRpbWVvdXQocHVzaENoYW5nZSwgdGhpcy5zYW1wbGVkUmVuZGVyVGltZSB8fCAxMDApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcHVzaENoYW5nZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkVmlld3BvcnRDaGFuZ2UoKSB7XHJcbiAgICB0aGlzLmFkZENoYW5nZW1lbnQoWyd2aWV3cG9ydC1jaGFuZ2UnLCAnJ10pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdERvY3VtZW50PFQ+IHtcclxuICBpbXBsOiBUO1xyXG4gIGtNb2R1bGU6IFJlbmRlclNlc3Npb247XHJcbiAgZGlzcG9zZSgpOiB2b2lkO1xyXG4gIHJlc2V0KCk6IHZvaWQ7XHJcbiAgYWRkQ2hhbmdlbWVudChjaGFuZ2U6IFtzdHJpbmcsIHN0cmluZ10pOiB2b2lkO1xyXG4gIGFkZFZpZXdwb3J0Q2hhbmdlKCk6IHZvaWQ7XHJcbiAgc2V0UGFnZUNvbG9yKGNvbG9yOiBzdHJpbmcpOiB2b2lkO1xyXG4gIHNldFBhcnRpYWxSZW5kZXJpbmcocGFydGlhbFJlbmRlcmluZzogYm9vbGVhbik6IHZvaWQ7XHJcbiAgc2V0Q3Vyc29yKHBhZ2U6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpOiB2b2lkO1xyXG4gIHNldFBhcnRpYWxQYWdlTnVtYmVyKHBhZ2U6IG51bWJlcik6IGJvb2xlYW47XHJcbiAgZ2V0UGFydGlhbFBhZ2VOdW1iZXIoKTogbnVtYmVyO1xyXG4gIHNldE91dGluZURhdGEob3V0bGluZTogYW55KTogdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVEb2M8VCBleHRlbmRzIFR5cHN0RG9jdW1lbnRDb250ZXh0PihcclxuICBCYXNlOiBHQ29uc3RydWN0b3I8VD4sXHJcbik6IG5ldyAob3B0aW9uczogT3B0aW9ucyAmIFRbJ29wdHMnXSkgPT4gVHlwc3REb2N1bWVudDxUPiB7XHJcbiAgcmV0dXJuIGNsYXNzIFR5cHN0RG9jdW1lbnQge1xyXG4gICAgcHVibGljIGltcGw6IFQ7XHJcbiAgICBwdWJsaWMga01vZHVsZTogUmVuZGVyU2Vzc2lvbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBPcHRpb25zKSB7XHJcbiAgICAgIGlmIChvcHRpb25zLmlzQ29udGVudFByZXZpZXcpIHtcclxuICAgICAgICBvcHRpb25zLnJlbmRlck1vZGUgPSAnY2FudmFzJztcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5rTW9kdWxlID0gb3B0aW9ucy5rTW9kdWxlO1xyXG4gICAgICB0aGlzLmltcGwgPSBuZXcgQmFzZShvcHRpb25zKTtcclxuICAgICAgaWYgKCF0aGlzLmltcGwucikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgbW9kZSBpcyBub3Qgc3VwcG9ydGVkLCAke29wdGlvbnM/LnJlbmRlck1vZGV9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLmlzQ29udGVudFByZXZpZXcpIHtcclxuICAgICAgICAvLyBjb250ZW50IHByZXZpZXcgaGFzIHZlcnkgYmFkIHBlcmZvcm1hbmNlIHdpdGhvdXQgcGFydGlhbCByZW5kZXJpbmdcclxuICAgICAgICB0aGlzLmltcGwucGFydGlhbFJlbmRlcmluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5pbXBsLnBpeGVsUGVyUHQgPSAxO1xyXG4gICAgICAgIHRoaXMuaW1wbC5pc01peGluT3V0bGluZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkaXNwb3NlKCkge1xyXG4gICAgICB0aGlzLmltcGwuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0KCkge1xyXG4gICAgICB0aGlzLmltcGwucmVzZXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRDaGFuZ2VtZW50KGNoYW5nZTogW3N0cmluZywgc3RyaW5nXSkge1xyXG4gICAgICB0aGlzLmltcGwuYWRkQ2hhbmdlbWVudChjaGFuZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFZpZXdwb3J0Q2hhbmdlKCkge1xyXG4gICAgICB0aGlzLmltcGwuYWRkVmlld3BvcnRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYWdlQ29sb3IoY29sb3I6IHN0cmluZykge1xyXG4gICAgICB0aGlzLmltcGwucGFnZUNvbG9yID0gY29sb3I7XHJcbiAgICAgIHRoaXMuYWRkVmlld3BvcnRDaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYXJ0aWFsUmVuZGVyaW5nKHBhcnRpYWxSZW5kZXJpbmc6IGJvb2xlYW4pIHtcclxuICAgICAgdGhpcy5pbXBsLnBhcnRpYWxSZW5kZXJpbmcgPSBwYXJ0aWFsUmVuZGVyaW5nO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnNvcihwYWdlOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgIHRoaXMuaW1wbC5jdXJzb3JQb3NpdGlvbiA9IFtwYWdlLCB4LCB5XTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRQYXJ0aWFsUGFnZU51bWJlcihwYWdlOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgaWYgKHBhZ2UgPD0gMCB8fCBwYWdlID4gdGhpcy5rTW9kdWxlLnJldHJpZXZlUGFnZXNJbmZvKCkubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuaW1wbC5wYXJ0aWFsUmVuZGVyUGFnZSA9IHBhZ2UgLSAxO1xyXG4gICAgICB0aGlzLmFkZFZpZXdwb3J0Q2hhbmdlKCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBhcnRpYWxQYWdlTnVtYmVyKCk6IG51bWJlciB7XHJcbiAgICAgIHJldHVybiB0aGlzLmltcGwucGFydGlhbFJlbmRlclBhZ2UgKyAxO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE91dGluZURhdGEob3V0bGluZTogYW55KSB7XHJcbiAgICAgIHRoaXMuaW1wbC5vdXRsaW5lID0gb3V0bGluZTtcclxuICAgICAgdGhpcy5hZGRWaWV3cG9ydENoYW5nZSgpO1xyXG4gICAgfVxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMT4oXHJcbiAgQmFzZTogVEJhc2UsXHJcbiAgZjE6IChiYXNlOiBUQmFzZSkgPT4gRjEsXHJcbik6IFRCYXNlICYgRjE7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjI+KFxyXG4gIEJhc2U6IFRCYXNlLFxyXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxyXG4gIGYyOiAoYmFzZTogRjEpID0+IEYyLFxyXG4pOiBUQmFzZSAmIEYxICYgRjI7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzPihcclxuICBCYXNlOiBUQmFzZSxcclxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcclxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcclxuICBmMzogKGJhc2U6IEYyKSA9PiBGMyxcclxuKTogVEJhc2UgJiBGMSAmIEYyICYgRjM7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGND4oXHJcbiAgQmFzZTogVEJhc2UsXHJcbiAgZjE6IChiYXNlOiBUQmFzZSkgPT4gRjEsXHJcbiAgZjI6IChiYXNlOiBGMSkgPT4gRjIsXHJcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXHJcbiAgZjQ6IChiYXNlOiBGMykgPT4gRjQsXHJcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQ7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjU+KFxyXG4gIEJhc2U6IFRCYXNlLFxyXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxyXG4gIGYyOiAoYmFzZTogRjEpID0+IEYyLFxyXG4gIGYzOiAoYmFzZTogRjIpID0+IEYzLFxyXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxyXG4gIGY1OiAoYmFzZTogRjQpID0+IEY1LFxyXG4pOiBUQmFzZSAmIEYxICYgRjIgJiBGMyAmIEY0ICYgRjU7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2PihcclxuICBCYXNlOiBUQmFzZSxcclxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcclxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcclxuICBmMzogKGJhc2U6IEYyKSA9PiBGMyxcclxuICBmNDogKGJhc2U6IEYzKSA9PiBGNCxcclxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcclxuICBmNjogKGJhc2U6IEY1KSA9PiBGNixcclxuKTogVEJhc2UgJiBGMSAmIEYyICYgRjMgJiBGNCAmIEY1ICYgRjY7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2LCBGNz4oXHJcbiAgQmFzZTogVEJhc2UsXHJcbiAgZjE6IChiYXNlOiBUQmFzZSkgPT4gRjEsXHJcbiAgZjI6IChiYXNlOiBGMSkgPT4gRjIsXHJcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXHJcbiAgZjQ6IChiYXNlOiBGMykgPT4gRjQsXHJcbiAgZjU6IChiYXNlOiBGNCkgPT4gRjUsXHJcbiAgZjY6IChiYXNlOiBGNSkgPT4gRjYsXHJcbiAgZjc6IChiYXNlOiBGNikgPT4gRjcsXHJcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQgJiBGNSAmIEY2ICYgRjc7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2LCBGNywgRjg+KFxyXG4gIEJhc2U6IFRCYXNlLFxyXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxyXG4gIGYyOiAoYmFzZTogRjEpID0+IEYyLFxyXG4gIGYzOiAoYmFzZTogRjIpID0+IEYzLFxyXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxyXG4gIGY1OiAoYmFzZTogRjQpID0+IEY1LFxyXG4gIGY2OiAoYmFzZTogRjUpID0+IEY2LFxyXG4gIGY3OiAoYmFzZTogRjYpID0+IEY3LFxyXG4gIGY4OiAoYmFzZTogRjcpID0+IEY4LFxyXG4pOiBUQmFzZSAmIEYxICYgRjIgJiBGMyAmIEY0ICYgRjUgJiBGNiAmIEY3ICYgRjg7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2LCBGNywgRjgsIEY5PihcclxuICBCYXNlOiBUQmFzZSxcclxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcclxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcclxuICBmMzogKGJhc2U6IEYyKSA9PiBGMyxcclxuICBmNDogKGJhc2U6IEYzKSA9PiBGNCxcclxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcclxuICBmNjogKGJhc2U6IEY1KSA9PiBGNixcclxuICBmNzogKGJhc2U6IEY2KSA9PiBGNyxcclxuICBmODogKGJhc2U6IEY3KSA9PiBGOCxcclxuICBmOTogKGJhc2U6IEY4KSA9PiBGOSxcclxuKTogVEJhc2UgJiBGMSAmIEYyICYgRjMgJiBGNCAmIEY1ICYgRjYgJiBGNyAmIEY4ICYgRjk7XHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yPihCYXNlOiBUQmFzZSwgLi4ubWl4aW5zOiBhbnlbXSk6IFRCYXNlIHtcclxuICByZXR1cm4gbWl4aW5zLnJlZHVjZSgoYWNjLCBtaXhpbikgPT4gbWl4aW4oYWNjKSwgQmFzZSk7XHJcbn1cclxuIl19","export class TypstCancellationToken {\n    isCancellationRequested = false;\n    _onCancelled;\n    _onCancelledResolveResolved;\n    constructor() {\n        let resolveT = undefined;\n        let resolveX = undefined;\n        this._onCancelled = new Promise(resolve => {\n            resolveT = resolve;\n            if (resolveX) {\n                resolveX(resolve);\n            }\n        });\n        this._onCancelledResolveResolved = new Promise(resolve => {\n            resolveX = resolve;\n            if (resolveT) {\n                resolve(resolveT);\n            }\n        });\n    }\n    async cancel() {\n        await this._onCancelledResolveResolved;\n        this.isCancellationRequested = true;\n    }\n    isCancelRequested() {\n        return this.isCancellationRequested;\n    }\n    async consume() {\n        (await this._onCancelledResolveResolved)();\n    }\n    wait() {\n        return this._onCancelled;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwc3QtY2FuY2VsLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb250cmliL2RvbS90eXBzdC1jYW5jZWwubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxzQkFBc0I7SUFDakMsdUJBQXVCLEdBQVksS0FBSyxDQUFDO0lBQ2pDLFlBQVksQ0FBZ0I7SUFDNUIsMkJBQTJCLENBQXNCO0lBRXpEO1FBQ0UsSUFBSSxRQUFRLEdBQWUsU0FBVSxDQUFDO1FBQ3RDLElBQUksUUFBUSxHQUE0QixTQUFVLENBQUM7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN4QyxRQUFRLEdBQUcsT0FBTyxDQUFDO1lBQ25CLElBQUksUUFBUSxFQUFFO2dCQUNaLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLDJCQUEyQixHQUFHLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3ZELFFBQVEsR0FBRyxPQUFPLENBQUM7WUFDbkIsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ25CO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU07UUFDVixNQUFNLElBQUksQ0FBQywyQkFBMkIsQ0FBQztRQUN2QyxJQUFJLENBQUMsdUJBQXVCLEdBQUcsSUFBSSxDQUFDO0lBQ3RDLENBQUM7SUFFRCxpQkFBaUI7UUFDZixPQUFPLElBQUksQ0FBQyx1QkFBdUIsQ0FBQztJQUN0QyxDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQU87UUFDWCxDQUFDLE1BQU0sSUFBSSxDQUFDLDJCQUEyQixDQUFDLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBRUQsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVHlwc3RDYW5jZWxsYXRpb25Ub2tlbiB7XHJcbiAgaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwcml2YXRlIF9vbkNhbmNlbGxlZDogUHJvbWlzZTx2b2lkPjtcclxuICBwcml2YXRlIF9vbkNhbmNlbGxlZFJlc29sdmVSZXNvbHZlZDogUHJvbWlzZTwoKSA9PiB2b2lkPjtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBsZXQgcmVzb2x2ZVQ6ICgpID0+IHZvaWQgPSB1bmRlZmluZWQhO1xyXG4gICAgbGV0IHJlc29sdmVYOiAoXzogKCkgPT4gdm9pZCkgPT4gdm9pZCA9IHVuZGVmaW5lZCE7XHJcbiAgICB0aGlzLl9vbkNhbmNlbGxlZCA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICByZXNvbHZlVCA9IHJlc29sdmU7XHJcbiAgICAgIGlmIChyZXNvbHZlWCkge1xyXG4gICAgICAgIHJlc29sdmVYKHJlc29sdmUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX29uQ2FuY2VsbGVkUmVzb2x2ZVJlc29sdmVkID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIHJlc29sdmVYID0gcmVzb2x2ZTtcclxuICAgICAgaWYgKHJlc29sdmVUKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXNvbHZlVCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY2FuY2VsKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgYXdhaXQgdGhpcy5fb25DYW5jZWxsZWRSZXNvbHZlUmVzb2x2ZWQ7XHJcbiAgICB0aGlzLmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGlzQ2FuY2VsUmVxdWVzdGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQ7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjb25zdW1lKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgKGF3YWl0IHRoaXMuX29uQ2FuY2VsbGVkUmVzb2x2ZVJlc29sdmVkKSgpO1xyXG4gIH1cclxuXHJcbiAgd2FpdCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLl9vbkNhbmNlbGxlZDtcclxuICB9XHJcbn1cclxuIl19","import { kObject } from './internal.types.mjs';\nimport { TypstDocumentContext, composeDoc, provideDoc, } from './contrib/dom/typst-doc.mjs';\nimport { TypstCancellationToken } from './contrib/dom/typst-cancel.mjs';\nconst animationFrame = () => new Promise(resolve => requestAnimationFrame(resolve));\nclass DomPage {\n    dispose() { }\n}\nvar TrackMode;\n(function (TrackMode) {\n    TrackMode[TrackMode[\"Doc\"] = 0] = \"Doc\";\n    TrackMode[TrackMode[\"Pages\"] = 1] = \"Pages\";\n})(TrackMode || (TrackMode = {}));\nvar RepaintStage;\n(function (RepaintStage) {\n    RepaintStage[RepaintStage[\"Layout\"] = 0] = \"Layout\";\n    RepaintStage[RepaintStage[\"Svg\"] = 1] = \"Svg\";\n    RepaintStage[RepaintStage[\"Semantics\"] = 2] = \"Semantics\";\n    RepaintStage[RepaintStage[\"PrepareCanvas\"] = 3] = \"PrepareCanvas\";\n    RepaintStage[RepaintStage[\"Canvas\"] = 4] = \"Canvas\";\n})(RepaintStage || (RepaintStage = {}));\nexport function provideDomDoc(Base) {\n    return class DomDocument extends Base {\n        /// The template element for creating DOM by string.\n        tmpl = document.createElement('template');\n        /// The stub element for replacing an invisible element.\n        stub = this.createElement('<stub></stub>');\n        /// Typescript side of lib.\n        plugin;\n        /// Rust side of kernel.\n        docKernel;\n        /// The element to track.\n        resourceHeader = undefined;\n        /// Expected exact state of the current DOM.\n        /// Initially it is empty meaning no any page is rendered.\n        pages = [];\n        /// The virtual scale of the document.\n        domScale = 1;\n        /// Track mode.\n        track_mode = TrackMode.Doc;\n        /// Current executing task.\n        current_task = undefined;\n        /// The currently maintained viewport.\n        viewport;\n        constructor(...args) {\n            super(...args);\n            this.registerMode('dom');\n            this.disposeList.push(() => {\n                this.dispose();\n            });\n            this.plugin = this.opts.renderer;\n            if (this.opts.domScale !== undefined) {\n                if (this.opts.domScale <= 0) {\n                    throw new Error('domScale must be positive');\n                }\n                this.domScale = this.opts.domScale;\n            }\n        }\n        dispose() {\n            for (const page of this.pages) {\n                page.dispose();\n            }\n            if (this.docKernel) {\n                this.docKernel.free();\n            }\n        }\n        createElement(tmpl) {\n            this.tmpl.innerHTML = tmpl;\n            return this.tmpl.content.firstElementChild;\n        }\n        async mountDom(pixelPerPt) {\n            console.log('mountDom', pixelPerPt);\n            if (this.docKernel) {\n                throw new Error('already mounted');\n            }\n            // create typst-svg-resources by string\n            this.hookedElem.innerHTML = `<svg class=\"typst-svg-resources\" viewBox=\"0 0 0 0\" width=\"0\" height=\"0\" style=\"opacity: 0; position: absolute;\"></svg>`;\n            this.resourceHeader = this.hookedElem.querySelector('.typst-svg-resources');\n            this.docKernel = await this.plugin.renderer.mount_dom(this.kModule[kObject], this.hookedElem);\n            this.docKernel.bind_functions({\n                populateGlyphs: (data) => {\n                    let svg = this.createElement(data);\n                    console.log('populateGlyphs', svg);\n                    let content = svg.firstElementChild;\n                    this.resourceHeader.append(content);\n                },\n            });\n        }\n        async cancelAnyway$dom() {\n            console.log('cancelAnyway$dom');\n            if (this.current_task) {\n                const task = this.current_task;\n                this.current_task = undefined;\n                await task.cancel();\n            }\n        }\n        retrieveDOMPages() {\n            return Array.from(this.hookedElem.querySelectorAll('.typst-dom-page'));\n        }\n        // doesn't need to postRender\n        postRender$dom() { }\n        // doesn't need to rescale\n        rescale$dom() { }\n        getDomViewport(cachedWindow, cachedBoundingRect) {\n            const left = cachedBoundingRect.left;\n            const top = -cachedBoundingRect.top;\n            const right = cachedBoundingRect.right;\n            const bottom = cachedWindow.innerHeight - cachedBoundingRect.top;\n            const rect = {\n                x: 0,\n                y: top / this.domScale,\n                width: Math.max(right - left, 0) / this.domScale,\n                height: Math.max(bottom - top, 0) / this.domScale,\n            };\n            if (rect.width <= 0 || rect.height <= 0) {\n                rect.x = rect.y = rect.width = rect.height = 0;\n            }\n            // console.log('ccc', basePos, appPos, rect);\n            return rect;\n        }\n        // fast mode\n        async rerender$dom() {\n            const domState = this.retrieveDOMState();\n            // const l = domState.boundingRect.left;\n            const { x, y, width, height } = this.getDomViewport(domState.window, domState.boundingRect);\n            let dirty = await this.docKernel.relayout(x, y, width, height);\n            if (!dirty) {\n                return;\n            }\n            const cancel = new TypstCancellationToken();\n            this.doRender$dom(cancel);\n            this.current_task = cancel;\n        }\n        async doRender$dom(ctx) {\n            const condOrExit = (needFrame, cb) => {\n                if (needFrame && !ctx.isCancelRequested() && cb) {\n                    return cb();\n                }\n            };\n            const pages = this.retrieveDOMPages().map(page => {\n                const { innerWidth, innerHeight } = window;\n                const browserBBox = page.getBoundingClientRect();\n                // any part of the page is in the window\n                return {\n                    inWindow: !(browserBBox.left > innerWidth ||\n                        browserBBox.right < 0 ||\n                        browserBBox.top > innerHeight ||\n                        browserBBox.bottom < 0),\n                    page,\n                };\n            });\n            const renderPage = async (i) => {\n                await animationFrame();\n                if (ctx.isCancelRequested()) {\n                    console.log('cancel stage', RepaintStage.Layout, i);\n                    return undefined;\n                }\n                const page = pages[i].page;\n                const browserBBox = page.getBoundingClientRect();\n                const v = this.getDomViewport(window, browserBBox);\n                const needCalc = (stage) => this.docKernel.need_repaint(i, v.x, v.y, v.width, v.height, stage);\n                const repaint = (stage) => this.docKernel.repaint(i, v.x, v.y, v.width, v.height, stage);\n                const calc = (stage) => {\n                    if (ctx.isCancelRequested()) {\n                        return undefined;\n                    }\n                    return condOrExit(needCalc(stage), () => repaint(stage));\n                };\n                await calc(RepaintStage.Layout);\n                const wScale = (browserBBox.width\n                    ? Number.parseFloat(page.getAttribute('data-width')) / browserBBox.width\n                    : 1) * this.domScale;\n                const hScale = (browserBBox.height\n                    ? Number.parseFloat(page.getAttribute('data-height')) / browserBBox.height\n                    : 1) * this.domScale;\n                v.x *= wScale;\n                v.y *= hScale;\n                v.y -= 100;\n                v.width *= wScale;\n                v.height *= hScale;\n                v.height += 200;\n                await calc(RepaintStage.Svg);\n                await calc(RepaintStage.Semantics);\n                if (ctx.isCancelRequested()) {\n                    console.log('cancel stage', RepaintStage.Semantics, i);\n                    return undefined;\n                }\n                if (needCalc(RepaintStage.PrepareCanvas)) {\n                    const calcCanvasAfterPreparing = async () => {\n                        await repaint(RepaintStage.PrepareCanvas);\n                        if (ctx.isCancelRequested()) {\n                            return undefined;\n                        }\n                        return calc(RepaintStage.Canvas);\n                    };\n                    calcCanvasAfterPreparing();\n                }\n                else {\n                    await calc(RepaintStage.Canvas);\n                }\n            };\n            const renderPages = async (inWindow) => {\n                for (let idx = 0; idx < pages.length; ++idx) {\n                    if (ctx.isCancelRequested()) {\n                        console.log('cancel page', RepaintStage.Layout, idx);\n                        return;\n                    }\n                    if (pages[idx].inWindow === inWindow) {\n                        await renderPage(idx);\n                    }\n                }\n            };\n            this.cancelAnyway$dom();\n            await renderPages(true);\n            await renderPages(false);\n            if (ctx.isCancelRequested()) {\n                return;\n            }\n            console.log('finished', RepaintStage.Layout);\n        }\n    };\n}\nexport class TypstDomDocument extends provideDoc(composeDoc(TypstDocumentContext, provideDomDoc)) {\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kb20ubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBUSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVyRCxPQUFPLEVBRUwsb0JBQW9CLEVBQ3BCLFVBQVUsRUFDVixVQUFVLEdBQ1gsTUFBTSw2QkFBNkIsQ0FBQztBQUNyQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUV4RSxNQUFNLGNBQWMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFFcEYsTUFBTSxPQUFPO0lBQ1gsT0FBTyxLQUFJLENBQUM7Q0FDYjtBQUVELElBQVcsU0FHVjtBQUhELFdBQVcsU0FBUztJQUNsQix1Q0FBRyxDQUFBO0lBQ0gsMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFIVSxTQUFTLEtBQVQsU0FBUyxRQUduQjtBQUVELElBQVcsWUFNVjtBQU5ELFdBQVcsWUFBWTtJQUNyQixtREFBVSxDQUFBO0lBQ1YsNkNBQU8sQ0FBQTtJQUNQLHlEQUFhLENBQUE7SUFDYixpRUFBaUIsQ0FBQTtJQUNqQixtREFBVSxDQUFBO0FBQ1osQ0FBQyxFQU5VLFlBQVksS0FBWixZQUFZLFFBTXRCO0FBZUQsTUFBTSxVQUFVLGFBQWEsQ0FDM0IsSUFBVztJQUVYLE9BQU8sTUFBTSxXQUFZLFNBQVEsSUFBSTtRQUNuQyxvREFBb0Q7UUFDcEQsSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDMUMsd0RBQXdEO1FBQ3hELElBQUksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzNDLDJCQUEyQjtRQUMzQixNQUFNLENBQXNCO1FBQzVCLHdCQUF3QjtRQUN4QixTQUFTLENBQW1CO1FBQzVC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LEVBQUU7b0JBQzNDLElBQUksR0FBRyxDQUFDLGlCQUFpQixFQUFFLEVBQUU7d0JBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLFlBQVksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7d0JBQ3JELE9BQU87cUJBQ1I7b0JBQ0QsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRTt3QkFDcEMsTUFBTSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQ3ZCO2lCQUNGO1lBQ0gsQ0FBQyxDQUFDO1lBRUYsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFeEIsTUFBTSxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEIsTUFBTSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDekIsSUFBSSxHQUFHLENBQUMsaUJBQWlCLEVBQUUsRUFBRTtnQkFDM0IsT0FBTzthQUNSO1lBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLENBQUM7S0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sT0FBTyxnQkFBaUIsU0FBUSxVQUFVLENBQzlDLFVBQVUsQ0FDUixvQkFBMEUsRUFDMUUsYUFBYSxDQUNkLENBQ0Y7Q0FBRyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSW5jckRvbURvY0NsaWVudCB9IGZyb20gJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyJztcclxuaW1wb3J0IHsgUmVjdCwga09iamVjdCB9IGZyb20gJy4vaW50ZXJuYWwudHlwZXMubWpzJztcclxuaW1wb3J0IHsgVHlwc3RSZW5kZXJlciwgVHlwc3RSZW5kZXJlckRyaXZlciB9IGZyb20gJy4vcmVuZGVyZXIubWpzJztcclxuaW1wb3J0IHtcclxuICBHQ29uc3RydWN0b3IsXHJcbiAgVHlwc3REb2N1bWVudENvbnRleHQsXHJcbiAgY29tcG9zZURvYyxcclxuICBwcm92aWRlRG9jLFxyXG59IGZyb20gJy4vY29udHJpYi9kb20vdHlwc3QtZG9jLm1qcyc7XHJcbmltcG9ydCB7IFR5cHN0Q2FuY2VsbGF0aW9uVG9rZW4gfSBmcm9tICcuL2NvbnRyaWIvZG9tL3R5cHN0LWNhbmNlbC5tanMnO1xyXG5cclxuY29uc3QgYW5pbWF0aW9uRnJhbWUgPSAoKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7XHJcblxyXG5jbGFzcyBEb21QYWdlIHtcclxuICBkaXNwb3NlKCkge31cclxufVxyXG5cclxuY29uc3QgZW51bSBUcmFja01vZGUge1xyXG4gIERvYyxcclxuICBQYWdlcyxcclxufVxyXG5cclxuY29uc3QgZW51bSBSZXBhaW50U3RhZ2Uge1xyXG4gIExheW91dCA9IDAsXHJcbiAgU3ZnID0gMSxcclxuICBTZW1hbnRpY3MgPSAyLFxyXG4gIFByZXBhcmVDYW52YXMgPSAzLFxyXG4gIENhbnZhcyA9IDQsXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVR5cHN0RG9tRG9jdW1lbnQge1xyXG4gIG1vdW50RG9tKHBpeGVsUGVyUHQ6IG51bWJlciB8IHVuZGVmaW5lZCk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSW5pdERvbURvY0FyZ3Mge1xyXG4gIHJlbmRlcmVyOiBUeXBzdFJlbmRlcmVyO1xyXG4gIGRvbVNjYWxlPzogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUmVuZGVyVGFzayB7XHJcbiAgY2FuY2VsKCk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwcm92aWRlRG9tRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yPFR5cHN0RG9jdW1lbnRDb250ZXh0PEluaXREb21Eb2NBcmdzPj4+KFxyXG4gIEJhc2U6IFRCYXNlLFxyXG4pOiBUQmFzZSAmIEdDb25zdHJ1Y3RvcjxJVHlwc3REb21Eb2N1bWVudD4ge1xyXG4gIHJldHVybiBjbGFzcyBEb21Eb2N1bWVudCBleHRlbmRzIEJhc2Uge1xyXG4gICAgLy8vIFRoZSB0ZW1wbGF0ZSBlbGVtZW50IGZvciBjcmVhdGluZyBET00gYnkgc3RyaW5nLlxyXG4gICAgdG1wbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XHJcbiAgICAvLy8gVGhlIHN0dWIgZWxlbWVudCBmb3IgcmVwbGFjaW5nIGFuIGludmlzaWJsZSBlbGVtZW50LlxyXG4gICAgc3R1YiA9IHRoaXMuY3JlYXRlRWxlbWVudCgnPHN0dWI+PC9zdHViPicpO1xyXG4gICAgLy8vIFR5cGVzY3JpcHQgc2lkZSBvZiBsaWIuXHJcbiAgICBwbHVnaW46IFR5cHN0UmVuZGVyZXJEcml2ZXI7XHJcbiAgICAvLy8gUnVzdCBzaWRlIG9mIGtlcm5lbC5cclxuICAgIGRvY0tlcm5lbDogSW5jckRvbURvY0NsaWVudDtcclxuICAgIC8vLyBUaGUgZWxlbWVudCB0byB0cmFjay5cclxuICAgIHJlc291cmNlSGVhZGVyOiBTVkdFbGVtZW50ID0gdW5kZWZpbmVkITtcclxuICAgIC8vLyBFeHBlY3RlZCBleGFjdCBzdGF0ZSBvZiB0aGUgY3VycmVudCBET00uXHJcbiAgICAvLy8gSW5pdGlhbGx5IGl0IGlzIGVtcHR5IG1lYW5pbmcgbm8gYW55IHBhZ2UgaXMgcmVuZGVyZWQuXHJcbiAgICBwYWdlczogRG9tUGFnZVtdID0gW107XHJcbiAgICAvLy8gVGhlIHZpcnR1YWwgc2NhbGUgb2YgdGhlIGRvY3VtZW50LlxyXG4gICAgZG9tU2NhbGUgPSAxO1xyXG4gICAgLy8vIFRyYWNrIG1vZGUuXHJcbiAgICB0cmFja19tb2RlOiBUcmFja01vZGUgPSBUcmFja01vZGUuRG9jO1xyXG4gICAgLy8vIEN1cnJlbnQgZXhlY3V0aW5nIHRhc2suXHJcbiAgICBjdXJyZW50X3Rhc2s/OiBSZW5kZXJUYXNrID0gdW5kZWZpbmVkO1xyXG4gICAgLy8vIFRoZSBjdXJyZW50bHkgbWFpbnRhaW5lZCB2aWV3cG9ydC5cclxuICAgIHZpZXdwb3J0OiBSZWN0O1xyXG4gICAgY29uc3RydWN0b3IoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgc3VwZXIoLi4uYXJncyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJNb2RlKCdkb20nKTtcclxuICAgICAgdGhpcy5kaXNwb3NlTGlzdC5wdXNoKCgpID0+IHtcclxuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMucGx1Z2luID0gdGhpcy5vcHRzLnJlbmRlcmVyIGFzIGFueSBhcyBUeXBzdFJlbmRlcmVyRHJpdmVyO1xyXG4gICAgICBpZiAodGhpcy5vcHRzLmRvbVNjYWxlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAodGhpcy5vcHRzLmRvbVNjYWxlIDw9IDApIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZG9tU2NhbGUgbXVzdCBiZSBwb3NpdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRvbVNjYWxlID0gdGhpcy5vcHRzLmRvbVNjYWxlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZGlzcG9zZSgpIHtcclxuICAgICAgZm9yIChjb25zdCBwYWdlIG9mIHRoaXMucGFnZXMpIHtcclxuICAgICAgICBwYWdlLmRpc3Bvc2UoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuZG9jS2VybmVsKSB7XHJcbiAgICAgICAgdGhpcy5kb2NLZXJuZWwuZnJlZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRWxlbWVudCh0bXBsOiBzdHJpbmcpIHtcclxuICAgICAgdGhpcy50bXBsLmlubmVySFRNTCA9IHRtcGw7XHJcbiAgICAgIHJldHVybiB0aGlzLnRtcGwuY29udGVudC5maXJzdEVsZW1lbnRDaGlsZDtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBtb3VudERvbShwaXhlbFBlclB0OiBudW1iZXIgfCB1bmRlZmluZWQpIHtcclxuICAgICAgY29uc29sZS5sb2coJ21vdW50RG9tJywgcGl4ZWxQZXJQdCk7XHJcblxyXG4gICAgICBpZiAodGhpcy5kb2NLZXJuZWwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FscmVhZHkgbW91bnRlZCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdHlwc3Qtc3ZnLXJlc291cmNlcyBieSBzdHJpbmdcclxuICAgICAgdGhpcy5ob29rZWRFbGVtLmlubmVySFRNTCA9IGA8c3ZnIGNsYXNzPVwidHlwc3Qtc3ZnLXJlc291cmNlc1wiIHZpZXdCb3g9XCIwIDAgMCAwXCIgd2lkdGg9XCIwXCIgaGVpZ2h0PVwiMFwiIHN0eWxlPVwib3BhY2l0eTogMDsgcG9zaXRpb246IGFic29sdXRlO1wiPjwvc3ZnPmA7XHJcbiAgICAgIHRoaXMucmVzb3VyY2VIZWFkZXIgPSB0aGlzLmhvb2tlZEVsZW0ucXVlcnlTZWxlY3RvcignLnR5cHN0LXN2Zy1yZXNvdXJjZXMnKSE7XHJcblxyXG4gICAgICB0aGlzLmRvY0tlcm5lbCA9IGF3YWl0IHRoaXMucGx1Z2luLnJlbmRlcmVyLm1vdW50X2RvbSh0aGlzLmtNb2R1bGVba09iamVjdF0sIHRoaXMuaG9va2VkRWxlbSk7XHJcblxyXG4gICAgICB0aGlzLmRvY0tlcm5lbC5iaW5kX2Z1bmN0aW9ucyh7XHJcbiAgICAgICAgcG9wdWxhdGVHbHlwaHM6IChkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGxldCBzdmcgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoZGF0YSkhO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ3BvcHVsYXRlR2x5cGhzJywgc3ZnKTtcclxuICAgICAgICAgIGxldCBjb250ZW50ID0gc3ZnLmZpcnN0RWxlbWVudENoaWxkITtcclxuICAgICAgICAgIHRoaXMucmVzb3VyY2VIZWFkZXIuYXBwZW5kKGNvbnRlbnQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGNhbmNlbEFueXdheSRkb20oKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdjYW5jZWxBbnl3YXkkZG9tJyk7XHJcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRfdGFzaykge1xyXG4gICAgICAgIGNvbnN0IHRhc2sgPSB0aGlzLmN1cnJlbnRfdGFzaztcclxuICAgICAgICB0aGlzLmN1cnJlbnRfdGFzayA9IHVuZGVmaW5lZDtcclxuICAgICAgICBhd2FpdCB0YXNrLmNhbmNlbCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0cmlldmVET01QYWdlcygpIHtcclxuICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5ob29rZWRFbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJy50eXBzdC1kb20tcGFnZScpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkb2Vzbid0IG5lZWQgdG8gcG9zdFJlbmRlclxyXG4gICAgcG9zdFJlbmRlciRkb20oKSB7fVxyXG5cclxuICAgIC8vIGRvZXNuJ3QgbmVlZCB0byByZXNjYWxlXHJcbiAgICByZXNjYWxlJGRvbSgpIHt9XHJcblxyXG4gICAgZ2V0RG9tVmlld3BvcnQoXHJcbiAgICAgIGNhY2hlZFdpbmRvdzogUGljazxXaW5kb3csICdpbm5lckhlaWdodCcgfCAnaW5uZXJXaWR0aCc+LFxyXG4gICAgICBjYWNoZWRCb3VuZGluZ1JlY3Q6IFBpY2s8RE9NUmVjdCwgJ2xlZnQnIHwgJ3RvcCcgfCAncmlnaHQnPixcclxuICAgICkge1xyXG4gICAgICBjb25zdCBsZWZ0ID0gY2FjaGVkQm91bmRpbmdSZWN0LmxlZnQ7XHJcbiAgICAgIGNvbnN0IHRvcCA9IC1jYWNoZWRCb3VuZGluZ1JlY3QudG9wO1xyXG4gICAgICBjb25zdCByaWdodCA9IGNhY2hlZEJvdW5kaW5nUmVjdC5yaWdodDtcclxuICAgICAgY29uc3QgYm90dG9tID0gY2FjaGVkV2luZG93LmlubmVySGVpZ2h0IC0gY2FjaGVkQm91bmRpbmdSZWN0LnRvcDtcclxuICAgICAgY29uc3QgcmVjdCA9IHtcclxuICAgICAgICB4OiAwLFxyXG4gICAgICAgIHk6IHRvcCAvIHRoaXMuZG9tU2NhbGUsXHJcbiAgICAgICAgd2lkdGg6IE1hdGgubWF4KHJpZ2h0IC0gbGVmdCwgMCkgLyB0aGlzLmRvbVNjYWxlLFxyXG4gICAgICAgIGhlaWdodDogTWF0aC5tYXgoYm90dG9tIC0gdG9wLCAwKSAvIHRoaXMuZG9tU2NhbGUsXHJcbiAgICAgIH07XHJcbiAgICAgIGlmIChyZWN0LndpZHRoIDw9IDAgfHwgcmVjdC5oZWlnaHQgPD0gMCkge1xyXG4gICAgICAgIHJlY3QueCA9IHJlY3QueSA9IHJlY3Qud2lkdGggPSByZWN0LmhlaWdodCA9IDA7XHJcbiAgICAgIH1cclxuICAgICAgLy8gY29uc29sZS5sb2coJ2NjYycsIGJhc2VQb3MsIGFwcFBvcywgcmVjdCk7XHJcbiAgICAgIHJldHVybiByZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGZhc3QgbW9kZVxyXG4gICAgYXN5bmMgcmVyZW5kZXIkZG9tKCkge1xyXG4gICAgICBjb25zdCBkb21TdGF0ZSA9IHRoaXMucmV0cmlldmVET01TdGF0ZSgpO1xyXG5cclxuICAgICAgLy8gY29uc3QgbCA9IGRvbVN0YXRlLmJvdW5kaW5nUmVjdC5sZWZ0O1xyXG4gICAgICBjb25zdCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSA9IHRoaXMuZ2V0RG9tVmlld3BvcnQoZG9tU3RhdGUud2luZG93LCBkb21TdGF0ZS5ib3VuZGluZ1JlY3QpO1xyXG5cclxuICAgICAgbGV0IGRpcnR5ID0gYXdhaXQgdGhpcy5kb2NLZXJuZWwucmVsYXlvdXQoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgIGlmICghZGlydHkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGNhbmNlbCA9IG5ldyBUeXBzdENhbmNlbGxhdGlvblRva2VuKCk7XHJcbiAgICAgIHRoaXMuZG9SZW5kZXIkZG9tKGNhbmNlbCk7XHJcbiAgICAgIHRoaXMuY3VycmVudF90YXNrID0gY2FuY2VsO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGRvUmVuZGVyJGRvbShjdHg6IFR5cHN0Q2FuY2VsbGF0aW9uVG9rZW4pIHtcclxuICAgICAgY29uc3QgY29uZE9yRXhpdCA9IDxULD4obmVlZEZyYW1lOiBib29sZWFuLCBjYjogKCkgPT4gUHJvbWlzZTxUPikgPT4ge1xyXG4gICAgICAgIGlmIChuZWVkRnJhbWUgJiYgIWN0eC5pc0NhbmNlbFJlcXVlc3RlZCgpICYmIGNiKSB7XHJcbiAgICAgICAgICByZXR1cm4gY2IoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHBhZ2VzID0gdGhpcy5yZXRyaWV2ZURPTVBhZ2VzKCkubWFwKHBhZ2UgPT4ge1xyXG4gICAgICAgIGNvbnN0IHsgaW5uZXJXaWR0aCwgaW5uZXJIZWlnaHQgfSA9IHdpbmRvdztcclxuICAgICAgICBjb25zdCBicm93c2VyQkJveCA9IHBhZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgLy8gYW55IHBhcnQgb2YgdGhlIHBhZ2UgaXMgaW4gdGhlIHdpbmRvd1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpbldpbmRvdzogIShcclxuICAgICAgICAgICAgYnJvd3NlckJCb3gubGVmdCA+IGlubmVyV2lkdGggfHxcclxuICAgICAgICAgICAgYnJvd3NlckJCb3gucmlnaHQgPCAwIHx8XHJcbiAgICAgICAgICAgIGJyb3dzZXJCQm94LnRvcCA+IGlubmVySGVpZ2h0IHx8XHJcbiAgICAgICAgICAgIGJyb3dzZXJCQm94LmJvdHRvbSA8IDBcclxuICAgICAgICAgICksXHJcbiAgICAgICAgICBwYWdlLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCByZW5kZXJQYWdlID0gYXN5bmMgKGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIGF3YWl0IGFuaW1hdGlvbkZyYW1lKCk7XHJcbiAgICAgICAgaWYgKGN0eC5pc0NhbmNlbFJlcXVlc3RlZCgpKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnY2FuY2VsIHN0YWdlJywgUmVwYWludFN0YWdlLkxheW91dCwgaSk7XHJcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYWdlID0gcGFnZXNbaV0ucGFnZTtcclxuICAgICAgICBjb25zdCBicm93c2VyQkJveCA9IHBhZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuZ2V0RG9tVmlld3BvcnQod2luZG93LCBicm93c2VyQkJveCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5lZWRDYWxjID0gKHN0YWdlOiBSZXBhaW50U3RhZ2UpID0+XHJcbiAgICAgICAgICB0aGlzLmRvY0tlcm5lbC5uZWVkX3JlcGFpbnQoaSwgdi54LCB2LnksIHYud2lkdGgsIHYuaGVpZ2h0LCBzdGFnZSk7XHJcbiAgICAgICAgY29uc3QgcmVwYWludCA9IChzdGFnZTogUmVwYWludFN0YWdlKSA9PlxyXG4gICAgICAgICAgdGhpcy5kb2NLZXJuZWwucmVwYWludChpLCB2LngsIHYueSwgdi53aWR0aCwgdi5oZWlnaHQsIHN0YWdlKTtcclxuICAgICAgICBjb25zdCBjYWxjID0gKHN0YWdlOiBSZXBhaW50U3RhZ2UpID0+IHtcclxuICAgICAgICAgIGlmIChjdHguaXNDYW5jZWxSZXF1ZXN0ZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGNvbmRPckV4aXQobmVlZENhbGMoc3RhZ2UpLCAoKSA9PiByZXBhaW50KHN0YWdlKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYXdhaXQgY2FsYyhSZXBhaW50U3RhZ2UuTGF5b3V0KTtcclxuXHJcbiAgICAgICAgY29uc3Qgd1NjYWxlID1cclxuICAgICAgICAgIChicm93c2VyQkJveC53aWR0aFxyXG4gICAgICAgICAgICA/IE51bWJlci5wYXJzZUZsb2F0KHBhZ2UuZ2V0QXR0cmlidXRlKCdkYXRhLXdpZHRoJykhKSAvIGJyb3dzZXJCQm94LndpZHRoXHJcbiAgICAgICAgICAgIDogMSkgKiB0aGlzLmRvbVNjYWxlO1xyXG4gICAgICAgIGNvbnN0IGhTY2FsZSA9XHJcbiAgICAgICAgICAoYnJvd3NlckJCb3guaGVpZ2h0XHJcbiAgICAgICAgICAgID8gTnVtYmVyLnBhcnNlRmxvYXQocGFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JykhKSAvIGJyb3dzZXJCQm94LmhlaWdodFxyXG4gICAgICAgICAgICA6IDEpICogdGhpcy5kb21TY2FsZTtcclxuICAgICAgICB2LnggKj0gd1NjYWxlO1xyXG4gICAgICAgIHYueSAqPSBoU2NhbGU7XHJcbiAgICAgICAgdi55IC09IDEwMDtcclxuICAgICAgICB2LndpZHRoICo9IHdTY2FsZTtcclxuICAgICAgICB2LmhlaWdodCAqPSBoU2NhbGU7XHJcbiAgICAgICAgdi5oZWlnaHQgKz0gMjAwO1xyXG5cclxuICAgICAgICBhd2FpdCBjYWxjKFJlcGFpbnRTdGFnZS5TdmcpO1xyXG4gICAgICAgIGF3YWl0IGNhbGMoUmVwYWludFN0YWdlLlNlbWFudGljcyk7XHJcbiAgICAgICAgaWYgKGN0eC5pc0NhbmNlbFJlcXVlc3RlZCgpKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnY2FuY2VsIHN0YWdlJywgUmVwYWludFN0YWdlLlNlbWFudGljcywgaSk7XHJcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVlZENhbGMoUmVwYWludFN0YWdlLlByZXBhcmVDYW52YXMpKSB7XHJcbiAgICAgICAgICBjb25zdCBjYWxjQ2FudmFzQWZ0ZXJQcmVwYXJpbmcgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHJlcGFpbnQoUmVwYWludFN0YWdlLlByZXBhcmVDYW52YXMpO1xyXG4gICAgICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjYWxjKFJlcGFpbnRTdGFnZS5DYW52YXMpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGNhbGNDYW52YXNBZnRlclByZXBhcmluZygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhd2FpdCBjYWxjKFJlcGFpbnRTdGFnZS5DYW52YXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVuZGVyUGFnZXMgPSBhc3luYyAoaW5XaW5kb3c6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICBmb3IgKGxldCBpZHggPSAwOyBpZHggPCBwYWdlcy5sZW5ndGg7ICsraWR4KSB7XHJcbiAgICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NhbmNlbCBwYWdlJywgUmVwYWludFN0YWdlLkxheW91dCwgaWR4KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHBhZ2VzW2lkeF0uaW5XaW5kb3cgPT09IGluV2luZG93KSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHJlbmRlclBhZ2UoaWR4KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0aGlzLmNhbmNlbEFueXdheSRkb20oKTtcclxuXHJcbiAgICAgIGF3YWl0IHJlbmRlclBhZ2VzKHRydWUpO1xyXG4gICAgICBhd2FpdCByZW5kZXJQYWdlcyhmYWxzZSk7XHJcbiAgICAgIGlmIChjdHguaXNDYW5jZWxSZXF1ZXN0ZWQoKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zb2xlLmxvZygnZmluaXNoZWQnLCBSZXBhaW50U3RhZ2UuTGF5b3V0KTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHlwc3REb21Eb2N1bWVudCBleHRlbmRzIHByb3ZpZGVEb2MoXHJcbiAgY29tcG9zZURvYyhcclxuICAgIFR5cHN0RG9jdW1lbnRDb250ZXh0IGFzIEdDb25zdHJ1Y3RvcjxUeXBzdERvY3VtZW50Q29udGV4dDxJbml0RG9tRG9jQXJncz4+LFxyXG4gICAgcHJvdmlkZURvbURvYyxcclxuICApLFxyXG4pIHt9XHJcbiJdfQ==","import { TypstDefaultParams, kObject } from './internal.types.mjs';\nimport { RenderView } from './render/canvas/view.mjs';\nimport { LazyWasmModule } from './wasm.mjs';\nimport { buildComponent } from './init.mjs';\nimport { TypstDomDocument } from './dom.mjs';\n/**\n * The session of a Typst document.\n * @property {string} backgroundColor - The background color of the Typst\n * document.\n * @property {number} pixelPerPt - The pixel per point scale up the image.\n *\n */\nexport class RenderSession {\n    plugin;\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(\n    /**\n     * @internal\n     */\n    plugin, o) {\n        this.plugin = plugin;\n        this[kObject] = o;\n    }\n    /**\n     * @deprecated set in {@link RenderToCanvasOptions} instead\n     *\n     * Set the background color of the Typst document.\n     * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`\n     *\n     * Note: Default to `#ffffff`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    set backgroundColor(t) {\n        if (t !== undefined) {\n            this[kObject].background_color = t;\n        }\n    }\n    /**\n     * Get the background color of the Typst document.\n     *\n     * Note: Default to `#ffffff`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    get backgroundColor() {\n        return this[kObject].background_color;\n    }\n    /**\n     * Set the pixel per point scale up the canvas panel.\n     *\n     * Note: Default to `3`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    set pixelPerPt(t) {\n        if (t !== undefined) {\n            this[kObject].pixel_per_pt = t;\n        }\n    }\n    /**\n     * @deprecated set in {@link RenderToCanvasOptions} instead\n     *\n     * Get the pixel per point scale up the canvas panel.\n     *\n     * Note: Default to `3`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    get pixelPerPt() {\n        return this[kObject].pixel_per_pt;\n    }\n    /**\n     * Reset state\n     */\n    reset() {\n        this.plugin.resetSession(this);\n    }\n    /**\n     * @deprecated\n     * use {@link docWidth} instead\n     */\n    get doc_width() {\n        return this[kObject].doc_width;\n    }\n    get docWidth() {\n        return this[kObject].doc_width;\n    }\n    /**\n     * @deprecated\n     * use {@link docHeight} instead\n     */\n    get doc_height() {\n        return this[kObject].doc_height;\n    }\n    get docHeight() {\n        return this[kObject].doc_height;\n    }\n    retrievePagesInfo() {\n        const pages_info = this[kObject].pages_info;\n        const pageInfos = [];\n        const pageCount = pages_info.page_count;\n        for (let i = 0; i < pageCount; i++) {\n            const pageAst = pages_info.page(i);\n            pageInfos.push({\n                pageOffset: pageAst.page_off,\n                width: pageAst.width_pt,\n                height: pageAst.height_pt,\n            });\n        }\n        return pageInfos;\n    }\n    getSourceLoc(path) {\n        return this[kObject].source_span(path);\n    }\n    /**\n     * See {@link TypstRenderer#renderSvg} for more details.\n     */\n    renderSvg(options) {\n        return this.plugin.renderSvg({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderToSvg} for more details.\n     */\n    renderToSvg(options) {\n        return this.plugin.renderToSvg({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderCanvas} for more details.\n     */\n    renderCanvas(options) {\n        return this.plugin.renderCanvas({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#manipulateData} for more details.\n     */\n    manipulateData(opts) {\n        this.plugin.manipulateData({\n            renderSession: this,\n            ...opts,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderSvgDiff} for more details.\n     */\n    renderSvgDiff(opts) {\n        return this.plugin.renderSvgDiff({\n            renderSession: this,\n            ...opts,\n        });\n    }\n    /**\n     * @deprecated\n     * use {@link getSourceLoc} instead\n     */\n    get_source_loc(path) {\n        return this[kObject].source_span(path);\n    }\n    /**\n     * @deprecated\n     * use {@link renderSvgDiff} instead\n     */\n    render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y) {\n        return this[kObject].render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y);\n    }\n    /**\n     * @deprecated\n     * use {@link manipulateData} instead\n     */\n    merge_delta(data) {\n        this.plugin.manipulateData({\n            renderSession: this,\n            action: 'merge',\n            data,\n        });\n    }\n}\n/**\n * @internal\n */\nvar ManageStatus;\n(function (ManageStatus) {\n    ManageStatus[ManageStatus[\"Delete\"] = 0] = \"Delete\";\n    ManageStatus[ManageStatus[\"New\"] = 1] = \"New\";\n    ManageStatus[ManageStatus[\"Update\"] = 2] = \"Update\";\n})(ManageStatus || (ManageStatus = {}));\nexport class TypstWorker {\n    plugin;\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(\n    /**\n     * @internal\n     */\n    plugin, o) {\n        this.plugin = plugin;\n        this[kObject] = o;\n    }\n    /**\n     * See {@link TypstRenderer#manipulateData} for more details.\n     */\n    manipulateData(action, data) {\n        return this[kObject].manipulate_data(action, data);\n    }\n    /**\n     * @internal\n     */\n    managedCanvasElemList = new Map();\n    /**\n     * @internal\n     */\n    canvasCounter = Math.random();\n    /**\n     * You must submit all canvas in pages to ensure synchronization with the background worker\n     *\n     * See {@link TypstRenderer#renderCanvas} for more details.\n     */\n    renderCanvas(canvasElemList) {\n        const m = this.managedCanvasElemList;\n        for (const [_, elem] of m) {\n            elem[0] = ManageStatus.Delete;\n        }\n        for (const elem of canvasElemList) {\n            const canvas = elem.canvas;\n            let elemId = canvas.dataset.manageId;\n            let action = ManageStatus.Update;\n            if (!elemId) {\n                elemId = this.canvasCounter.toFixed(5);\n                this.canvasCounter += 1;\n                canvas.dataset.manageId = elemId;\n                action = ManageStatus.New;\n            }\n            let prev = m.get(elemId);\n            if (prev && prev[0] !== ManageStatus.Delete) {\n                throw new Error('cannot update a canvas for two times in batch');\n            }\n            m.set(elemId, [action, { ...elem }]);\n        }\n        const entries = Array.from(m.entries());\n        const actions = new Uint8Array(entries.length);\n        const elements = new Array(entries.length);\n        const options = entries.map(([key, [action, elem]], index) => {\n            if (!action) {\n                m.delete(key);\n            }\n            actions[index] = action;\n            elements[index] = elem.canvas;\n            return this.plugin.canvasOptionsToRust(elem);\n        });\n        return this[kObject].render_canvas(actions, elements, options);\n    }\n    async retrievePagesInfo() {\n        const pages_info = await this[kObject].get_pages_info();\n        console.log(pages_info);\n        const pageInfos = [];\n        const pageCount = pages_info.page_count;\n        for (let i = 0; i < pageCount; i++) {\n            const pageAst = pages_info.page(i);\n            pageInfos.push({\n                pageOffset: pageAst.page_off,\n                width: pageAst.width_pt,\n                height: pageAst.height_pt,\n            });\n        }\n        return pageInfos;\n    }\n}\nconst gRendererModule = (module) => new LazyWasmModule(async (bin) => {\n    return await module.default(bin);\n});\n/**\n * create a Typst renderer.\n * @returns {TypstRenderer} - The Typst renderer.\n * @example\n * ```typescript\n * import { createTypstRenderer } from 'typst';\n * const renderer = createTypstRenderer();\n * await renderer.init();\n * await renderer.render({\n *   container: document.getElementById('container'),\n *   artifactContent: '{ ... }',\n * });\n * ```\n */\nexport function createTypstRenderer() {\n    return new TypstRendererDriver();\n}\n/**\n * @deprecated\n * use {@link createTypstRenderer} instead\n */\nexport function createTypstSvgRenderer() {\n    return new TypstRendererDriver();\n}\nexport async function rendererBuildInfo() {\n    const renderModule = await import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs');\n    return renderModule.renderer_build_info();\n}\nlet warnOnceCanvasSet = true;\n/** @internal */\nexport class TypstRendererDriver {\n    renderer;\n    rendererJs;\n    constructor() { }\n    async init(options) {\n        this.rendererJs = await (options?.getWrapper?.() ||\n            import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs'));\n        const TypstRendererBuilder = this.rendererJs.TypstRendererBuilder;\n        this.renderer = await buildComponent(options, gRendererModule(this.rendererJs), TypstRendererBuilder, {});\n    }\n    loadGlyphPack(_pack) {\n        // this.renderer.load_glyph_pack(pack);\n        return Promise.resolve();\n    }\n    createOptionsToRust(options) {\n        const rustOptions = new this.rendererJs.CreateSessionOptions();\n        if (options.format !== undefined) {\n            rustOptions.format = options.format;\n        }\n        if (options.artifactContent !== undefined) {\n            rustOptions.artifact_content = options.artifactContent;\n        }\n        return rustOptions;\n    }\n    canvasOptionsToRust(options) {\n        const rustOptions = new this.rendererJs.RenderPageImageOptions();\n        if (options.pageOffset === undefined) {\n            throw new Error('pageOffset is required in reflexo v0.5.0');\n        }\n        else {\n            rustOptions.page_off = options.pageOffset;\n        }\n        if (options.cacheKey !== undefined) {\n            rustOptions.cache_key = options.cacheKey;\n        }\n        if (options.backgroundColor !== undefined) {\n            rustOptions.background_color = options.backgroundColor;\n        }\n        if (options.pixelPerPt !== undefined) {\n            rustOptions.pixel_per_pt = options.pixelPerPt;\n        }\n        if (options.dataSelection !== undefined) {\n            let encoded = 0;\n            if (options.dataSelection.body) {\n                encoded |= 1 << 0;\n            }\n            else if (options.canvas && warnOnceCanvasSet) {\n                warnOnceCanvasSet = false;\n                console.warn('dataSelection.body is not set but providing canvas for body');\n            }\n            if (options.dataSelection.text || options.dataSelection.annotation) {\n                console.error('dataSelection.text and dataSelection.annotation are deprecated');\n            }\n            if (options.dataSelection.semantics) {\n                encoded |= 1 << 3;\n            }\n            rustOptions.data_selection = encoded;\n        }\n        return rustOptions;\n    }\n    retrievePagesInfoFromSession(session) {\n        return session.retrievePagesInfo();\n    }\n    /**\n     * Render a Typst document to canvas.\n     */\n    renderCanvas(options) {\n        return this.withinOptionSession(options, async (sessionRef) => {\n            return this.renderer.render_page_to_canvas(sessionRef[kObject], options.canvas || undefined, this.canvasOptionsToRust(options));\n        });\n    }\n    // async renderPdf(artifactContent: string): Promise<Uint8Array> {\n    // return this.renderer.render_to_pdf(artifactContent);\n    // }\n    async inAnimationFrame(fn) {\n        return new Promise((resolve, reject) => {\n            requestAnimationFrame(() => {\n                try {\n                    resolve(fn());\n                }\n                catch (e) {\n                    reject(e);\n                }\n            });\n        });\n    }\n    async renderDisplayLayer(session, canvasList, options) {\n        const pages_info = session[kObject].pages_info;\n        const page_count = pages_info.page_count;\n        const doRender = async (i, page_off) => {\n            const canvas = canvasList[i];\n            const ctx = canvas.getContext('2d');\n            if (!ctx) {\n                throw new Error('canvas context is null');\n            }\n            return await this.renderCanvas({\n                ...options,\n                canvas: ctx,\n                renderSession: session,\n                pageOffset: page_off,\n            });\n        };\n        const t = performance.now();\n        const textContentList = await (async () => {\n            const results = [];\n            for (let i = 0; i < page_count; i++) {\n                results.push(await this.inAnimationFrame(() => doRender(i, i)));\n            }\n            return results;\n        })();\n        const t2 = performance.now();\n        console.log(`display layer used: render = ${(t2 - t).toFixed(1)}ms`);\n        return textContentList;\n    }\n    renderTextLayer(layerList, textSourceList) {\n        const t2 = performance.now();\n        layerList.forEach((layer, i) => {\n            layer.innerHTML = textSourceList[i].htmlSemantics[0];\n        });\n        const t3 = performance.now();\n        console.log(`text layer used: render = ${(t3 - t2).toFixed(1)}ms`);\n    }\n    async render(options) {\n        if ('format' in options) {\n            if (options.format !== 'vector') {\n                const artifactFormats = ['serde_json', 'js', 'ir'];\n                if (artifactFormats.includes(options.format)) {\n                    // deprecated\n                    throw new Error(`deprecated format ${options.format}, please use vector format`);\n                }\n            }\n        }\n        return this.renderToCanvas(options);\n    }\n    async renderDom(options) {\n        if ('format' in options) {\n            if (options.format !== 'vector') {\n                const artifactFormats = ['serde_json', 'js', 'ir'];\n                if (artifactFormats.includes(options.format)) {\n                    // deprecated\n                    throw new Error(`deprecated format ${options.format}, please use vector format`);\n                }\n            }\n        }\n        return this.withinOptionSession(options, async (sessionRef) => {\n            const t = new TypstDomDocument({\n                ...options,\n                renderMode: 'dom',\n                hookedElem: options.container,\n                kModule: sessionRef,\n                renderer: this,\n            });\n            t;\n            await t.impl.mountDom(options.pixelPerPt);\n            return t;\n        });\n    }\n    async renderToCanvas(options) {\n        let session;\n        let renderPageResults;\n        const mountContainer = options.container;\n        mountContainer.style.visibility = 'hidden';\n        const doRenderDisplayLayer = async (canvasList, resetLayout) => {\n            try {\n                renderPageResults = await this.renderDisplayLayer(session, canvasList, options);\n                resetLayout();\n            }\n            finally {\n                mountContainer.style.visibility = 'visible';\n            }\n        };\n        return this.withinOptionSession(options, async (sessionRef) => {\n            session = sessionRef;\n            if (session[kObject].pages_info.page_count === 0) {\n                throw new Error(`No page found in session`);\n            }\n            if (options.pixelPerPt !== undefined && options.pixelPerPt <= 0) {\n                throw new Error('Invalid typst.RenderOptions.pixelPerPt, should be a positive number ' +\n                    options.pixelPerPt);\n            }\n            let backgroundColor = options.backgroundColor;\n            if (backgroundColor !== undefined) {\n                if (!/^#[0-9a-f]{6}$/.test(backgroundColor)) {\n                    throw new Error('Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ ' + backgroundColor);\n                }\n            }\n            session.pixelPerPt = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;\n            session.backgroundColor = backgroundColor ?? '#ffffff';\n            const t = performance.now();\n            const pageView = new RenderView(this.retrievePagesInfoFromSession(session), mountContainer, options);\n            const t2 = performance.now();\n            console.log(`layer used: retrieve = ${(t2 - t).toFixed(1)}ms`);\n            await doRenderDisplayLayer(pageView.canvasList, () => pageView.resetLayout());\n            this.renderTextLayer(pageView.textLayerList, renderPageResults);\n            return;\n        });\n    }\n    createModule(b) {\n        return Promise.resolve(new RenderSession(this, this.renderer.create_session(b &&\n            this.createOptionsToRust({\n                format: 'vector',\n                artifactContent: b,\n            }))));\n    }\n    async createWorkerV0(worker) {\n        return new TypstWorker(this, await this.renderer.create_worker(worker));\n    }\n    workerBridge() {\n        return this.renderer.create_worker_bridge();\n    }\n    renderSvg(options, container) {\n        if (options instanceof RenderSession || container) {\n            throw new Error('removed api, please use renderToSvg({ renderSession, container }) instead');\n        }\n        return this.withinOptionSession(options, async (sessionRef) => {\n            let parts = undefined;\n            if (options.data_selection) {\n                parts = 0;\n                if (options.data_selection.body) {\n                    parts |= 1 << 0;\n                }\n                if (options.data_selection.defs) {\n                    parts |= 1 << 1;\n                }\n                if (options.data_selection.css) {\n                    parts |= 1 << 2;\n                }\n                if (options.data_selection.js) {\n                    parts |= 1 << 3;\n                }\n            }\n            return Promise.resolve(this.renderer.svg_data(sessionRef[kObject], parts));\n        });\n    }\n    renderSvgDiff(options) {\n        if (!options.window) {\n            return this.renderer.render_svg_diff(options.renderSession[kObject], 0, 0, 1e33, 1e33);\n        }\n        return this.renderer.render_svg_diff(options.renderSession[kObject], options.window.lo.x, options.window.lo.y, options.window.hi.x, options.window.hi.y);\n    }\n    renderToSvg(options) {\n        return this.withinOptionSession(options, async (sessionRef) => {\n            return Promise.resolve(this.renderer.render_svg(sessionRef[kObject], options.container));\n        });\n    }\n    getCustomV1(options) {\n        return Promise.resolve(this.renderer.get_customs(options.renderSession[kObject]));\n    }\n    resetSession(session) {\n        return this.renderer.reset(session[kObject]);\n    }\n    manipulateData(opts) {\n        return this.renderer.manipulate_data(opts.renderSession[kObject], opts.action ?? 'reset', opts.data);\n    }\n    withinOptionSession(options, fn) {\n        function isRenderByContentOption(options) {\n            return 'artifactContent' in options;\n        }\n        if ('renderSession' in options) {\n            return fn(options.renderSession);\n        }\n        if (isRenderByContentOption(options)) {\n            // todo: remove any\n            return this.runWithSession(options, fn);\n        }\n        throw new Error('Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions');\n    }\n    async runWithSession(arg1, arg2) {\n        let options = arg1;\n        let fn = arg2;\n        if (!arg2) {\n            options = undefined;\n            fn = arg1;\n        }\n        const session = this.renderer.create_session(\n        /* moved */ options && this.createOptionsToRust(options));\n        try {\n            const res = await fn(new RenderSession(this, session));\n            session.free();\n            return res;\n        }\n        catch (e) {\n            session.free();\n            throw e;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlbmRlcmVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQWdDLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBYWpHLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBZTdDOzs7Ozs7R0FNRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBYWQ7SUFaVjs7T0FFRztJQUNJLENBQUMsT0FBTyxDQUFDLENBQXNCO0lBRXRDOztPQUVHO0lBQ0g7SUFDRTs7T0FFRztJQUNLLE1BQXFCLEVBQzdCLENBQXNCO1FBRGQsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUc3QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxJQUFJLGVBQWUsQ0FBQyxDQUFxQjtRQUN2QyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQztTQUNwQztJQUNILENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxJQUFJLGVBQWU7UUFDakIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILElBQUksVUFBVSxDQUFDLENBQXFCO1FBQ2xDLElBQUksQ0FBQyxLQUFLLFNBQVMsRUFBRTtZQUNuQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztTQUNo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UUFDOUQsSUFBSSxFQUFFLEdBQTJDLElBQUksQ0FBQztRQUV0RCxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsT0FBTyxHQUFHLFNBQVMsQ0FBQztZQUNwQixFQUFFLEdBQUcsSUFBSSxDQUFDO1NBQ1g7UUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWM7UUFDMUMsV0FBVyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQ3pELENBQUM7UUFDRixJQUFJO1lBQ0YsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdkQsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsTUFBTSxDQUFDLENBQUM7U0FDVDtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdCBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlci9wa2cvd2FzbS1wYWNrLXNoaW0ubWpzJztcclxuXHJcbmltcG9ydCB0eXBlIHsgSW5pdE9wdGlvbnMgfSBmcm9tICcuL29wdGlvbnMuaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBQYWdlSW5mbywgUmVuZGVyQ2FudmFzUmVzdWx0LCBUeXBzdERlZmF1bHRQYXJhbXMsIGtPYmplY3QgfSBmcm9tICcuL2ludGVybmFsLnR5cGVzLm1qcyc7XHJcbmltcG9ydCB7XHJcbiAgQ3JlYXRlU2Vzc2lvbk9wdGlvbnMsXHJcbiAgUmVuZGVyVG9DYW52YXNPcHRpb25zLFxyXG4gIFJlbmRlck9wdGlvbnMsXHJcbiAgUmVuZGVyQ2FudmFzT3B0aW9ucyxcclxuICBSZW5kZXJUb1N2Z09wdGlvbnMsXHJcbiAgTWFuaXB1bGF0ZURhdGFPcHRpb25zLFxyXG4gIFJlbmRlclN2Z09wdGlvbnMsXHJcbiAgUmVuZGVySW5TZXNzaW9uT3B0aW9ucyxcclxuICBNb3VudERvbU9wdGlvbnMsXHJcbiAgT2Zmc2NyZWVuUmVuZGVyQ2FudmFzT3B0aW9ucyxcclxufSBmcm9tICcuL29wdGlvbnMucmVuZGVyLm1qcyc7XHJcbmltcG9ydCB7IFJlbmRlclZpZXcgfSBmcm9tICcuL3JlbmRlci9jYW52YXMvdmlldy5tanMnO1xyXG5pbXBvcnQgeyBMYXp5V2FzbU1vZHVsZSB9IGZyb20gJy4vd2FzbS5tanMnO1xyXG5pbXBvcnQgeyBidWlsZENvbXBvbmVudCB9IGZyb20gJy4vaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBUeXBzdERvbURvY3VtZW50IH0gZnJvbSAnLi9kb20ubWpzJztcclxuXHJcbi8qKlxyXG4gKiBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBSZW5kZXJSZXN1bHRcclxuICogQHByb3BlcnR5IHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSByZW5kZXJlZCBUeXBzdCBkb2N1bWVudCAoc2luZ2xlIHBhZ2UpLlxyXG4gKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcmVuZGVyZWQgVHlwc3QgZG9jdW1lbnQgKHNpbmdsZSBwYWdlKS5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyUmVzdWx0IHtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG59XHJcblxyXG50eXBlIENvbnRleHRlZFJlbmRlck9wdGlvbnM8VD4gPSBUIHwgUmVuZGVyT3B0aW9uczxUPjtcclxuXHJcbi8qKlxyXG4gKiBUaGUgc2Vzc2lvbiBvZiBhIFR5cHN0IGRvY3VtZW50LlxyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYmFja2dyb3VuZENvbG9yIC0gVGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0XHJcbiAqIGRvY3VtZW50LlxyXG4gKiBAcHJvcGVydHkge251bWJlcn0gcGl4ZWxQZXJQdCAtIFRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGltYWdlLlxyXG4gKlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJlbmRlclNlc3Npb24ge1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBba09iamVjdF06IHR5cHN0LlJlbmRlclNlc3Npb247XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBwbHVnaW46IFR5cHN0UmVuZGVyZXIsXHJcbiAgICBvOiB0eXBzdC5SZW5kZXJTZXNzaW9uLFxyXG4gICkge1xyXG4gICAgdGhpc1trT2JqZWN0XSA9IG87XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZCBzZXQgaW4ge0BsaW5rIFJlbmRlclRvQ2FudmFzT3B0aW9uc30gaW5zdGVhZFxyXG4gICAqXHJcbiAgICogU2V0IHRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBUeXBzdCBkb2N1bWVudC5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdCAtIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIGluIGZvcm1hdCBvZiBgXiM/WzAtOWEtZl17Nn0kYFxyXG4gICAqXHJcbiAgICogTm90ZTogRGVmYXVsdCB0byBgI2ZmZmZmZmAuXHJcbiAgICpcclxuICAgKiBOb3RlOiBPbmx5IGF2YWlsYWJsZSBpbiBjYW52YXMgcmVuZGVyaW5nIG1vZGUuXHJcbiAgICovXHJcbiAgc2V0IGJhY2tncm91bmRDb2xvcih0OiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcclxuICAgIGlmICh0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpc1trT2JqZWN0XS5iYWNrZ3JvdW5kX2NvbG9yID0gdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAjZmZmZmZmYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBnZXQgYmFja2dyb3VuZENvbG9yKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5iYWNrZ3JvdW5kX2NvbG9yO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYDNgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIHNldCBwaXhlbFBlclB0KHQ6IG51bWJlciB8IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzW2tPYmplY3RdLnBpeGVsX3Blcl9wdCA9IHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZCBzZXQgaW4ge0BsaW5rIFJlbmRlclRvQ2FudmFzT3B0aW9uc30gaW5zdGVhZFxyXG4gICAqXHJcbiAgICogR2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYDNgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIGdldCBwaXhlbFBlclB0KCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5waXhlbF9wZXJfcHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBzdGF0ZVxyXG4gICAqL1xyXG4gIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wbHVnaW4ucmVzZXRTZXNzaW9uKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGRvY1dpZHRofSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0IGRvY193aWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX3dpZHRoO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRvY1dpZHRoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2Nfd2lkdGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgZG9jSGVpZ2h0fSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0IGRvY19oZWlnaHQoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY19oZWlnaHQ7XHJcbiAgfVxyXG5cclxuICBnZXQgZG9jSGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2NfaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVQYWdlc0luZm8oKTogUGFnZUluZm9bXSB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gdGhpc1trT2JqZWN0XS5wYWdlc19pbmZvO1xyXG4gICAgY29uc3QgcGFnZUluZm9zOiBQYWdlSW5mb1tdID0gW107XHJcbiAgICBjb25zdCBwYWdlQ291bnQgPSBwYWdlc19pbmZvLnBhZ2VfY291bnQ7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VDb3VudDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSBwYWdlc19pbmZvLnBhZ2UoaSk7XHJcbiAgICAgIHBhZ2VJbmZvcy5wdXNoKHtcclxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlQXN0LnBhZ2Vfb2ZmLFxyXG4gICAgICAgIHdpZHRoOiBwYWdlQXN0LndpZHRoX3B0LFxyXG4gICAgICAgIGhlaWdodDogcGFnZUFzdC5oZWlnaHRfcHQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwYWdlSW5mb3M7XHJcbiAgfVxyXG5cclxuICBnZXRTb3VyY2VMb2MocGF0aDogVWludDMyQXJyYXkpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuICh0aGlzW2tPYmplY3RdIGFzIHR5cHN0LlJlbmRlclNlc3Npb24pLnNvdXJjZV9zcGFuKHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclN2Z30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJTdmcob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbHVnaW4ucmVuZGVyU3ZnKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclRvU3ZnfSBmb3IgbW9yZSBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclRvU3ZnKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlckNhbnZhc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbHVnaW4ucmVuZGVyQ2FudmFzKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI21hbmlwdWxhdGVEYXRhfSBmb3IgbW9yZSBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IE1hbmlwdWxhdGVEYXRhT3B0aW9ucykge1xyXG4gICAgdGhpcy5wbHVnaW4ubWFuaXB1bGF0ZURhdGEoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICAuLi5vcHRzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyU3ZnRGlmZn0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJTdmdEaWZmKG9wdHM6IFJlbmRlclN2Z09wdGlvbnMpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclN2Z0RpZmYoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICAuLi5vcHRzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgZ2V0U291cmNlTG9jfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0X3NvdXJjZV9sb2MocGF0aDogVWludDMyQXJyYXkpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuICh0aGlzW2tPYmplY3RdIGFzIHR5cHN0LlJlbmRlclNlc3Npb24pLnNvdXJjZV9zcGFuKHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIHJlbmRlclN2Z0RpZmZ9IGluc3RlYWRcclxuICAgKi9cclxuICByZW5kZXJfaW5fd2luZG93KHJlY3RfbG9feDogbnVtYmVyLCByZWN0X2xvX3k6IG51bWJlciwgcmVjdF9oaV94OiBudW1iZXIsIHJlY3RfaGlfeTogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5yZW5kZXJfaW5fd2luZG93KHJlY3RfbG9feCwgcmVjdF9sb195LCByZWN0X2hpX3gsIHJlY3RfaGlfeSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgbWFuaXB1bGF0ZURhdGF9IGluc3RlYWRcclxuICAgKi9cclxuICBtZXJnZV9kZWx0YShkYXRhOiBVaW50OEFycmF5KSB7XHJcbiAgICB0aGlzLnBsdWdpbi5tYW5pcHVsYXRlRGF0YSh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIGFjdGlvbjogJ21lcmdlJyxcclxuICAgICAgZGF0YSxcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgZW51bSBNYW5hZ2VTdGF0dXMge1xyXG4gIERlbGV0ZSxcclxuICBOZXcsXHJcbiAgVXBkYXRlLFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHlwc3RXb3JrZXIge1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBba09iamVjdF06IHR5cHN0LlR5cHN0V29ya2VyO1xyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcGx1Z2luOiBUeXBzdFJlbmRlcmVyRHJpdmVyLFxyXG4gICAgbzogdHlwc3QuVHlwc3RXb3JrZXIsXHJcbiAgKSB7XHJcbiAgICB0aGlzW2tPYmplY3RdID0gbztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNtYW5pcHVsYXRlRGF0YX0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICBtYW5pcHVsYXRlRGF0YShhY3Rpb246IHN0cmluZywgZGF0YTogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ubWFuaXB1bGF0ZV9kYXRhKGFjdGlvbiwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBtYW5hZ2VkQ2FudmFzRWxlbUxpc3QgPSBuZXcgTWFwPHN0cmluZywgW01hbmFnZVN0YXR1cywgT2Zmc2NyZWVuUmVuZGVyQ2FudmFzT3B0aW9uc10+KCk7XHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgY2FudmFzQ291bnRlciA9IE1hdGgucmFuZG9tKCk7XHJcbiAgLyoqXHJcbiAgICogWW91IG11c3Qgc3VibWl0IGFsbCBjYW52YXMgaW4gcGFnZXMgdG8gZW5zdXJlIHN5bmNocm9uaXphdGlvbiB3aXRoIHRoZSBiYWNrZ3JvdW5kIHdvcmtlclxyXG4gICAqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlckNhbnZhc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMoY2FudmFzRWxlbUxpc3Q6IE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnNbXSk6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0W10+IHtcclxuICAgIGNvbnN0IG0gPSB0aGlzLm1hbmFnZWRDYW52YXNFbGVtTGlzdDtcclxuICAgIGZvciAoY29uc3QgW18sIGVsZW1dIG9mIG0pIHtcclxuICAgICAgZWxlbVswXSA9IE1hbmFnZVN0YXR1cy5EZWxldGU7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGNhbnZhc0VsZW1MaXN0KSB7XHJcbiAgICAgIGNvbnN0IGNhbnZhcyA9IGVsZW0uY2FudmFzO1xyXG4gICAgICBsZXQgZWxlbUlkID0gY2FudmFzLmRhdGFzZXQubWFuYWdlSWQ7XHJcbiAgICAgIGxldCBhY3Rpb24gPSBNYW5hZ2VTdGF0dXMuVXBkYXRlO1xyXG4gICAgICBpZiAoIWVsZW1JZCkge1xyXG4gICAgICAgIGVsZW1JZCA9IHRoaXMuY2FudmFzQ291bnRlci50b0ZpeGVkKDUpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ291bnRlciArPSAxO1xyXG4gICAgICAgIGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkID0gZWxlbUlkO1xyXG4gICAgICAgIGFjdGlvbiA9IE1hbmFnZVN0YXR1cy5OZXc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBwcmV2ID0gbS5nZXQoZWxlbUlkKTtcclxuICAgICAgaWYgKHByZXYgJiYgcHJldlswXSAhPT0gTWFuYWdlU3RhdHVzLkRlbGV0ZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2Fubm90IHVwZGF0ZSBhIGNhbnZhcyBmb3IgdHdvIHRpbWVzIGluIGJhdGNoJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG0uc2V0KGVsZW1JZCwgW2FjdGlvbiwgeyAuLi5lbGVtIH1dKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShtLmVudHJpZXMoKSk7XHJcbiAgICBjb25zdCBhY3Rpb25zID0gbmV3IFVpbnQ4QXJyYXkoZW50cmllcy5sZW5ndGgpO1xyXG4gICAgY29uc3QgZWxlbWVudHMgPSBuZXcgQXJyYXkoZW50cmllcy5sZW5ndGgpO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IGVudHJpZXMubWFwKChba2V5LCBbYWN0aW9uLCBlbGVtXV0sIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmICghYWN0aW9uKSB7XHJcbiAgICAgICAgbS5kZWxldGUoa2V5KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYWN0aW9uc1tpbmRleF0gPSBhY3Rpb247XHJcbiAgICAgIGVsZW1lbnRzW2luZGV4XSA9IGVsZW0uY2FudmFzO1xyXG4gICAgICByZXR1cm4gdGhpcy5wbHVnaW4uY2FudmFzT3B0aW9uc1RvUnVzdChlbGVtKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLnJlbmRlcl9jYW52YXMoYWN0aW9ucywgZWxlbWVudHMsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmV0cmlldmVQYWdlc0luZm8oKTogUHJvbWlzZTxQYWdlSW5mb1tdPiB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gYXdhaXQgdGhpc1trT2JqZWN0XS5nZXRfcGFnZXNfaW5mbygpO1xyXG4gICAgY29uc29sZS5sb2cocGFnZXNfaW5mbyk7XHJcbiAgICBjb25zdCBwYWdlSW5mb3M6IFBhZ2VJbmZvW10gPSBbXTtcclxuICAgIGNvbnN0IHBhZ2VDb3VudCA9IHBhZ2VzX2luZm8ucGFnZV9jb3VudDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZUNvdW50OyBpKyspIHtcclxuICAgICAgY29uc3QgcGFnZUFzdCA9IHBhZ2VzX2luZm8ucGFnZShpKTtcclxuICAgICAgcGFnZUluZm9zLnB1c2goe1xyXG4gICAgICAgIHBhZ2VPZmZzZXQ6IHBhZ2VBc3QucGFnZV9vZmYsXHJcbiAgICAgICAgd2lkdGg6IHBhZ2VBc3Qud2lkdGhfcHQsXHJcbiAgICAgICAgaGVpZ2h0OiBwYWdlQXN0LmhlaWdodF9wdCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBhZ2VJbmZvcztcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGUgaW50ZXJmYWNlIG9mIFR5cHN0IHJlbmRlcmVyLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdFJlbmRlcmVyIGV4dGVuZHMgVHlwc3RTdmdSZW5kZXJlciB7XHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSB0aGUgdHlwc3QgcmVuZGVyZXIuXHJcbiAgICogQHBhcmFtIHtQYXJ0aWFsPEluaXRPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlXHJcbiAgICogdHlwc3QgcmVuZGVyZXIuXHJcbiAgICovXHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBMb2FkIGEgZ2x5cGggcGFjayBmb3IgYWxsIG9mIHRoZSBUeXBzdCBkb2N1bWVudHMgdG8gcmVuZGVyLlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgc3RpbGwgdW5kZXIgZGV2ZWxvcG1lbnQuXHJcbiAgICogQHBhcmFtIHBhY2tcclxuICAgKi9cclxuICBsb2FkR2x5cGhQYWNrKHBhY2s6IHVua25vd24pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBzdGF0ZVxyXG4gICAqL1xyXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogUmV0cmlldmUgcGFnZSBpbmZvcm1hdGlvbiBvZiBjdXJyZW50IHNlbGVjdGVkIGRvY3VtZW50XHJcbiAgICovXHJcbiAgcmV0cmlldmVQYWdlc0luZm9Gcm9tU2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogUGFnZUluZm9bXTtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqL1xyXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBjYW52YXMuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxyXG4gICAqIEByZXR1cm5zIHt2b2lkfSAtIFRoZSByZXN1bHQgb2YgcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiByZW5kZXJlci5yZW5kZXJUb0NhbnZhcyh7XHJcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgIHBpeGVsUGVyUHQ6IDMsXHJcbiAgICogICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJyxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyVG9DYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gKG5vbi1pbmNyZW1lbnRhbCkgc3ZnIHN0cmluZy5cclxuICAgKiBAcGFyYW0ge1JlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVGhlIHJlbmRlcmVkIGNvbnRlbnQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiBjb25zdCBzdmcgPSByZW5kZXJlci5yZW5kZXJTdmcoe1xyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBhd2FpdCBmZXRjaERvYygndHlwc3QtbWFpbi5zaXIuaW4nKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICByZW5kZXJTdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IFByb21pc2U8c3RyaW5nPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3ZnLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBsZXQgZmV0Y2hEb2MgPSAocGF0aCkgPT4gZmV0Y2gocGF0aCkudGhlbihcclxuICAgKiAgIHJlc3BvbnNlID0+IG5ldyBVaW50OEFycmF5KHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpKVxyXG4gICAqIHJlbmRlcmVyLnJlbmRlclRvU3ZnKHtcclxuICAgKiAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBhd2FpdCBmZXRjaERvYygndHlwc3QtbWFpbi5zaXIuaW4nKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gc2VsZWN0ZWQgY3VycmVudCBzdmdcclxuICAgKi9cclxuICBnZXRDdXN0b21WMShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPHt9Pik6IFByb21pc2U8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnRGlmZihvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+KTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBNYW5pcHVsYXRlIHRoZSBUeXBzdCBkb2N1bWVudCBpbiB0aGUgc2Vzc2lvbi5cclxuICAgKiBTZWUge0BsaW5rIE1hbmlwdWxhdGVEYXRhT3B0aW9uc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKiBAcGFyYW0ge1JlbmRlclNlc3Npb259IHNlc3Npb24gLSBUaGUgVHlwc3QgZG9jdW1lbnQgc2Vzc2lvbiB0aGF0IGhhcyBiZWVuXHJcbiAgICogY3JlYXRlZCBieSBUeXBzdFJlbmRlcmVyLlxyXG4gICAqIEBwYXJhbSB7TWFuaXB1bGF0ZURhdGFPcHRpb25zfSBvcHRzIC0gVGhlIG9wdGlvbnMgZm9yIG1hbmlwdWxhdGluZyB0aGVcclxuICAgKiBUeXBzdCBkb2N1bWVudCBpbiB0aGUgc2Vzc2lvbi5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogcmVzZXQgdGhlIGRhdGEgdG8gdGhlIGluaXRpYWwgc3RhdGUuXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZW5kZXJlci5jcmVhdGVTZXNzaW9uKC4uLik7XHJcbiAgICogYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwge1xyXG4gICAqICAgYWN0aW9uOiAncmVzZXQnLFxyXG4gICAqICAgZGF0YTogbmV3IFVpbnQ4QXJyYXkoLi4uKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIG1lcmdlIHRoZSBkYXRhIHRvIHRoZSBjdXJyZW50IHN0YXRlLlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVuZGVyZXIuY3JlYXRlU2Vzc2lvbiguLi4pO1xyXG4gICAqIC8vLyByZXNldCB0aGUgZGF0YSB0byB0aGUgaW5pdGlhbCBzdGF0ZVxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ3Jlc2V0JykpO1xyXG4gICAqIC8vLyBtZXJnZSB0aGUgZGF0YSB0byB0aGUgY3VycmVudCBzdGF0ZVxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ21lcmdlJykpO1xyXG4gICAqIC8vLyBpbmNyZW1lbnRhbGx5IG1lcmdlIHRoZSBkYXRhIGFnYWluXHJcbiAgICogYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwgZGF0YSgnbWVyZ2UnKSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgbWFuaXB1bGF0ZURhdGEob3B0czogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxNYW5pcHVsYXRlRGF0YU9wdGlvbnM+KTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogUnVuIGEgZnVuY3Rpb24gd2l0aCBhIHNlc3Npb24sIGFuZCB0aGUgc2Vzc2lvbiBpcyBvbmx5IGF2YWlsYWJsZSBkdXJpbmdcclxuICAgKiB0aGUgZnVuY3Rpb24gY2FsbC5cclxuICAgKlxyXG4gICAqIHRoZSBsaWZldGltZSBvZiBzZXNzaW9uIGlzIHF1aXRlIGJ1Zy1wcm9uZSwgc28gd2UgY3VycmVudCBkb2VzIG5vdCBtYWtlIGl0XHJcbiAgICogbG9uZ2VyIGxpdmUgdGhhbiB0aGUgZnVuY3Rpb24gY2FsbC5cclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbiAtIFRoZSBmdW5jdGlvbiB0byBydW4gd2l0aCBhIHNlc3Npb24uXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8VD59IC0gVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24uXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBydW4gYSBmdW5jdGlvbiB3aXRoIGFuIHNlc3Npb24gd2l0aCBlbXB0eSBzdGF0ZS5cclxuICAgKlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCByZXMgPSBhd2FpdCByZW5kZXJlci5ydW5XaXRoU2Vzc2lvbihhc3luYyBzZXNzaW9uID0+IHtcclxuICAgKiAgIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ3Jlc2V0JykpO1xyXG4gICAqICAgcmV0dXJuIGF3YWl0IHJlbmRlcmVyLnJlbmRlclRvQ2FudmFzKHtcclxuICAgKiAgICAgcmVuZGVyU2Vzc2lvbjogc2Vzc2lvbixcclxuICAgKiAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAgICogICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLFxyXG4gICAqICAgfSk7XHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIHJ1biBhIGZ1bmN0aW9uIHdpdGggYW4gc2Vzc2lvbiB3aXRoIGluaXRpYWwgc3RhdGUuXHJcbiAgICpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3QgcmVzID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oe1xyXG4gICAqICAgZm9ybWF0OiAndmVjdG9yJyxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogbmV3IFVpbnQ4QXJyYXkoLi4uKSxcclxuICAgKiB9LCB3b3JrV2l0aFNlc3Npb24oc2Vzc2lvbikpO1xyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBsZWFrIHRoZSBsaWZlIHNwYW4gb2Ygc2Vzc2lvbiAobmVlZCB0eXBlc2NyaXB0ID49IHY1LjIpXHJcbiAgICpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY2xhc3MgU3RhY2tlZFNlc3Npb24ge1xyXG4gICAqICAgc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbjtcclxuICAgKiAgIHByaXZhdGUgcmVzb2x2ZTogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IHZvaWQ7XHJcbiAgICogICBbU3ltYm9sLmRpc3Bvc2VdKCkge1xyXG4gICAqICAgICB0aGlzLnJlc29sdmUoKTtcclxuICAgKiAgIH1cclxuICAgKiAgIHN0YXRpYyBhc3luYyBjcmVhdGUoKSB7XHJcbiAgICogICAgIHJldHVybiBuZXcgUHJvbWlzZTxTdGFja2VkU2Vzc2lvbj4ocmVzb2x2ZSA9PiB7XHJcbiAgICogICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHJlbmRlcmVyLnJ1bldpdGhTZXNzaW9uKHNlc3Npb24gPT4ge1xyXG4gICAqICAgICAgIGNvbnN0IHN0YWNrZWRTZXNzaW9uID0gbmV3IFN0YWNrZWRTZXNzaW9uKCk7XHJcbiAgICogICAgICAgc3RhY2tlZFNlc3Npb24uc2Vzc2lvbiA9IHNlc3Npb247XHJcbiAgICogICAgICAgc3RhY2tlZFNlc3Npb24ucmVzb2x2ZSA9IHJlc29sdmU7XHJcbiAgICogICAgICAgcmV0dXJuIHN0YWNrZWRTZXNzaW9uO1xyXG4gICAqICAgICB9KTtcclxuICAgKiAgIH1cclxuICAgKiB9XHJcbiAgICpcclxuICAgKiB7XHJcbiAgICogICBhd2FpdCB1c2luZyBzZXNzaW9uID0gU3RhY2tlZFNlc3Npb24uY3JlYXRlKCk7XHJcbiAgICogICAvLy8gZG8gc29tZXRoaW5nIHdpdGggc2Vzc2lvblxyXG4gICAqIH1cclxuICAgKiBgYGBcclxuICAgKi9cclxuICBydW5XaXRoU2Vzc2lvbjxUPihmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xyXG4gIHJ1bldpdGhTZXNzaW9uPFQ+KFxyXG4gICAgb3B0aW9uczogQ3JlYXRlU2Vzc2lvbk9wdGlvbnMsXHJcbiAgICBmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4sXHJcbiAgKTogUHJvbWlzZTxUPjtcclxuXHJcbiAgY3JlYXRlV29ya2VyVjAod29ya2VyOiBXb3JrZXIpOiBQcm9taXNlPFR5cHN0V29ya2VyPjtcclxuXHJcbiAgcmVuZGVyRG9tKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TW91bnREb21PcHRpb25zPik6IFByb21pc2U8VHlwc3REb21Eb2N1bWVudD47XHJcblxyXG4gIC8qKlxyXG4gICAqIGFsaWFzIHRvIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclRvQ2FudmFzfSwgd2lsbCByZW1vdmUgaW4gdjAuNS4wXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIHJlbmRlclRvQ2FudmFzfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgcmVuZGVyKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmNvbnN0IGdSZW5kZXJlck1vZHVsZSA9IChtb2R1bGU6IHR5cGVvZiB0eXBzdCkgPT5cclxuICBuZXcgTGF6eVdhc21Nb2R1bGUoYXN5bmMgKGJpbj86IGFueSkgPT4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IG1vZHVsZS5kZWZhdWx0KGJpbik7XHJcbiAgfSk7XHJcblxyXG4vKipcclxuICogY3JlYXRlIGEgVHlwc3QgcmVuZGVyZXIuXHJcbiAqIEByZXR1cm5zIHtUeXBzdFJlbmRlcmVyfSAtIFRoZSBUeXBzdCByZW5kZXJlci5cclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBpbXBvcnQgeyBjcmVhdGVUeXBzdFJlbmRlcmVyIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBjb25zdCByZW5kZXJlciA9IGNyZWF0ZVR5cHN0UmVuZGVyZXIoKTtcclxuICogYXdhaXQgcmVuZGVyZXIuaW5pdCgpO1xyXG4gKiBhd2FpdCByZW5kZXJlci5yZW5kZXIoe1xyXG4gKiAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gKiAgIGFydGlmYWN0Q29udGVudDogJ3sgLi4uIH0nLFxyXG4gKiB9KTtcclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwc3RSZW5kZXJlcigpOiBUeXBzdFJlbmRlcmVyIHtcclxuICByZXR1cm4gbmV3IFR5cHN0UmVuZGVyZXJEcml2ZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdFN2Z1JlbmRlcmVyIHtcclxuICBpbml0KG9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPik6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIHN2ZyBzZXNzaW9uLlxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayBUeXBzdFJlbmRlcmVyWydydW5XaXRoU2Vzc2lvbiddfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgY3JlYXRlTW9kdWxlKGI6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPFJlbmRlclNlc3Npb24+O1xyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBzdmcuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxyXG4gICAqIEByZXR1cm5zIHt2b2lkfSAtIFRoZSByZXN1bHQgb2YgcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiByZW5kZXJlci5yZW5kZXJUb1N2Zyh7XHJcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyVG9Tdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+KTogUHJvbWlzZTxib29sZWFuPjtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBkZXByZWNhdGVkXHJcbiAqIHVzZSB7QGxpbmsgY3JlYXRlVHlwc3RSZW5kZXJlcn0gaW5zdGVhZFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVR5cHN0U3ZnUmVuZGVyZXIoKTogVHlwc3RTdmdSZW5kZXJlciB7XHJcbiAgcmV0dXJuIG5ldyBUeXBzdFJlbmRlcmVyRHJpdmVyKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW5kZXJlckJ1aWxkSW5mbygpOiBQcm9taXNlPGFueT4ge1xyXG4gIGNvbnN0IHJlbmRlck1vZHVsZSA9IGF3YWl0IGltcG9ydCgnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXIvcGtnL3dhc20tcGFjay1zaGltLm1qcycpO1xyXG4gIHJldHVybiByZW5kZXJNb2R1bGUucmVuZGVyZXJfYnVpbGRfaW5mbygpO1xyXG59XHJcblxyXG5sZXQgd2Fybk9uY2VDYW52YXNTZXQgPSB0cnVlO1xyXG5cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5leHBvcnQgY2xhc3MgVHlwc3RSZW5kZXJlckRyaXZlciB7XHJcbiAgcmVuZGVyZXI6IHR5cHN0LlR5cHN0UmVuZGVyZXI7XHJcbiAgcmVuZGVyZXJKczogdHlwZW9mIHR5cHN0O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHt9XHJcblxyXG4gIGFzeW5jIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0aGlzLnJlbmRlcmVySnMgPSBhd2FpdCAob3B0aW9ucz8uZ2V0V3JhcHBlcj8uKCkgfHxcclxuICAgICAgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlci9wa2cvd2FzbS1wYWNrLXNoaW0ubWpzJykpO1xyXG4gICAgY29uc3QgVHlwc3RSZW5kZXJlckJ1aWxkZXIgPSB0aGlzLnJlbmRlcmVySnMuVHlwc3RSZW5kZXJlckJ1aWxkZXI7XHJcbiAgICB0aGlzLnJlbmRlcmVyID0gYXdhaXQgYnVpbGRDb21wb25lbnQoXHJcbiAgICAgIG9wdGlvbnMsXHJcbiAgICAgIGdSZW5kZXJlck1vZHVsZSh0aGlzLnJlbmRlcmVySnMpLFxyXG4gICAgICBUeXBzdFJlbmRlcmVyQnVpbGRlcixcclxuICAgICAge30sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbG9hZEdseXBoUGFjayhfcGFjazogdW5rbm93bik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8gdGhpcy5yZW5kZXJlci5sb2FkX2dseXBoX3BhY2socGFjayk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZU9wdGlvbnNUb1J1c3Qob3B0aW9uczogUGFydGlhbDxDcmVhdGVTZXNzaW9uT3B0aW9ucz4pOiB0eXBzdC5DcmVhdGVTZXNzaW9uT3B0aW9ucyB7XHJcbiAgICBjb25zdCBydXN0T3B0aW9ucyA9IG5ldyB0aGlzLnJlbmRlcmVySnMuQ3JlYXRlU2Vzc2lvbk9wdGlvbnMoKTtcclxuXHJcbiAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5mb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5hcnRpZmFjdENvbnRlbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5hcnRpZmFjdF9jb250ZW50ID0gb3B0aW9ucy5hcnRpZmFjdENvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJ1c3RPcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgY2FudmFzT3B0aW9uc1RvUnVzdChvcHRpb25zOiBSZW5kZXJDYW52YXNPcHRpb25zKTogdHlwc3QuUmVuZGVyUGFnZUltYWdlT3B0aW9ucyB7XHJcbiAgICBjb25zdCBydXN0T3B0aW9ucyA9IG5ldyB0aGlzLnJlbmRlcmVySnMuUmVuZGVyUGFnZUltYWdlT3B0aW9ucygpO1xyXG4gICAgaWYgKG9wdGlvbnMucGFnZU9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcigncGFnZU9mZnNldCBpcyByZXF1aXJlZCBpbiByZWZsZXhvIHYwLjUuMCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcnVzdE9wdGlvbnMucGFnZV9vZmYgPSBvcHRpb25zLnBhZ2VPZmZzZXQ7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5jYWNoZUtleSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLmNhY2hlX2tleSA9IG9wdGlvbnMuY2FjaGVLZXk7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5iYWNrZ3JvdW5kX2NvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5waXhlbFBlclB0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMucGl4ZWxfcGVyX3B0ID0gb3B0aW9ucy5waXhlbFBlclB0O1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGxldCBlbmNvZGVkID0gMDtcclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbi5ib2R5KSB7XHJcbiAgICAgICAgZW5jb2RlZCB8PSAxIDw8IDA7XHJcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jYW52YXMgJiYgd2Fybk9uY2VDYW52YXNTZXQpIHtcclxuICAgICAgICB3YXJuT25jZUNhbnZhc1NldCA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnNvbGUud2FybignZGF0YVNlbGVjdGlvbi5ib2R5IGlzIG5vdCBzZXQgYnV0IHByb3ZpZGluZyBjYW52YXMgZm9yIGJvZHknKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uLnRleHQgfHwgb3B0aW9ucy5kYXRhU2VsZWN0aW9uLmFubm90YXRpb24pIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdkYXRhU2VsZWN0aW9uLnRleHQgYW5kIGRhdGFTZWxlY3Rpb24uYW5ub3RhdGlvbiBhcmUgZGVwcmVjYXRlZCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24uc2VtYW50aWNzKSB7XHJcbiAgICAgICAgZW5jb2RlZCB8PSAxIDw8IDM7XHJcbiAgICAgIH1cclxuICAgICAgcnVzdE9wdGlvbnMuZGF0YV9zZWxlY3Rpb24gPSBlbmNvZGVkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJ1c3RPcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVQYWdlc0luZm9Gcm9tU2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogUGFnZUluZm9bXSB7XHJcbiAgICByZXR1cm4gc2Vzc2lvbi5yZXRyaWV2ZVBhZ2VzSW5mbygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqL1xyXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+IHtcclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9wYWdlX3RvX2NhbnZhcyhcclxuICAgICAgICBzZXNzaW9uUmVmW2tPYmplY3RdLFxyXG4gICAgICAgIG9wdGlvbnMuY2FudmFzIHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB0aGlzLmNhbnZhc09wdGlvbnNUb1J1c3Qob3B0aW9ucyksXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGFzeW5jIHJlbmRlclBkZihhcnRpZmFjdENvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8VWludDhBcnJheT4ge1xyXG4gIC8vIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl90b19wZGYoYXJ0aWZhY3RDb250ZW50KTtcclxuICAvLyB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgaW5BbmltYXRpb25GcmFtZTxUPihmbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgcmVzb2x2ZShmbigpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJEaXNwbGF5TGF5ZXIoXHJcbiAgICBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uLFxyXG4gICAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXSxcclxuICAgIG9wdGlvbnM6IFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcclxuICApOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdFtdPiB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gc2Vzc2lvbltrT2JqZWN0XS5wYWdlc19pbmZvO1xyXG4gICAgY29uc3QgcGFnZV9jb3VudCA9IHBhZ2VzX2luZm8ucGFnZV9jb3VudDtcclxuXHJcbiAgICBjb25zdCBkb1JlbmRlciA9IGFzeW5jIChpOiBudW1iZXIsIHBhZ2Vfb2ZmOiBudW1iZXIpID0+IHtcclxuICAgICAgY29uc3QgY2FudmFzID0gY2FudmFzTGlzdFtpXTtcclxuICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgIGlmICghY3R4KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW52YXMgY29udGV4dCBpcyBudWxsJyk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVuZGVyQ2FudmFzKHtcclxuICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgIGNhbnZhczogY3R4LFxyXG4gICAgICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXHJcbiAgICAgICAgcGFnZU9mZnNldDogcGFnZV9vZmYsXHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBjb25zdCB0ZXh0Q29udGVudExpc3QgPSBhd2FpdCAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHRzOiBSZW5kZXJDYW52YXNSZXN1bHRbXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VfY291bnQ7IGkrKykge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChhd2FpdCB0aGlzLmluQW5pbWF0aW9uRnJhbWUoKCkgPT4gZG9SZW5kZXIoaSwgaSkpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9KSgpO1xyXG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgZGlzcGxheSBsYXllciB1c2VkOiByZW5kZXIgPSAkeyh0MiAtIHQpLnRvRml4ZWQoMSl9bXNgKTtcclxuXHJcbiAgICByZXR1cm4gdGV4dENvbnRlbnRMaXN0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJUZXh0TGF5ZXIobGF5ZXJMaXN0OiBIVE1MRGl2RWxlbWVudFtdLCB0ZXh0U291cmNlTGlzdDogUmVuZGVyQ2FudmFzUmVzdWx0W10pIHtcclxuICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBsYXllckxpc3QuZm9yRWFjaCgobGF5ZXIsIGkpID0+IHtcclxuICAgICAgbGF5ZXIuaW5uZXJIVE1MID0gdGV4dFNvdXJjZUxpc3RbaV0uaHRtbFNlbWFudGljc1swXTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgdDMgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGNvbnNvbGUubG9nKGB0ZXh0IGxheWVyIHVzZWQ6IHJlbmRlciA9ICR7KHQzIC0gdDIpLnRvRml4ZWQoMSl9bXNgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJlbmRlcihvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICgnZm9ybWF0JyBpbiBvcHRpb25zKSB7XHJcbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gJ3ZlY3RvcicpIHtcclxuICAgICAgICBjb25zdCBhcnRpZmFjdEZvcm1hdHMgPSBbJ3NlcmRlX2pzb24nLCAnanMnLCAnaXInXSBhcyBjb25zdDtcclxuICAgICAgICBpZiAoYXJ0aWZhY3RGb3JtYXRzLmluY2x1ZGVzKG9wdGlvbnMuZm9ybWF0IGFzIGFueSkpIHtcclxuICAgICAgICAgIC8vIGRlcHJlY2F0ZWRcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZGVwcmVjYXRlZCBmb3JtYXQgJHtvcHRpb25zLmZvcm1hdH0sIHBsZWFzZSB1c2UgdmVjdG9yIGZvcm1hdGApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnJlbmRlclRvQ2FudmFzKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVuZGVyRG9tKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TW91bnREb21PcHRpb25zPik6IFByb21pc2U8VHlwc3REb21Eb2N1bWVudD4ge1xyXG4gICAgaWYgKCdmb3JtYXQnIGluIG9wdGlvbnMpIHtcclxuICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSAndmVjdG9yJykge1xyXG4gICAgICAgIGNvbnN0IGFydGlmYWN0Rm9ybWF0cyA9IFsnc2VyZGVfanNvbicsICdqcycsICdpciddIGFzIGNvbnN0O1xyXG4gICAgICAgIGlmIChhcnRpZmFjdEZvcm1hdHMuaW5jbHVkZXMob3B0aW9ucy5mb3JtYXQgYXMgYW55KSkge1xyXG4gICAgICAgICAgLy8gZGVwcmVjYXRlZFxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBkZXByZWNhdGVkIGZvcm1hdCAke29wdGlvbnMuZm9ybWF0fSwgcGxlYXNlIHVzZSB2ZWN0b3IgZm9ybWF0YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcclxuICAgICAgY29uc3QgdCA9IG5ldyBUeXBzdERvbURvY3VtZW50KHtcclxuICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgIHJlbmRlck1vZGU6ICdkb20nLFxyXG4gICAgICAgIGhvb2tlZEVsZW06IG9wdGlvbnMuY29udGFpbmVyLFxyXG4gICAgICAgIGtNb2R1bGU6IHNlc3Npb25SZWYsXHJcbiAgICAgICAgcmVuZGVyZXI6IHRoaXMsXHJcbiAgICAgIH0pO1xyXG4gICAgICB0O1xyXG4gICAgICBhd2FpdCB0LmltcGwubW91bnREb20ob3B0aW9ucy5waXhlbFBlclB0KTtcclxuICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJlbmRlclRvQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgbGV0IHNlc3Npb246IFJlbmRlclNlc3Npb247XHJcbiAgICBsZXQgcmVuZGVyUGFnZVJlc3VsdHM6IFJlbmRlckNhbnZhc1Jlc3VsdFtdO1xyXG4gICAgY29uc3QgbW91bnRDb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjtcclxuICAgIG1vdW50Q29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuXHJcbiAgICBjb25zdCBkb1JlbmRlckRpc3BsYXlMYXllciA9IGFzeW5jIChcclxuICAgICAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXSxcclxuICAgICAgcmVzZXRMYXlvdXQ6ICgpID0+IHZvaWQsXHJcbiAgICApID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZW5kZXJQYWdlUmVzdWx0cyA9IGF3YWl0IHRoaXMucmVuZGVyRGlzcGxheUxheWVyKHNlc3Npb24sIGNhbnZhc0xpc3QsIG9wdGlvbnMpO1xyXG4gICAgICAgIHJlc2V0TGF5b3V0KCk7XHJcbiAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgbW91bnRDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBzZXNzaW9uID0gc2Vzc2lvblJlZjtcclxuICAgICAgaWYgKHNlc3Npb25ba09iamVjdF0ucGFnZXNfaW5mby5wYWdlX2NvdW50ID09PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBwYWdlIGZvdW5kIGluIHNlc3Npb25gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdGlvbnMucGl4ZWxQZXJQdCAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMucGl4ZWxQZXJQdCA8PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgJ0ludmFsaWQgdHlwc3QuUmVuZGVyT3B0aW9ucy5waXhlbFBlclB0LCBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXIgJyArXHJcbiAgICAgICAgICAgIG9wdGlvbnMucGl4ZWxQZXJQdCxcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgYmFja2dyb3VuZENvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICAgIGlmIChiYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGlmICghL14jWzAtOWEtZl17Nn0kLy50ZXN0KGJhY2tncm91bmRDb2xvcikpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgICAgJ0ludmFsaWQgdHlwc3QuYmFja2dyb3VuZENvbG9yIGNvbG9yIGZvciBtYXRjaGluZyBeIz9bMC05YS1mXXs2fSQgJyArIGJhY2tncm91bmRDb2xvcixcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBzZXNzaW9uLnBpeGVsUGVyUHQgPSBvcHRpb25zLnBpeGVsUGVyUHQgPz8gVHlwc3REZWZhdWx0UGFyYW1zLlBJWEVMX1BFUl9QVDtcclxuICAgICAgc2Vzc2lvbi5iYWNrZ3JvdW5kQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3IgPz8gJyNmZmZmZmYnO1xyXG5cclxuICAgICAgY29uc3QgdCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgICAgY29uc3QgcGFnZVZpZXcgPSBuZXcgUmVuZGVyVmlldyhcclxuICAgICAgICB0aGlzLnJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbiksXHJcbiAgICAgICAgbW91bnRDb250YWluZXIsXHJcbiAgICAgICAgb3B0aW9ucyxcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGBsYXllciB1c2VkOiByZXRyaWV2ZSA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xyXG5cclxuICAgICAgYXdhaXQgZG9SZW5kZXJEaXNwbGF5TGF5ZXIocGFnZVZpZXcuY2FudmFzTGlzdCwgKCkgPT4gcGFnZVZpZXcucmVzZXRMYXlvdXQoKSk7XHJcbiAgICAgIHRoaXMucmVuZGVyVGV4dExheWVyKHBhZ2VWaWV3LnRleHRMYXllckxpc3QsIHJlbmRlclBhZ2VSZXN1bHRzKTtcclxuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlTW9kdWxlKGI/OiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFxyXG4gICAgICBuZXcgUmVuZGVyU2Vzc2lvbihcclxuICAgICAgICB0aGlzLFxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuY3JlYXRlX3Nlc3Npb24oXHJcbiAgICAgICAgICBiICYmXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0aW9uc1RvUnVzdCh7XHJcbiAgICAgICAgICAgICAgZm9ybWF0OiAndmVjdG9yJyxcclxuICAgICAgICAgICAgICBhcnRpZmFjdENvbnRlbnQ6IGIsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICksXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY3JlYXRlV29ya2VyVjAod29ya2VyOiBXb3JrZXIpIHtcclxuICAgIHJldHVybiBuZXcgVHlwc3RXb3JrZXIodGhpcywgYXdhaXQgdGhpcy5yZW5kZXJlci5jcmVhdGVfd29ya2VyKHdvcmtlcikpO1xyXG4gIH1cclxuXHJcbiAgd29ya2VyQnJpZGdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIuY3JlYXRlX3dvcmtlcl9icmlkZ2UoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+LCBjb250YWluZXI/OiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBSZW5kZXJTZXNzaW9uIHx8IGNvbnRhaW5lcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZWQgYXBpLCBwbGVhc2UgdXNlIHJlbmRlclRvU3ZnKHsgcmVuZGVyU2Vzc2lvbiwgY29udGFpbmVyIH0pIGluc3RlYWQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBsZXQgcGFydHM6IG51bWJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24pIHtcclxuICAgICAgICBwYXJ0cyA9IDA7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uYm9keSkge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5kZWZzKSB7XHJcbiAgICAgICAgICBwYXJ0cyB8PSAxIDw8IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uLmNzcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5qcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLnJlbmRlcmVyLnN2Z19kYXRhKHNlc3Npb25SZWZba09iamVjdF0sIHBhcnRzKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZyB7XHJcbiAgICBpZiAoIW9wdGlvbnMud2luZG93KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9zdmdfZGlmZihcclxuICAgICAgICAob3B0aW9ucy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0sXHJcbiAgICAgICAgMCxcclxuICAgICAgICAwLFxyXG4gICAgICAgIDFlMzMsXHJcbiAgICAgICAgMWUzMyxcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnX2RpZmYoXHJcbiAgICAgIChvcHRpb25zLnJlbmRlclNlc3Npb24gYXMgYW55KVtrT2JqZWN0XSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnKHNlc3Npb25SZWZba09iamVjdF0sIG9wdGlvbnMuY29udGFpbmVyKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEN1c3RvbVYxKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8e30+KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5nZXRfY3VzdG9tcyhvcHRpb25zLnJlbmRlclNlc3Npb25ba09iamVjdF0pKTtcclxuICB9XHJcblxyXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZCB7XHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZXNldChzZXNzaW9uW2tPYmplY3RdKTtcclxuICB9XHJcblxyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TWFuaXB1bGF0ZURhdGFPcHRpb25zPik6IHZvaWQge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIubWFuaXB1bGF0ZV9kYXRhKFxyXG4gICAgICAob3B0cy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0gYXMgdHlwc3QuUmVuZGVyU2Vzc2lvbixcclxuICAgICAgb3B0cy5hY3Rpb24gPz8gJ3Jlc2V0JyxcclxuICAgICAgb3B0cy5kYXRhLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgd2l0aGluT3B0aW9uU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55PixcclxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGZ1bmN0aW9uIGlzUmVuZGVyQnlDb250ZW50T3B0aW9uKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55Pik6IG9wdGlvbnMgaXMgQ3JlYXRlU2Vzc2lvbk9wdGlvbnMge1xyXG4gICAgICByZXR1cm4gJ2FydGlmYWN0Q29udGVudCcgaW4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJ3JlbmRlclNlc3Npb24nIGluIG9wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIGZuKG9wdGlvbnMucmVuZGVyU2Vzc2lvbiBhcyBSZW5kZXJTZXNzaW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNSZW5kZXJCeUNvbnRlbnRPcHRpb24ob3B0aW9ucykpIHtcclxuICAgICAgLy8gdG9kbzogcmVtb3ZlIGFueVxyXG4gICAgICByZXR1cm4gdGhpcy5ydW5XaXRoU2Vzc2lvbihvcHRpb25zIGFzIGFueSwgZm4gYXMgYW55KTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICdJbnZhbGlkIHJlbmRlciBvcHRpb25zLCBzaG91bGQgYmUgb25lIG9mIFJlbmRlckJ5Q29udGVudE9wdGlvbnN8UmVuZGVyQnlTZXNzaW9uT3B0aW9ucycsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcclxuICBydW5XaXRoU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxyXG4gICk6IFByb21pc2U8VD47XHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oYXJnMTogYW55LCBhcmcyPzogYW55KTogUHJvbWlzZTxUPiB7XHJcbiAgICBsZXQgb3B0aW9uczogUGFydGlhbDxDcmVhdGVTZXNzaW9uT3B0aW9ucz4gfCB1bmRlZmluZWQgPSBhcmcxO1xyXG4gICAgbGV0IGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPiA9IGFyZzI7XHJcblxyXG4gICAgaWYgKCFhcmcyKSB7XHJcbiAgICAgIG9wdGlvbnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGZuID0gYXJnMTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5yZW5kZXJlci5jcmVhdGVfc2Vzc2lvbihcclxuICAgICAgLyogbW92ZWQgKi8gb3B0aW9ucyAmJiB0aGlzLmNyZWF0ZU9wdGlvbnNUb1J1c3Qob3B0aW9ucyksXHJcbiAgICApO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZm4obmV3IFJlbmRlclNlc3Npb24odGhpcywgc2Vzc2lvbikpO1xyXG4gICAgICBzZXNzaW9uLmZyZWUoKTtcclxuICAgICAgcmV0dXJuIHJlcztcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgc2Vzc2lvbi5mcmVlKCk7XHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==","import { buildComponent } from './init.mjs';\nimport { kObject } from './internal.types.mjs';\nimport { preloadRemoteFonts } from './options.init.mjs';\nimport { LazyWasmModule } from './wasm.mjs';\nexport class IncrementalServer {\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(s) {\n        this[kObject] = s;\n    }\n    /**\n     * Reset the incremental server to the initial state.\n     */\n    reset() {\n        this[kObject].reset();\n    }\n    /**\n     * Return current result.\n     */\n    current() {\n        return this[kObject].current();\n    }\n    /**\n     * Also attach the debug info to the result.\n     */\n    setAttachDebugInfo(enable) {\n        this[kObject].set_attach_debug_info(enable);\n    }\n}\nconst gCompilerModule = new LazyWasmModule(async (bin) => {\n    const module = await import('@myriaddreamin/typst-ts-web-compiler/pkg/wasm-pack-shim.mjs');\n    return await module.default(bin);\n});\n/**\n * create a Typst compiler.\n * @returns {TypstCompiler} - The Typst compiler.\n * @example\n * ```typescript\n * import { createTypstCompiler } from 'typst';\n * const compiler = createTypstCompiler();\n * await compiler.init();\n * compiler.addSource('/main.typ', 'Hello, typst!');\n * await compiler.compile({ mainFilePath: '/main.typ' });\n * ```\n */\nexport function createTypstCompiler() {\n    return new TypstCompilerDriver();\n}\nclass TypstCompilerDriver {\n    compiler;\n    compilerJs;\n    constructor() { }\n    async init(options) {\n        this.compilerJs = await import('@myriaddreamin/typst-ts-web-compiler/pkg/wasm-pack-shim.mjs');\n        const TypstCompilerBuilder = this.compilerJs.TypstCompilerBuilder;\n        const compilerOptions = { ...(options || {}) };\n        const hasPreloadRemoteFonts = compilerOptions.beforeBuild?.some((fn) => fn._preloadRemoteFontOptions !== undefined);\n        const hasSpecifiedAssets = compilerOptions.beforeBuild?.some((fn) => fn._preloadRemoteFontOptions?.assets !== undefined);\n        const hasDisableAssets = compilerOptions.beforeBuild?.some((fn) => fn._preloadRemoteFontOptions?.assets === false);\n        if (!hasPreloadRemoteFonts || (!hasSpecifiedAssets && !hasDisableAssets)) {\n            compilerOptions.beforeBuild?.push(preloadRemoteFonts([], {\n                assets: ['text'],\n            }));\n        }\n        this.compiler = await buildComponent(options, gCompilerModule, TypstCompilerBuilder, {});\n    }\n    compile(options) {\n        return new Promise(resolve => {\n            if ('incrementalServer' in options) {\n                resolve(this.compiler.incr_compile(options.mainFilePath, convertInputs(options.inputs), options.incrementalServer[kObject], getDiagnosticsArg(options.diagnostics)));\n                return;\n            }\n            resolve(this.compiler.compile(options.mainFilePath, convertInputs(options.inputs), options.format || 'vector', getDiagnosticsArg(options.diagnostics)));\n        });\n    }\n    query(options) {\n        return new Promise(resolve => {\n            resolve(JSON.parse(this.compiler.query(options.mainFilePath, convertInputs(options.inputs), options.selector, options.field)));\n        });\n    }\n    getSemanticTokenLegend() {\n        return new Promise(resolve => {\n            resolve(this.compiler.get_semantic_token_legend());\n        });\n    }\n    getSemanticTokens(opts) {\n        return new Promise(resolve => {\n            this.compiler.reset();\n            resolve(this.compiler.get_semantic_tokens(opts.offsetEncoding || 'utf-16', opts.mainFilePath, opts.resultId));\n        });\n    }\n    async withIncrementalServer(f) {\n        const srv = new IncrementalServer(this.compiler.create_incr_server());\n        try {\n            return await f(srv);\n        }\n        finally {\n            srv[kObject].free();\n        }\n    }\n    async getAst(mainFilePath) {\n        return this.compiler.get_ast(mainFilePath);\n    }\n    async reset() {\n        await new Promise(resolve => {\n            this.compiler.reset();\n            resolve(undefined);\n        });\n    }\n    addSource(path, source) {\n        if (arguments.length > 2) {\n            throw new Error('use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead');\n        }\n        this.compiler.add_source(path, source);\n    }\n    mapShadow(path, content) {\n        this.compiler.map_shadow(path, content);\n    }\n    unmapShadow(path) {\n        this.compiler.unmap_shadow(path);\n    }\n    resetShadow() {\n        this.compiler.reset_shadow();\n    }\n    renderPageToCanvas() {\n        throw new Error('Please use the api TypstRenderer.renderToCanvas in v0.4.0');\n    }\n}\n// todo: caching inputs\nfunction convertInputs(inputs) {\n    return inputs ? Object.entries(inputs) : undefined;\n}\nfunction getDiagnosticsArg(diagnostics) {\n    switch (diagnostics) {\n        case 'none':\n            return 1;\n        case 'unix':\n            return 2;\n        case 'full':\n            return 3;\n        default:\n            return 0;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbXBpbGVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsY0FBYyxFQUFzQixNQUFNLFlBQVksQ0FBQztBQUNoRSxPQUFPLEVBQXVELE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXBHLE9BQU8sRUFBRSxrQkFBa0IsRUFBb0IsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBK0g1QyxNQUFNLE9BQU8saUJBQWlCO0lBQzVCOztPQUVHO0lBQ0gsQ0FBQyxPQUFPLENBQUMsQ0FBbUI7SUFFNUI7O09BRUc7SUFDSCxZQUFZLENBQW1CO1FBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSztRQUNILElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ0wsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0JBQWtCLENBQUMsTUFBZTtRQUNoQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNGO0FBMkhELE1BQU0sZUFBZSxHQUFHLElBQUksY0FBYyxDQUFDLEtBQUssRUFBRSxHQUFTLEVBQUUsRUFBRTtJQUM3RCxNQUFNLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO0lBQzNGLE9BQU8sTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLENBQUMsQ0FBQyxDQUFDO0FBRUg7Ozs7Ozs7Ozs7O0dBV0c7QUFD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QUFDLElBQVksRUFBRSxNQUFjO1FBQ3BDLElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDeEIsTUFBTSxJQUFJLEtBQUssQ0FDYixrR0FBa0csQ0FDbkcsQ0FBQztTQUNIO1FBRUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBWSxFQUFFLE9BQW1CO1FBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsV0FBVyxDQUFDLElBQVk7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQywyREFBMkQsQ0FBQyxDQUFDO0lBQy9FLENBQUM7Q0FDRjtBQUVELHVCQUF1QjtBQUN2QixTQUFTLGFBQWEsQ0FBQyxNQUErQjtJQUNwRCxPQUFPLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ3JELENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQUFDLFdBQStCO0lBQ3hELFFBQVEsV0FBVyxFQUFFO1FBQ25CLEtBQUssTUFBTTtZQUNULE9BQU8sQ0FBQyxDQUFDO1FBQ1gsS0FBSyxNQUFNO1lBQ1QsT0FBTyxDQUFDLENBQUM7UUFDWCxLQUFLLE1BQU07WUFDVCxPQUFPLENBQUMsQ0FBQztRQUNYO1lBQ0UsT0FBTyxDQUFDLENBQUM7S0FDWjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtaWdub3JlXHJcbmltcG9ydCB0eXBlICogYXMgdHlwc3QgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtd2ViLWNvbXBpbGVyL3BrZy93YXNtLXBhY2stc2hpbS5tanMnO1xyXG5pbXBvcnQgeyBidWlsZENvbXBvbmVudCwgZ2xvYmFsRm9udFByb21pc2VzIH0gZnJvbSAnLi9pbml0Lm1qcyc7XHJcbmltcG9ydCB7IEZzQWNjZXNzTW9kZWwsIFNlbWFudGljVG9rZW5zLCBTZW1hbnRpY1Rva2Vuc0xlZ2VuZCwga09iamVjdCB9IGZyb20gJy4vaW50ZXJuYWwudHlwZXMubWpzJztcclxuXHJcbmltcG9ydCB7IHByZWxvYWRSZW1vdGVGb250cywgdHlwZSBJbml0T3B0aW9ucyB9IGZyb20gJy4vb3B0aW9ucy5pbml0Lm1qcyc7XHJcbmltcG9ydCB7IExhenlXYXNtTW9kdWxlIH0gZnJvbSAnLi93YXNtLm1qcyc7XHJcblxyXG4vKipcclxuICogQXZhaWxhYmxlIGZvcm1hdHMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBDb21waWxlRm9ybWF0ID0gJ3ZlY3RvcicgfCAncGRmJztcclxuXHJcbi8qKlxyXG4gKiBUaGUgZGlhZ25vc3RpYyBtZXNzYWdlIHBhcnRpYWxseSBmb2xsb3dpbmcgdGhlIExTUCBzcGVjaWZpY2F0aW9uLlxyXG4gKi9cclxuaW50ZXJmYWNlIERpYWdub3N0aWNNZXNzYWdlIHtcclxuICAvLyBUaGUgcGFja2FnZSBvd25pbmcgdGhlIHBhdGguXHJcbiAgLy8gSWYgdGhlIHBhY2thZ2UgaXMgZW1wdHksIHRoZSBwYXRoIGlzIGEgcmVsYXRpdmUgcGF0aCB0byB0aGUgKndvcmtzcGFjZSByb290Ki5cclxuICBwYWNrYWdlOiBzdHJpbmc7XHJcbiAgLy8gVGhlIHBhdGggb2YgdGhlIGZpbGUuXHJcbiAgcGF0aDogc3RyaW5nO1xyXG4gIC8vIFNldmVyaXR5IG9mIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UuXHJcbiAgc2V2ZXJpdHk6IHN0cmluZztcclxuICAvLyBaZXJvLWJhc2VkIGxpbmUgbnVtYmVyIGFuZCBvbmUtYmFzZWQgY2hhcmFjdGVyIG9mZnNldC5cclxuICAvLyBUaGUgcmFuZ2Ugb2YgdGhlIGRpYWdub3N0aWMgbWVzc2FnZS5cclxuICAvLyBJZiB0aGUgZGlhZ25vc3RpYyBtZXNzYWdlIGlzIGEgcmFuZ2UsIHRoZSByYW5nZSBpcyBpbiB0aGUgZm9ybWF0IG9mIGBzdGFydExpbmU6c3RhcnRDaGFyYWN0ZXItZW5kTGluZTplbmRDaGFyYWN0ZXJgLlxyXG4gIC8vIElmIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UgaXMgYSBwb2ludCwgdGhlIHJhbmdlIGlzIGluIHRoZSBmb3JtYXQgb2YgYGxpbmU6Y2hhcmFjdGVyYC5cclxuICAvLyBPdGhlcndpc2UsIHRoZSByYW5nZSBpcyBlbXB0eS5cclxuICByYW5nZTogc3RyaW5nO1xyXG4gIC8vIFRoZSBtZXNzYWdlIG9mIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UuXHJcbiAgbWVzc2FnZTogc3RyaW5nO1xyXG59XHJcblxyXG4vKipcclxuICogQXZhaWxhYmxlIGZvcm1hdHMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAqXHJcbiAqIElmIHNldCB0byB1bml4LCBhIGRpYWdub3N0aWNzIGlzIGluIGZvcm1hdCBvZlxyXG4gKlxyXG4gKiBgYGBsb2dcclxuICogLy8gd2l0aCBwYWNrYWdlXHJcbiAqIGNldHo6MC4yLjBAbGliLnR5cDoyOjktMzoxNTogZXJyb3I6IHVuZXhwZWN0ZWQgdHlwZSBpbiBgK2AgYXBwbGljYXRpb25cclxuICogLy8gd2l0aG91dCBwYWNrYWdlXHJcbiAqIG1haW4udHlwOjI6OS0zOjE1OiBlcnJvcjogdW5leHBlY3RlZCB0eXBlIGluIGArYCBhcHBsaWNhdGlvblxyXG4gKiBgYGBcclxuICpcclxuICogSWYgc2V0IHRvIGxvbmcsIGEgZGlhZ25vc3RpY3MgaXMgaW4gZm9ybWF0IG9mIHtAbGluayBEaWFnbm9zdGljTWVzc2FnZX0uXHJcbiAqXHJcbiAqIElmIHNldCB0byBmdWxsLCBhIGRpYWdub3N0aWNzIGlzIGluIGZvcm1hdCBvZiB7QGxpbmsgRGlhZ25vc3RpY01lc3NhZ2V9LCBidXQgYWxzbyB3aXRoIHRyYWNlIG1lc3NhZ2VzLlxyXG4gKi9cclxuZXhwb3J0IHR5cGUgRGlhZ25vc3RpY3NGb3JtYXQgPSAnbm9uZScgfCAndW5peCcgfCAnZnVsbCc7XHJcblxyXG5leHBvcnQgdHlwZSBEaWFnbm9zdGljc0RhdGEgPSB7XHJcbiAgbm9uZTogbmV2ZXI7XHJcbiAgdW5peDogc3RyaW5nO1xyXG4gIGZ1bGw6IERpYWdub3N0aWNNZXNzYWdlO1xyXG59O1xyXG5cclxuaW50ZXJmYWNlIENvbXBpbGVPcHRpb25zQ29tbW9uIHtcclxuICAvKipcclxuICAgKiBUaGUgcGF0aCBvZiB0aGUgbWFpbiBmaWxlLlxyXG4gICAqL1xyXG4gIG1haW5GaWxlUGF0aDogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIEFkZHMgYSBzdHJpbmcga2V5LXZhbHVlIHBhaXIgdmlzaWJsZSB0aHJvdWdoIGBzeXMuaW5wdXRzYFxyXG4gICAqXHJcbiAgICogTm90ZTogcGFzcyBge31gIHRvIGNsZWFyIGBzeXMuaW5wdXRzYFxyXG4gICAqXHJcbiAgICogTm90ZTogV2hlbiBwYXNzaW5nIGB1bmRlZmluZWRgLCBjb21waWxlciB3aWxsIHVzZSBsYXN0IHNldCBgc3lzLmlucHV0c2AuXHJcbiAgICpcclxuICAgKiBOb3RlOiBUaGlzIG1lYW5zIHlvdSBzaG91bGQgYWx3YXlzIHNwZWNpZnkgaW5wdXRzIHdoZW4gdXNpbmcgY29tcGlsZXIgZm9yIGNvbmN1cnJlbnQgdGFza3MuXHJcbiAgICovXHJcbiAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFRyYW5zaWVudENvbXBpbGVPcHRpb25zPFxyXG4gIEYgZXh0ZW5kcyBDb21waWxlRm9ybWF0ID0gYW55LFxyXG4gIERpYWdub3N0aWNzIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSBEaWFnbm9zdGljc0Zvcm1hdCxcclxuPiBleHRlbmRzIENvbXBpbGVPcHRpb25zQ29tbW9uIHtcclxuICAvKipcclxuICAgKiBUaGUgZm9ybWF0IG9mIHRoZSBhcnRpZmFjdC5cclxuICAgKiAtICd2ZWN0b3InOiBjYW4gdGhlbiBsb2FkIHRvIHRoZSByZW5kZXJlciB0byByZW5kZXIgdGhlIGRvY3VtZW50LlxyXG4gICAqIC0gJ3BkZic6IGZvciBmaW5hbGx5IGV4cG9ydGluZyBwZGYgdG8gdGhlIHVzZXIuXHJcbiAgICogQGRlZmF1bHQgJ3ZlY3RvcidcclxuICAgKi9cclxuICBmb3JtYXQ/OiBGO1xyXG4gIC8qKlxyXG4gICAqIFdoZXRoZXIgdG8gaW5jbHVkZSBkaWFnbm9zdGljIGluZm9ybWF0aW9uIGluIHRoZSByZXN1bHQuXHJcbiAgICogTm90ZTogaXQgd2lsbCBiZSBzZXQgdG8gdHJ1ZSBieSBkZWZhdWx0IGluIHYwLjYuMFxyXG4gICAqIEBkZWZhdWx0IHVuZGVmaW5lZFxyXG4gICAqL1xyXG4gIGRpYWdub3N0aWNzOiBEaWFnbm9zdGljcztcclxufVxyXG5cclxuaW50ZXJmYWNlIEluY3JlbWVudGFsQ29tcGlsZU9wdGlvbnM8RGlhZ25vc3RpY3MgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0PlxyXG4gIGV4dGVuZHMgQ29tcGlsZU9wdGlvbnNDb21tb24ge1xyXG4gIC8qKlxyXG4gICAqIFRoZSBmb3JtYXQgb2YgdGhlIGluY3JlbWVudGFsbHkgZXhwb3J0ZWQgYXJ0aWZhY3QuXHJcbiAgICogQGRlZmF1bHQgJ3ZlY3RvcidcclxuICAgKi9cclxuICBmb3JtYXQ/OiAndmVjdG9yJztcclxuICAvKipcclxuICAgKiBUaGUgaW5jcmVtZW50YWwgc2VydmVyIGZvciB0aGUgZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgaW5jcmVtZW50YWxTZXJ2ZXI6IEluY3JlbWVudGFsU2VydmVyO1xyXG4gIC8qKlxyXG4gICAqIFdoZXRoZXIgdG8gaW5jbHVkZSBkaWFnbm9zdGljIGluZm9ybWF0aW9uIGluIHRoZSByZXN1bHQuXHJcbiAgICogTm90ZTogQmVmb3JlIHYwLjYuMCwgd2hlbiBkaWFnbm9zdGljcyBpcyBub3Qgc2V0LCB0aGUgcmVzdWx0IHdpbGwgYmUgYSBVaW50OEFycmF5LlxyXG4gICAqIEFmdGVyIHYwLjYuMCwgd2hlbiBkaWFnbm9zdGljcyBpcyBub3Qgc2V0LCB0aGUgcmVzdWx0IHdpbGwgYmUgYSBDb21waWxlUmVzdWx0PFVpbnQ4QXJyYXk+IHdpdGhvdXQgZGlhZ25vc3RpY3MuXHJcbiAgICogQGRlZmF1bHQgZmFsc2VcclxuICAgKi9cclxuICBkaWFnbm9zdGljczogRGlhZ25vc3RpY3M7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnlPcHRpb25zIGV4dGVuZHMgQ29tcGlsZU9wdGlvbnNDb21tb24ge1xyXG4gIC8qKlxyXG4gICAqIHNlbGVjdCBwYXJ0IG9mIGRvY3VtZW50IGZvciBxdWVyeS5cclxuICAgKi9cclxuICBzZWxlY3Rvcjogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIGNhc3QgcmVzdWx0IGJ5IGFjY2Vzc2luZyBzaW5nbGUgZmllbGQuXHJcbiAgICovXHJcbiAgZmllbGQ/OiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGUgb3B0aW9ucyBmb3IgY29tcGlsaW5nIHRoZSBkb2N1bWVudC5cclxuICovXHJcbmV4cG9ydCB0eXBlIENvbXBpbGVPcHRpb25zPFxyXG4gIEZvcm1hdCBleHRlbmRzIENvbXBpbGVGb3JtYXQgPSBhbnksXHJcbiAgRGlhZ25vc3RpY3MgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0LFxyXG4+ID0gVHJhbnNpZW50Q29tcGlsZU9wdGlvbnM8Rm9ybWF0LCBEaWFnbm9zdGljcz4gfCBJbmNyZW1lbnRhbENvbXBpbGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IGNsYXNzIEluY3JlbWVudGFsU2VydmVyIHtcclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBba09iamVjdF06IHR5cHN0LkluY3JTZXJ2ZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHM6IHR5cHN0LkluY3JTZXJ2ZXIpIHtcclxuICAgIHRoaXNba09iamVjdF0gPSBzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgdGhlIGluY3JlbWVudGFsIHNlcnZlciB0byB0aGUgaW5pdGlhbCBzdGF0ZS5cclxuICAgKi9cclxuICByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXNba09iamVjdF0ucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybiBjdXJyZW50IHJlc3VsdC5cclxuICAgKi9cclxuICBjdXJyZW50KCk6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uY3VycmVudCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWxzbyBhdHRhY2ggdGhlIGRlYnVnIGluZm8gdG8gdGhlIHJlc3VsdC5cclxuICAgKi9cclxuICBzZXRBdHRhY2hEZWJ1Z0luZm8oZW5hYmxlOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzW2tPYmplY3RdLnNldF9hdHRhY2hfZGVidWdfaW5mbyhlbmFibGUpO1xyXG4gIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIENvbXBpbGVSZXN1bHQ8VCwgRCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0PiB7XHJcbiAgcmVzdWx0PzogVDtcclxuICBkaWFnbm9zdGljcz86IERpYWdub3N0aWNzRGF0YVtEXVtdO1xyXG59XHJcblxyXG4vKipcclxuICogVGhlIGludGVyZmFjZSBvZiBUeXBzdCBjb21waWxlci5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RDb21waWxlciB7XHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSB0aGUgdHlwc3QgY29tcGlsZXIuXHJcbiAgICogQHBhcmFtIHtQYXJ0aWFsPEluaXRPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlXHJcbiAgICogdHlwc3QgY29tcGlsZXIuXHJcbiAgICovXHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgdHlwc3QgY29tcGlsZXIgdG8gdGhlIGluaXRpYWwgc3RhdGUuXHJcbiAgICogTm90ZTogd2l0aG91dCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBjb21waWxlciB3aWxsIGFsd2F5cyBrZWVwIGNhY2hlc1xyXG4gICAqIHN1Y2ggYXM6XHJcbiAgICogLSBsb2FkZWQgZm9udHNcclxuICAgKiAtIHNvdXJjZSBmaWxlcyBjb3JyZXNwb25kaW5nIHRvIHR5cHN0IG1vZHVsZXNcclxuICAgKlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgaW5kZXBlbmRlbnQgdG8gdGhlIHtAbGluayByZXNldFNoYWRvd30gZnVuY3Rpb24uXHJcbiAgICogVGhpcyBpcyBpbnRlbmRlZCB0byBvcHRpbWl6ZSB0aGUgcGVyZm9ybWFuY2Ugb2YgdGhlIGNvbXBpbGVyLlxyXG4gICAqL1xyXG4gIHJlc2V0KCk6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXBpbGUgYW4gZG9jdW1lbnQgd2l0aCB0aGUgbWFpbnRhaW5lZCBzdGF0ZS5cclxuICAgKiBAcGFyYW0ge0NvbXBpbGVPcHRpb25zfSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8VWludDhBcnJheT59IC0gYXJ0aWZhY3QgaW4gdmVjdG9yIGZvcm1hdC5cclxuICAgKiBZb3UgY2FuIHRoZW4gbG9hZCB0aGUgYXJ0aWZhY3QgdG8gdGhlIHJlbmRlcmVyIHRvIHJlbmRlciB0aGUgZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+KFxyXG4gICAgb3B0aW9uczogQ29tcGlsZU9wdGlvbnM8J3ZlY3RvcicsIEQ+LFxyXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj47XHJcbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+KFxyXG4gICAgb3B0aW9uczogQ29tcGlsZU9wdGlvbnM8J3BkZicsIEQ+LFxyXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj47XHJcbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+KFxyXG4gICAgb3B0aW9uczogQ29tcGlsZU9wdGlvbnM8YW55LCBEPixcclxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8VWludDhBcnJheSwgRD4+O1xyXG5cclxuICAvKipcclxuICAgKiBleHBlcmltZW50YWxcclxuICAgKiBRdWVyeSB0aGUgcmVzdWx0IHdpdGggZG9jdW1lbnRcclxuICAgKi9cclxuICBxdWVyeTxUPihvcHRpb25zOiBRdWVyeU9wdGlvbnMpOiBQcm9taXNlPFQ+O1xyXG5cclxuICAvKipcclxuICAgKiBQcmludCB0aGUgQVNUIG9mIHRoZSBtYWluIGZpbGUuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1haW5GaWxlUGF0aCAtIFRoZSBwYXRoIG9mIHRoZSBtYWluIGZpbGUuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gLSBhbiBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIEFTVC5cclxuICAgKi9cclxuICBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz47XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBhIHNvdXJjZSBmaWxlIHRvIHRoZSBjb21waWxlci5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBwYXRoIG9mIHRoZSBzb3VyY2UgZmlsZS5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIC0gVGhlIHNvdXJjZSBjb2RlIG9mIHRoZSBzb3VyY2UgZmlsZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIGFkZFNvdXJjZShwYXRoOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogQWRkIGEgc2hhZG93IGZpbGUgdG8gdGhlIGNvbXBpbGVyLlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIHNoYWRvdyBmaWxlLlxyXG4gICAqIEBwYXJhbSB7VWludDhBcnJheX0gY29udGVudCAtIFRoZSBjb250ZW50IG9mIHRoZSBzaGFkb3cgZmlsZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIG1hcFNoYWRvdyhwYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IFVpbnQ4QXJyYXkpOiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgYSBzaGFkb3cgZmlsZSBmcm9tIHRoZSBjb21waWxlci5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBwYXRoIHRvIHRoZSBzaGFkb3cgZmlsZS5cclxuICAgKi9cclxuICB1bm1hcFNoYWRvdyhwYXRoOiBzdHJpbmcpOiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgc2hhZG93IGZpbGVzLlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgaW5kZXBlbmRlbnQgdG8gdGhlIHtAbGluayByZXNldH0gZnVuY3Rpb24uXHJcbiAgICovXHJcbiAgcmVzZXRTaGFkb3coKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogU2VlIFNlbWFudGljIHRva2VuczogaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzg2NDE1XHJcbiAgICovXHJcbiAgZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpOiBQcm9taXNlPFNlbWFudGljVG9rZW5zTGVnZW5kPjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogU2VlIFNlbWFudGljIHRva2VuczogaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzg2NDE1XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5tYWluRmlsZVBhdGggLSBUaGUgcGF0aCBvZiB0aGUgbWFpbiBmaWxlLlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLnJlc3VsdElkIC0gVGhlIGlkIG9mIHRoZSByZXN1bHQuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdHMub2Zmc2V0RW5jb2RpbmcgLSBUaGUgZW5jb2Rpbmcgb2YgdGhlIG9mZnNldC5cclxuICAgKiAgIC0gJ3V0Zi0xNic6IHRoZSBvZmZzZXQgaXMgZW5jb2RlZCBpbiB1dGYtMTYuXHJcbiAgICogICAtICd1dGYtOCc6IHRoZSBvZmZzZXQgaXMgZW5jb2RlZCBpbiB1dGYtOC5cclxuICAgKiAgIEBkZWZhdWx0ICd1dGYtMTYnXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8U2VtYW50aWNUb2tlbnM+fSAtIFRoZSBzZW1hbnRpYyB0b2tlbnMuXHJcbiAgICovXHJcbiAgZ2V0U2VtYW50aWNUb2tlbnMob3B0czoge1xyXG4gICAgbWFpbkZpbGVQYXRoOiBzdHJpbmc7XHJcbiAgICByZXN1bHRJZD86IHN0cmluZztcclxuICAgIG9mZnNldEVuY29kaW5nPzogc3RyaW5nO1xyXG4gIH0pOiBQcm9taXNlPFNlbWFudGljVG9rZW5zPjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogUnVuIHdpdGggYW4gaW5jcmVtZW50YWwgc2VydmVyIHdoaWNoIGhvbGRzIHRoZSBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQgaW4gd2FzbS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oSW5jcmVtZW50YWxTZXJ2ZXIpOiBQcm9taXNlPFQ+fSBmIC0gVGhlIGZ1bmN0aW9uIHRvIHJ1biB3aXRoIHRoZSBpbmNyZW1lbnRhbCBzZXJ2ZXIuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8VD59IC0gVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24uXHJcbiAgICpcclxuICAgKiBOb3RlOiB0aGUgaW5jcmVtZW50YWwgc2VydmVyIHdpbGwgYmUgZnJlZWQgYWZ0ZXIgdGhlIGZ1bmN0aW9uIGlzIGZpbmlzaGVkLlxyXG4gICAqL1xyXG4gIHdpdGhJbmNyZW1lbnRhbFNlcnZlcjxUPihmOiAoczogSW5jcmVtZW50YWxTZXJ2ZXIpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xyXG59XHJcblxyXG5jb25zdCBnQ29tcGlsZXJNb2R1bGUgPSBuZXcgTGF6eVdhc21Nb2R1bGUoYXN5bmMgKGJpbj86IGFueSkgPT4ge1xyXG4gIGNvbnN0IG1vZHVsZSA9IGF3YWl0IGltcG9ydCgnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtd2ViLWNvbXBpbGVyL3BrZy93YXNtLXBhY2stc2hpbS5tanMnKTtcclxuICByZXR1cm4gYXdhaXQgbW9kdWxlLmRlZmF1bHQoYmluKTtcclxufSk7XHJcblxyXG4vKipcclxuICogY3JlYXRlIGEgVHlwc3QgY29tcGlsZXIuXHJcbiAqIEByZXR1cm5zIHtUeXBzdENvbXBpbGVyfSAtIFRoZSBUeXBzdCBjb21waWxlci5cclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBpbXBvcnQgeyBjcmVhdGVUeXBzdENvbXBpbGVyIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBjb25zdCBjb21waWxlciA9IGNyZWF0ZVR5cHN0Q29tcGlsZXIoKTtcclxuICogYXdhaXQgY29tcGlsZXIuaW5pdCgpO1xyXG4gKiBjb21waWxlci5hZGRTb3VyY2UoJy9tYWluLnR5cCcsICdIZWxsbywgdHlwc3QhJyk7XHJcbiAqIGF3YWl0IGNvbXBpbGVyLmNvbXBpbGUoeyBtYWluRmlsZVBhdGg6ICcvbWFpbi50eXAnIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdENvbXBpbGVyKCk6IFR5cHN0Q29tcGlsZXIge1xyXG4gIHJldHVybiBuZXcgVHlwc3RDb21waWxlckRyaXZlcigpO1xyXG59XHJcblxyXG5jbGFzcyBUeXBzdENvbXBpbGVyRHJpdmVyIHtcclxuICBjb21waWxlcjogdHlwc3QuVHlwc3RDb21waWxlcjtcclxuICBjb21waWxlckpzOiB0eXBlb2YgdHlwc3Q7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMuY29tcGlsZXJKcyA9IGF3YWl0IGltcG9ydCgnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtd2ViLWNvbXBpbGVyL3BrZy93YXNtLXBhY2stc2hpbS5tanMnKTtcclxuICAgIGNvbnN0IFR5cHN0Q29tcGlsZXJCdWlsZGVyID0gdGhpcy5jb21waWxlckpzLlR5cHN0Q29tcGlsZXJCdWlsZGVyO1xyXG5cclxuICAgIGNvbnN0IGNvbXBpbGVyT3B0aW9ucyA9IHsgLi4uKG9wdGlvbnMgfHwge30pIH07XHJcbiAgICBjb25zdCBoYXNQcmVsb2FkUmVtb3RlRm9udHMgPSBjb21waWxlck9wdGlvbnMuYmVmb3JlQnVpbGQ/LnNvbWUoXHJcbiAgICAgIChmbjogYW55KSA9PiBmbi5fcHJlbG9hZFJlbW90ZUZvbnRPcHRpb25zICE9PSB1bmRlZmluZWQsXHJcbiAgICApO1xyXG4gICAgY29uc3QgaGFzU3BlY2lmaWVkQXNzZXRzID0gY29tcGlsZXJPcHRpb25zLmJlZm9yZUJ1aWxkPy5zb21lKFxyXG4gICAgICAoZm46IGFueSkgPT4gZm4uX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucz8uYXNzZXRzICE9PSB1bmRlZmluZWQsXHJcbiAgICApO1xyXG4gICAgY29uc3QgaGFzRGlzYWJsZUFzc2V0cyA9IGNvbXBpbGVyT3B0aW9ucy5iZWZvcmVCdWlsZD8uc29tZShcclxuICAgICAgKGZuOiBhbnkpID0+IGZuLl9wcmVsb2FkUmVtb3RlRm9udE9wdGlvbnM/LmFzc2V0cyA9PT0gZmFsc2UsXHJcbiAgICApO1xyXG5cclxuICAgIGlmICghaGFzUHJlbG9hZFJlbW90ZUZvbnRzIHx8ICghaGFzU3BlY2lmaWVkQXNzZXRzICYmICFoYXNEaXNhYmxlQXNzZXRzKSkge1xyXG4gICAgICBjb21waWxlck9wdGlvbnMuYmVmb3JlQnVpbGQ/LnB1c2goXHJcbiAgICAgICAgcHJlbG9hZFJlbW90ZUZvbnRzKFtdLCB7XHJcbiAgICAgICAgICBhc3NldHM6IFsndGV4dCddLFxyXG4gICAgICAgIH0pLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcGlsZXIgPSBhd2FpdCBidWlsZENvbXBvbmVudChvcHRpb25zLCBnQ29tcGlsZXJNb2R1bGUsIFR5cHN0Q29tcGlsZXJCdWlsZGVyLCB7fSk7XHJcbiAgfVxyXG5cclxuICBjb21waWxlKG9wdGlvbnM6IENvbXBpbGVPcHRpb25zKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgaWYgKCdpbmNyZW1lbnRhbFNlcnZlcicgaW4gb3B0aW9ucykge1xyXG4gICAgICAgIHJlc29sdmUoXHJcbiAgICAgICAgICB0aGlzLmNvbXBpbGVyLmluY3JfY29tcGlsZShcclxuICAgICAgICAgICAgb3B0aW9ucy5tYWluRmlsZVBhdGgsXHJcbiAgICAgICAgICAgIGNvbnZlcnRJbnB1dHMob3B0aW9ucy5pbnB1dHMpLFxyXG4gICAgICAgICAgICBvcHRpb25zLmluY3JlbWVudGFsU2VydmVyW2tPYmplY3RdLFxyXG4gICAgICAgICAgICBnZXREaWFnbm9zdGljc0FyZyhvcHRpb25zLmRpYWdub3N0aWNzKSxcclxuICAgICAgICAgICksXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgcmVzb2x2ZShcclxuICAgICAgICB0aGlzLmNvbXBpbGVyLmNvbXBpbGUoXHJcbiAgICAgICAgICBvcHRpb25zLm1haW5GaWxlUGF0aCxcclxuICAgICAgICAgIGNvbnZlcnRJbnB1dHMob3B0aW9ucy5pbnB1dHMpLFxyXG4gICAgICAgICAgb3B0aW9ucy5mb3JtYXQgfHwgJ3ZlY3RvcicsXHJcbiAgICAgICAgICBnZXREaWFnbm9zdGljc0FyZyhvcHRpb25zLmRpYWdub3N0aWNzKSxcclxuICAgICAgICApLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBxdWVyeShvcHRpb25zOiBRdWVyeU9wdGlvbnMpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4ocmVzb2x2ZSA9PiB7XHJcbiAgICAgIHJlc29sdmUoXHJcbiAgICAgICAgSlNPTi5wYXJzZShcclxuICAgICAgICAgIHRoaXMuY29tcGlsZXIucXVlcnkoXHJcbiAgICAgICAgICAgIG9wdGlvbnMubWFpbkZpbGVQYXRoLFxyXG4gICAgICAgICAgICBjb252ZXJ0SW5wdXRzKG9wdGlvbnMuaW5wdXRzKSxcclxuICAgICAgICAgICAgb3B0aW9ucy5zZWxlY3RvcixcclxuICAgICAgICAgICAgb3B0aW9ucy5maWVsZCxcclxuICAgICAgICAgICksXHJcbiAgICAgICAgKSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpOiBQcm9taXNlPFNlbWFudGljVG9rZW5zTGVnZW5kPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2VtYW50aWNUb2tlbnNMZWdlbmQ+KHJlc29sdmUgPT4ge1xyXG4gICAgICByZXNvbHZlKHRoaXMuY29tcGlsZXIuZ2V0X3NlbWFudGljX3Rva2VuX2xlZ2VuZCgpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VtYW50aWNUb2tlbnMob3B0czoge1xyXG4gICAgbWFpbkZpbGVQYXRoOiBzdHJpbmc7XHJcbiAgICByZXN1bHRJZD86IHN0cmluZztcclxuICAgIG9mZnNldEVuY29kaW5nPzogc3RyaW5nO1xyXG4gIH0pOiBQcm9taXNlPFNlbWFudGljVG9rZW5zPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2VtYW50aWNUb2tlbnM+KHJlc29sdmUgPT4ge1xyXG4gICAgICB0aGlzLmNvbXBpbGVyLnJlc2V0KCk7XHJcbiAgICAgIHJlc29sdmUoXHJcbiAgICAgICAgdGhpcy5jb21waWxlci5nZXRfc2VtYW50aWNfdG9rZW5zKFxyXG4gICAgICAgICAgb3B0cy5vZmZzZXRFbmNvZGluZyB8fCAndXRmLTE2JyxcclxuICAgICAgICAgIG9wdHMubWFpbkZpbGVQYXRoLFxyXG4gICAgICAgICAgb3B0cy5yZXN1bHRJZCxcclxuICAgICAgICApIGFzIGFueSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgd2l0aEluY3JlbWVudGFsU2VydmVyPFQ+KGY6IChzOiBJbmNyZW1lbnRhbFNlcnZlcikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gICAgY29uc3Qgc3J2ID0gbmV3IEluY3JlbWVudGFsU2VydmVyKHRoaXMuY29tcGlsZXIuY3JlYXRlX2luY3Jfc2VydmVyKCkpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IGYoc3J2KTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNydltrT2JqZWN0XS5mcmVlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29tcGlsZXIuZ2V0X2FzdChtYWluRmlsZVBhdGgpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVzZXQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcclxuICAgICAgdGhpcy5jb21waWxlci5yZXNldCgpO1xyXG4gICAgICByZXNvbHZlKHVuZGVmaW5lZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZFNvdXJjZShwYXRoOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICd1c2Ugb2YgYWRkU291cmNlKHBhdGgsIHNvdXJjZSwgaXNNYWluKSBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIGFkZFNvdXJjZShwYXRoLCBzb3VyY2UpIGluc3RlYWQnLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcGlsZXIuYWRkX3NvdXJjZShwYXRoLCBzb3VyY2UpO1xyXG4gIH1cclxuXHJcbiAgbWFwU2hhZG93KHBhdGg6IHN0cmluZywgY29udGVudDogVWludDhBcnJheSk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21waWxlci5tYXBfc2hhZG93KHBhdGgsIGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgdW5tYXBTaGFkb3cocGF0aDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbXBpbGVyLnVubWFwX3NoYWRvdyhwYXRoKTtcclxuICB9XHJcblxyXG4gIHJlc2V0U2hhZG93KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21waWxlci5yZXNldF9zaGFkb3coKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclBhZ2VUb0NhbnZhcygpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgdXNlIHRoZSBhcGkgVHlwc3RSZW5kZXJlci5yZW5kZXJUb0NhbnZhcyBpbiB2MC40LjAnKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIHRvZG86IGNhY2hpbmcgaW5wdXRzXHJcbmZ1bmN0aW9uIGNvbnZlcnRJbnB1dHMoaW5wdXRzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IFtzdHJpbmcsIHN0cmluZ11bXSB8IHVuZGVmaW5lZCB7XHJcbiAgcmV0dXJuIGlucHV0cyA/IE9iamVjdC5lbnRyaWVzKGlucHV0cykgOiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldERpYWdub3N0aWNzQXJnKGRpYWdub3N0aWNzOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBudW1iZXIge1xyXG4gIHN3aXRjaCAoZGlhZ25vc3RpY3MpIHtcclxuICAgIGNhc2UgJ25vbmUnOlxyXG4gICAgICByZXR1cm4gMTtcclxuICAgIGNhc2UgJ3VuaXgnOlxyXG4gICAgICByZXR1cm4gMjtcclxuICAgIGNhc2UgJ2Z1bGwnOlxyXG4gICAgICByZXR1cm4gMztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiAwO1xyXG4gIH1cclxufVxyXG4iXX0=","import React, { useState, useRef, useEffect } from 'react';\nimport * as typst from '@myriaddreamin/typst.ts';\n\nexport interface TypstDocumentProps {\n  artifact: ArrayBuffer | undefined;\n  domScale: number | undefined;\n}\n\nexport const TypstDocument = ({ artifact, domScale }: TypstDocumentProps) => {\n  /// --- beg: manipulate permission --- ///\n\n  // todo: acquire permission\n  const [permission, setPermissionInternal] = useState(false);\n  const setPermissionAndOk = (status: PermissionStatus) => {\n    if (status.state === 'granted') {\n      setPermissionInternal(true);\n      return true;\n    }\n    setPermissionInternal(false);\n    return false;\n  };\n  useEffect(() => {\n    navigator.permissions.query({ name: 'local-fonts' as PermissionName }).then(status => {\n      if (setPermissionAndOk(status)) {\n        return false;\n      }\n      status.addEventListener('change', event => {\n        console.log(event, status);\n        setPermissionAndOk(status);\n      });\n    });\n  });\n\n  /// --- end: manipulate permission --- ///\n\n  /// --- beg: update document --- ///\n  const displayDivRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!artifact) {\n      return;\n    }\n\n    let plugin = typst.createTypstRenderer();\n    console.log(plugin);\n\n    const tsModule = fetch(`/typst/typst_ts_renderer_bg.wasm`);\n\n    plugin.init({ getModule: () => tsModule })\n      .then(() => new Uint8Array(artifact))\n      .then(artifactData => {\n        return new Promise(resolve => {\n          plugin.runWithSession(\n            ses =>\n              new Promise(dispose => {\n                // ignore dispose\n                void dispose;\n\n                const t = performance.now();\n                const dom = plugin.renderDom({\n                  renderSession: ses,\n                  container: displayDivRef.current!,\n                  pixelPerPt: 4.5,\n                  domScale: domScale ?? 1.0,\n                });\n\n                dom.then((dom) => {\n                  console.log(dom);\n                  // FIXME: artifactData is not string type\n                  dom.addChangement(['new', artifactData as any as string]);\n                  console.log('render time', performance.now() - t);\n\n                  window.addEventListener('resize', () => dom.addViewportChange());\n                  window.addEventListener('scroll', () => dom.addViewportChange());\n                })\n              }),\n          );\n        });\n      });\n  }, [displayDivRef, artifact]);\n\n  /// --- end: update document --- ///\n\n  return (\n    <div>\n      <div className=\"typst-app\" ref={displayDivRef}></div>\n    </div>\n  );\n};\n","import * as React from \"react\"\nimport { Link, graphql } from \"gatsby\"\n\nimport Bio from \"../components/bio\"\nimport Layout from \"../components/layout\"\nimport Seo from \"../components/seo\"\nimport { TypstDocument } from \"../components/typst-doc\"\n\nconst BlogPostTemplate = ({\n  data: { previous, next, site, post },\n  location,\n}) => {\n  const siteTitle = site.siteMetadata?.title || `Title`\n\n  const [artifactData, setArtifactData] = React.useState(undefined)\n\n  React.useEffect(() => {\n    fetch(post.source.artifact)\n      .then(response => response.arrayBuffer())\n      .then(data => {\n        console.log('fetch got artifact data with length', data.byteLength)\n        setArtifactData(data)\n      })\n  }, [post])\n\n  return (\n    <Layout location={location} title={siteTitle}>\n      <article\n        className=\"blog-post\"\n        itemScope\n        itemType=\"http://schema.org/Article\"\n      >\n        <header>\n          <h1 itemProp=\"headline\">{post.frontmatter.title}</h1>\n          <p>{post.frontmatter.date}</p>\n        </header>\n        <section itemProp=\"articleBody\">\n          <TypstDocument artifact={artifactData} domScale={1.17} />\n        </section>\n        <hr />\n        <footer>\n          <Bio />\n        </footer>\n      </article>\n      <nav className=\"blog-post-nav\">\n        <ul\n          style={{\n            display: `flex`,\n            flexWrap: `wrap`,\n            justifyContent: `space-between`,\n            listStyle: `none`,\n            padding: 0,\n          }}\n        >\n          <li>\n            {previous && (\n              <Link to={previous.slug} rel=\"prev\">\n                 {previous.frontmatter.title}\n              </Link>\n            )}\n          </li>\n          <li>\n            {next && (\n              <Link to={next.slug} rel=\"next\">\n                {next.frontmatter.title} \n              </Link>\n            )}\n          </li>\n        </ul>\n      </nav>\n    </Layout>\n  )\n}\n\nexport const Head = ({ data: { post } }) => {\n  return (\n    <Seo\n      title={post.frontmatter.title}\n      description={post.frontmatter.description || post.excerpt}\n    />\n  )\n}\n\nexport default BlogPostTemplate\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug(\n    $id: String!\n    $previousPostId: String\n    $nextPostId: String\n  ) {\n    site {\n      siteMetadata {\n        title\n      }\n    }\n    post(id: { eq: $id }) {\n      id\n      excerpt\n      source {\n        ... on Typst {\n          artifact\n        }\n      }\n      frontmatter {\n        title\n        date(formatString: \"MMMM DD, YYYY\")\n        description\n      }\n    }\n    previous: post(id: { eq: $previousPostId }) {\n      slug\n      frontmatter {\n        title\n      }\n    }\n    next: post(id: { eq: $nextPostId }) {\n      slug\n      frontmatter {\n        title\n      }\n    }\n  }\n`\n","'use strict';\nvar isPossiblePrototype = require('../internals/is-possible-prototype');\n\nvar $String = String;\nvar $TypeError = TypeError;\n\nmodule.exports = function (argument) {\n  if (isPossiblePrototype(argument)) return argument;\n  throw new $TypeError(\"Can't set \" + $String(argument) + ' as a prototype');\n};\n","'use strict';\n// eslint-disable-next-line es/no-typed-arrays -- safe\nmodule.exports = typeof ArrayBuffer != 'undefined' && typeof DataView != 'undefined';\n","'use strict';\nvar NATIVE_ARRAY_BUFFER = require('../internals/array-buffer-basic-detection');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar globalThis = require('../internals/global-this');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\nvar hasOwn = require('../internals/has-own-property');\nvar classof = require('../internals/classof');\nvar tryToString = require('../internals/try-to-string');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar defineBuiltIn = require('../internals/define-built-in');\nvar defineBuiltInAccessor = require('../internals/define-built-in-accessor');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar uid = require('../internals/uid');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar enforceInternalState = InternalStateModule.enforce;\nvar getInternalState = InternalStateModule.get;\nvar Int8Array = globalThis.Int8Array;\nvar Int8ArrayPrototype = Int8Array && Int8Array.prototype;\nvar Uint8ClampedArray = globalThis.Uint8ClampedArray;\nvar Uint8ClampedArrayPrototype = Uint8ClampedArray && Uint8ClampedArray.prototype;\nvar TypedArray = Int8Array && getPrototypeOf(Int8Array);\nvar TypedArrayPrototype = Int8ArrayPrototype && getPrototypeOf(Int8ArrayPrototype);\nvar ObjectPrototype = Object.prototype;\nvar TypeError = globalThis.TypeError;\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar TYPED_ARRAY_TAG = uid('TYPED_ARRAY_TAG');\nvar TYPED_ARRAY_CONSTRUCTOR = 'TypedArrayConstructor';\n// Fixing native typed arrays in Opera Presto crashes the browser, see #595\nvar NATIVE_ARRAY_BUFFER_VIEWS = NATIVE_ARRAY_BUFFER && !!setPrototypeOf && classof(globalThis.opera) !== 'Opera';\nvar TYPED_ARRAY_TAG_REQUIRED = false;\nvar NAME, Constructor, Prototype;\n\nvar TypedArrayConstructorsList = {\n  Int8Array: 1,\n  Uint8Array: 1,\n  Uint8ClampedArray: 1,\n  Int16Array: 2,\n  Uint16Array: 2,\n  Int32Array: 4,\n  Uint32Array: 4,\n  Float32Array: 4,\n  Float64Array: 8\n};\n\nvar BigIntArrayConstructorsList = {\n  BigInt64Array: 8,\n  BigUint64Array: 8\n};\n\nvar isView = function isView(it) {\n  if (!isObject(it)) return false;\n  var klass = classof(it);\n  return klass === 'DataView'\n    || hasOwn(TypedArrayConstructorsList, klass)\n    || hasOwn(BigIntArrayConstructorsList, klass);\n};\n\nvar getTypedArrayConstructor = function (it) {\n  var proto = getPrototypeOf(it);\n  if (!isObject(proto)) return;\n  var state = getInternalState(proto);\n  return (state && hasOwn(state, TYPED_ARRAY_CONSTRUCTOR)) ? state[TYPED_ARRAY_CONSTRUCTOR] : getTypedArrayConstructor(proto);\n};\n\nvar isTypedArray = function (it) {\n  if (!isObject(it)) return false;\n  var klass = classof(it);\n  return hasOwn(TypedArrayConstructorsList, klass)\n    || hasOwn(BigIntArrayConstructorsList, klass);\n};\n\nvar aTypedArray = function (it) {\n  if (isTypedArray(it)) return it;\n  throw new TypeError('Target is not a typed array');\n};\n\nvar aTypedArrayConstructor = function (C) {\n  if (isCallable(C) && (!setPrototypeOf || isPrototypeOf(TypedArray, C))) return C;\n  throw new TypeError(tryToString(C) + ' is not a typed array constructor');\n};\n\nvar exportTypedArrayMethod = function (KEY, property, forced, options) {\n  if (!DESCRIPTORS) return;\n  if (forced) for (var ARRAY in TypedArrayConstructorsList) {\n    var TypedArrayConstructor = globalThis[ARRAY];\n    if (TypedArrayConstructor && hasOwn(TypedArrayConstructor.prototype, KEY)) try {\n      delete TypedArrayConstructor.prototype[KEY];\n    } catch (error) {\n      // old WebKit bug - some methods are non-configurable\n      try {\n        TypedArrayConstructor.prototype[KEY] = property;\n      } catch (error2) { /* empty */ }\n    }\n  }\n  if (!TypedArrayPrototype[KEY] || forced) {\n    defineBuiltIn(TypedArrayPrototype, KEY, forced ? property\n      : NATIVE_ARRAY_BUFFER_VIEWS && Int8ArrayPrototype[KEY] || property, options);\n  }\n};\n\nvar exportTypedArrayStaticMethod = function (KEY, property, forced) {\n  var ARRAY, TypedArrayConstructor;\n  if (!DESCRIPTORS) return;\n  if (setPrototypeOf) {\n    if (forced) for (ARRAY in TypedArrayConstructorsList) {\n      TypedArrayConstructor = globalThis[ARRAY];\n      if (TypedArrayConstructor && hasOwn(TypedArrayConstructor, KEY)) try {\n        delete TypedArrayConstructor[KEY];\n      } catch (error) { /* empty */ }\n    }\n    if (!TypedArray[KEY] || forced) {\n      // V8 ~ Chrome 49-50 `%TypedArray%` methods are non-writable non-configurable\n      try {\n        return defineBuiltIn(TypedArray, KEY, forced ? property : NATIVE_ARRAY_BUFFER_VIEWS && TypedArray[KEY] || property);\n      } catch (error) { /* empty */ }\n    } else return;\n  }\n  for (ARRAY in TypedArrayConstructorsList) {\n    TypedArrayConstructor = globalThis[ARRAY];\n    if (TypedArrayConstructor && (!TypedArrayConstructor[KEY] || forced)) {\n      defineBuiltIn(TypedArrayConstructor, KEY, property);\n    }\n  }\n};\n\nfor (NAME in TypedArrayConstructorsList) {\n  Constructor = globalThis[NAME];\n  Prototype = Constructor && Constructor.prototype;\n  if (Prototype) enforceInternalState(Prototype)[TYPED_ARRAY_CONSTRUCTOR] = Constructor;\n  else NATIVE_ARRAY_BUFFER_VIEWS = false;\n}\n\nfor (NAME in BigIntArrayConstructorsList) {\n  Constructor = globalThis[NAME];\n  Prototype = Constructor && Constructor.prototype;\n  if (Prototype) enforceInternalState(Prototype)[TYPED_ARRAY_CONSTRUCTOR] = Constructor;\n}\n\n// WebKit bug - typed arrays constructors prototype is Object.prototype\nif (!NATIVE_ARRAY_BUFFER_VIEWS || !isCallable(TypedArray) || TypedArray === Function.prototype) {\n  // eslint-disable-next-line no-shadow -- safe\n  TypedArray = function TypedArray() {\n    throw new TypeError('Incorrect invocation');\n  };\n  if (NATIVE_ARRAY_BUFFER_VIEWS) for (NAME in TypedArrayConstructorsList) {\n    if (globalThis[NAME]) setPrototypeOf(globalThis[NAME], TypedArray);\n  }\n}\n\nif (!NATIVE_ARRAY_BUFFER_VIEWS || !TypedArrayPrototype || TypedArrayPrototype === ObjectPrototype) {\n  TypedArrayPrototype = TypedArray.prototype;\n  if (NATIVE_ARRAY_BUFFER_VIEWS) for (NAME in TypedArrayConstructorsList) {\n    if (globalThis[NAME]) setPrototypeOf(globalThis[NAME].prototype, TypedArrayPrototype);\n  }\n}\n\n// WebKit bug - one more object in Uint8ClampedArray prototype chain\nif (NATIVE_ARRAY_BUFFER_VIEWS && getPrototypeOf(Uint8ClampedArrayPrototype) !== TypedArrayPrototype) {\n  setPrototypeOf(Uint8ClampedArrayPrototype, TypedArrayPrototype);\n}\n\nif (DESCRIPTORS && !hasOwn(TypedArrayPrototype, TO_STRING_TAG)) {\n  TYPED_ARRAY_TAG_REQUIRED = true;\n  defineBuiltInAccessor(TypedArrayPrototype, TO_STRING_TAG, {\n    configurable: true,\n    get: function () {\n      return isObject(this) ? this[TYPED_ARRAY_TAG] : undefined;\n    }\n  });\n  for (NAME in TypedArrayConstructorsList) if (globalThis[NAME]) {\n    createNonEnumerableProperty(globalThis[NAME], TYPED_ARRAY_TAG, NAME);\n  }\n}\n\nmodule.exports = {\n  NATIVE_ARRAY_BUFFER_VIEWS: NATIVE_ARRAY_BUFFER_VIEWS,\n  TYPED_ARRAY_TAG: TYPED_ARRAY_TAG_REQUIRED && TYPED_ARRAY_TAG,\n  aTypedArray: aTypedArray,\n  aTypedArrayConstructor: aTypedArrayConstructor,\n  exportTypedArrayMethod: exportTypedArrayMethod,\n  exportTypedArrayStaticMethod: exportTypedArrayStaticMethod,\n  getTypedArrayConstructor: getTypedArrayConstructor,\n  isView: isView,\n  isTypedArray: isTypedArray,\n  TypedArray: TypedArray,\n  TypedArrayPrototype: TypedArrayPrototype\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  function F() { /* empty */ }\n  F.prototype.constructor = null;\n  // eslint-disable-next-line es/no-object-getprototypeof -- required for testing\n  return Object.getPrototypeOf(new F()) !== F.prototype;\n});\n","'use strict';\nvar makeBuiltIn = require('../internals/make-built-in');\nvar defineProperty = require('../internals/object-define-property');\n\nmodule.exports = function (target, name, descriptor) {\n  if (descriptor.get) makeBuiltIn(descriptor.get, name, { getter: true });\n  if (descriptor.set) makeBuiltIn(descriptor.set, name, { setter: true });\n  return defineProperty.f(target, name, descriptor);\n};\n","'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\n\nmodule.exports = function (object, key, method) {\n  try {\n    // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\n    return uncurryThis(aCallable(Object.getOwnPropertyDescriptor(object, key)[method]));\n  } catch (error) { /* empty */ }\n};\n","'use strict';\nvar classofRaw = require('../internals/classof-raw');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (fn) {\n  // Nashorn bug:\n  //   https://github.com/zloirock/core-js/issues/1128\n  //   https://github.com/zloirock/core-js/issues/1130\n  if (classofRaw(fn) === 'Function') return uncurryThis(fn);\n};\n","'use strict';\nvar isObject = require('../internals/is-object');\n\nmodule.exports = function (argument) {\n  return isObject(argument) || argument === null;\n};\n","'use strict';\nvar hasOwn = require('../internals/has-own-property');\nvar isCallable = require('../internals/is-callable');\nvar toObject = require('../internals/to-object');\nvar sharedKey = require('../internals/shared-key');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar IE_PROTO = sharedKey('IE_PROTO');\nvar $Object = Object;\nvar ObjectPrototype = $Object.prototype;\n\n// `Object.getPrototypeOf` method\n// https://tc39.es/ecma262/#sec-object.getprototypeof\n// eslint-disable-next-line es/no-object-getprototypeof -- safe\nmodule.exports = CORRECT_PROTOTYPE_GETTER ? $Object.getPrototypeOf : function (O) {\n  var object = toObject(O);\n  if (hasOwn(object, IE_PROTO)) return object[IE_PROTO];\n  var constructor = object.constructor;\n  if (isCallable(constructor) && object instanceof constructor) {\n    return constructor.prototype;\n  } return object instanceof $Object ? ObjectPrototype : null;\n};\n","'use strict';\n/* eslint-disable no-proto -- safe */\nvar uncurryThisAccessor = require('../internals/function-uncurry-this-accessor');\nvar isObject = require('../internals/is-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar aPossiblePrototype = require('../internals/a-possible-prototype');\n\n// `Object.setPrototypeOf` method\n// https://tc39.es/ecma262/#sec-object.setprototypeof\n// Works with __proto__ only. Old v8 can't work with null proto objects.\n// eslint-disable-next-line es/no-object-setprototypeof -- safe\nmodule.exports = Object.setPrototypeOf || ('__proto__' in {} ? function () {\n  var CORRECT_SETTER = false;\n  var test = {};\n  var setter;\n  try {\n    setter = uncurryThisAccessor(Object.prototype, '__proto__', 'set');\n    setter(test, []);\n    CORRECT_SETTER = test instanceof Array;\n  } catch (error) { /* empty */ }\n  return function setPrototypeOf(O, proto) {\n    requireObjectCoercible(O);\n    aPossiblePrototype(proto);\n    if (!isObject(O)) return O;\n    if (CORRECT_SETTER) setter(O, proto);\n    else O.__proto__ = proto;\n    return O;\n  };\n}() : undefined);\n","'use strict';\nvar toPositiveInteger = require('../internals/to-positive-integer');\n\nvar $RangeError = RangeError;\n\nmodule.exports = function (it, BYTES) {\n  var offset = toPositiveInteger(it);\n  if (offset % BYTES) throw new $RangeError('Wrong offset');\n  return offset;\n};\n","'use strict';\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar $RangeError = RangeError;\n\nmodule.exports = function (it) {\n  var result = toIntegerOrInfinity(it);\n  if (result < 0) throw new $RangeError(\"The argument can't be less than 0\");\n  return result;\n};\n","'use strict';\nvar globalThis = require('../internals/global-this');\nvar call = require('../internals/function-call');\nvar ArrayBufferViewCore = require('../internals/array-buffer-view-core');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toOffset = require('../internals/to-offset');\nvar toIndexedObject = require('../internals/to-object');\nvar fails = require('../internals/fails');\n\nvar RangeError = globalThis.RangeError;\nvar Int8Array = globalThis.Int8Array;\nvar Int8ArrayPrototype = Int8Array && Int8Array.prototype;\nvar $set = Int8ArrayPrototype && Int8ArrayPrototype.set;\nvar aTypedArray = ArrayBufferViewCore.aTypedArray;\nvar exportTypedArrayMethod = ArrayBufferViewCore.exportTypedArrayMethod;\n\nvar WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS = !fails(function () {\n  // eslint-disable-next-line es/no-typed-arrays -- required for testing\n  var array = new Uint8ClampedArray(2);\n  call($set, array, { length: 1, 0: 3 }, 1);\n  return array[1] !== 3;\n});\n\n// https://bugs.chromium.org/p/v8/issues/detail?id=11294 and other\nvar TO_OBJECT_BUG = WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS && ArrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS && fails(function () {\n  var array = new Int8Array(2);\n  array.set(1);\n  array.set('2', 1);\n  return array[0] !== 0 || array[1] !== 2;\n});\n\n// `%TypedArray%.prototype.set` method\n// https://tc39.es/ecma262/#sec-%typedarray%.prototype.set\nexportTypedArrayMethod('set', function set(arrayLike /* , offset */) {\n  aTypedArray(this);\n  var offset = toOffset(arguments.length > 1 ? arguments[1] : undefined, 1);\n  var src = toIndexedObject(arrayLike);\n  if (WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS) return call($set, this, src, offset);\n  var length = this.length;\n  var len = lengthOfArrayLike(src);\n  var index = 0;\n  if (len + offset > length) throw new RangeError('Wrong length');\n  while (index < len) this[offset + index] = src[index++];\n}, !WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS || TO_OBJECT_BUG);\n","'use strict';\nvar globalThis = require('../internals/global-this');\nvar uncurryThis = require('../internals/function-uncurry-this-clause');\nvar fails = require('../internals/fails');\nvar aCallable = require('../internals/a-callable');\nvar internalSort = require('../internals/array-sort');\nvar ArrayBufferViewCore = require('../internals/array-buffer-view-core');\nvar FF = require('../internals/environment-ff-version');\nvar IE_OR_EDGE = require('../internals/environment-is-ie-or-edge');\nvar V8 = require('../internals/environment-v8-version');\nvar WEBKIT = require('../internals/environment-webkit-version');\n\nvar aTypedArray = ArrayBufferViewCore.aTypedArray;\nvar exportTypedArrayMethod = ArrayBufferViewCore.exportTypedArrayMethod;\nvar Uint16Array = globalThis.Uint16Array;\nvar nativeSort = Uint16Array && uncurryThis(Uint16Array.prototype.sort);\n\n// WebKit\nvar ACCEPT_INCORRECT_ARGUMENTS = !!nativeSort && !(fails(function () {\n  nativeSort(new Uint16Array(2), null);\n}) && fails(function () {\n  nativeSort(new Uint16Array(2), {});\n}));\n\nvar STABLE_SORT = !!nativeSort && !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 74;\n  if (FF) return FF < 67;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 602;\n\n  var array = new Uint16Array(516);\n  var expected = Array(516);\n  var index, mod;\n\n  for (index = 0; index < 516; index++) {\n    mod = index % 4;\n    array[index] = 515 - index;\n    expected[index] = index - 2 * mod + 3;\n  }\n\n  nativeSort(array, function (a, b) {\n    return (a / 4 | 0) - (b / 4 | 0);\n  });\n\n  for (index = 0; index < 516; index++) {\n    if (array[index] !== expected[index]) return true;\n  }\n});\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (y !== y) return -1;\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (x !== x) return 1;\n    if (x === 0 && y === 0) return 1 / x > 0 && 1 / y < 0 ? 1 : -1;\n    return x > y;\n  };\n};\n\n// `%TypedArray%.prototype.sort` method\n// https://tc39.es/ecma262/#sec-%typedarray%.prototype.sort\nexportTypedArrayMethod('sort', function sort(comparefn) {\n  if (comparefn !== undefined) aCallable(comparefn);\n  if (STABLE_SORT) return nativeSort(this, comparefn);\n\n  return internalSort(aTypedArray(this), getSortCompare(comparefn));\n}, !STABLE_SORT || ACCEPT_INCORRECT_ARGUMENTS);\n"],"names":["Symbol","for","TypstDefaultParams","RenderView","pageInfos","loadPageCount","imageScaleFactor","container","canvasList","textLayerList","commonList","textLayerParentList","semanticLayerList","constructor","options","this","pixelPerPt","PIXEL_PER_PT","innerHTML","style","width","Array","createOver","i","pageAst","commonDiv","Math","ceil","height","canvas","document","createElement","semanticLayer","textLayer","textLayerParent","getContext","canvasDiv","appendChild","position","className","containerWidth","offsetWidth","originalScale","setProperty","classList","add","length","resetLayout","parentElement","Error","currentScale","transformOrigin","transform","LazyWasmModule","wasmBin","initOnce","initFn","fn","res","called","once","async","init","module","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","get","target","prop","receiver","IDBTransaction","objectStoreNames","undefined","objectStore","set","value","has","wrapFunction","func","IDBDatabase","prototype","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","args","apply","unwrap","storeNames","tx","call","sort","transformCachableValue","done","Promise","resolve","reject","unlisten","removeEventListener","complete","error","DOMException","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","c","Proxy","IDBRequest","request","promise","success","result","then","catch","promisifyRequest","newValue","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","storeName","store","index","shift","all","oldTraps","callback","ComponentBuilder","loadedFonts","Set","fetcher","fetch","setFetcher","loadFonts","builder","fonts","escapeImport","Function","fetchBuilder","FileSystemCache","cache","cacheDirectory","cachedFetcher","withCache","input","timeout","setTimeout","console","warn","finally","clearTimeout","fontsToLoad","filter","font","Uint8Array","fontLists","map","arrayBuffer","add_raw_font","build","hooks","buildCtx","ref","beforeBuild","latelyBuild","PreviewMode","TypstDocumentContext","hookedElem","kModule","opts","modes","partialRendering","renderMode","r","previewMode","Doc","isContentPreview","isMixinOutline","backgroundColor","pageColor","retrieveDOMState","isRendering","moduleInitialized","patchQueue","disposeList","canvasRenderCToken","currentRealScale","currentScaleRatio","vpTimeout","sampledRenderTime","partialRenderPage","outline","cursorPosition","cachedDOMState","window","innerWidth","innerHeight","boundingRect","left","top","right","offsetHeight","getBoundingClientRect","getComputedStyle","documentElement","getPropertyValue","Slide","installCtrlWheelHandler","reset","dispose","forEach","x","derive","ctx","mode","reduce","acc","bind","assert","registerMode","facade","push","factors","wheelEventHandler","event","ctrlKey","preventDefault","onresize","prevScaleRatio","deltaY","at","scrollFactor","scrollX","pageX","scrollY","pageY","abs","remove","svg","firstElementChild","scaleRatio","getSvgScaleRatio","dataHeight","Number","parseFloat","getAttribute","scaledHeight","scrollBy","addViewportChange","acquireVsCodeApi","passive","body","svgWidth","svgHeight","min","processQueue","svgUpdateEvent","eventName","manipulateData","action","data","log","triggerUpdate","doUpdate","postprocessChanges","t0","performance","now","ctoken","cancel","wait","needRerender","t1","rescale","rerender","t2","d","e","y","toFixed","join","requestAnimationFrame","postRender","querySelectorAll","textContent","retrievePagesInfo","addChangement","change","splice","pushChange","TypstCancellationToken","isCancellationRequested","_onCancelled","_onCancelledResolveResolved","resolveT","resolveX","isCancelRequested","consume","TrackMode","RepaintStage","ManageStatus","provideDomDoc","Base","tmpl","stub","plugin","docKernel","resourceHeader","pages","domScale","track_mode","current_task","viewport","super","renderer","page","free","content","mountDom","querySelector","mount_dom","bind_functions","populateGlyphs","append","cancelAnyway$dom","task","retrieveDOMPages","from","postRender$dom","rescale$dom","getDomViewport","cachedWindow","cachedBoundingRect","bottom","rect","max","rerender$dom","domState","relayout","doRender$dom","browserBBox","inWindow","renderPage","Layout","v","needCalc","stage","need_repaint","repaint","calc","needFrame","cb","condOrExit","wScale","hScale","Svg","Semantics","PrepareCanvas","Canvas","calcCanvasAfterPreparing","renderPages","idx","TypstDomDocument","impl","setPageColor","color","setPartialRendering","setCursor","setPartialPageNumber","getPartialPageNumber","setOutineData","provideDoc","mixins","mixin","composeDoc","RenderSession","o","t","background_color","pixel_per_pt","resetSession","doc_width","docWidth","doc_height","docHeight","pages_info","pageCount","page_count","pageOffset","page_off","width_pt","height_pt","getSourceLoc","path","source_span","renderSvg","renderSession","renderToSvg","renderCanvas","renderSvgDiff","get_source_loc","render_in_window","rect_lo_x","rect_lo_y","rect_hi_x","rect_hi_y","merge_delta","TypstWorker","manipulate_data","managedCanvasElemList","canvasCounter","random","canvasElemList","m","_","elem","Delete","elemId","dataset","manageId","Update","New","prev","entries","actions","elements","key","delete","canvasOptionsToRust","render_canvas","get_pages_info","warnOnceCanvasSet","TypstRendererDriver","rendererJs","getWrapper","TypstRendererBuilder","gModule","Builder","getModule","bin","default","loadGlyphPack","_pack","createOptionsToRust","rustOptions","CreateSessionOptions","format","artifactContent","artifact_content","RenderPageImageOptions","cacheKey","cache_key","dataSelection","encoded","text","annotation","semantics","data_selection","retrievePagesInfoFromSession","session","withinOptionSession","sessionRef","render_page_to_canvas","inAnimationFrame","renderDisplayLayer","doRender","textContentList","results","renderTextLayer","layerList","textSourceList","layer","htmlSemantics","t3","render","renderToCanvas","renderDom","renderPageResults","mountContainer","visibility","doRenderDisplayLayer","test","pageView","createModule","b","create_session","createWorkerV0","worker","create_worker","workerBridge","create_worker_bridge","parts","defs","css","js","svg_data","render_svg_diff","lo","hi","render_svg","getCustomV1","get_customs","isRenderByContentOption","runWithSession","arg1","arg2","TypstDocument","_ref","artifact","permission","setPermissionInternal","useState","setPermissionAndOk","status","state","useEffect","navigator","permissions","query","name","displayDivRef","useRef","tsModule","artifactData","ses","current","dom","React","Head","_ref2","post","Seo","title","frontmatter","description","excerpt","_site$siteMetadata","previous","next","site","location","siteTitle","siteMetadata","setArtifactData","source","response","byteLength","itemScope","itemType","itemProp","date","Bio","display","flexWrap","justifyContent","listStyle","padding","Link","to","slug","rel","isPossiblePrototype","$String","String","$TypeError","TypeError","exports","argument","ArrayBuffer","DataView","NAME","Constructor","Prototype","NATIVE_ARRAY_BUFFER","DESCRIPTORS","globalThis","isCallable","isObject","hasOwn","classof","tryToString","createNonEnumerableProperty","defineBuiltIn","defineBuiltInAccessor","isPrototypeOf","getPrototypeOf","setPrototypeOf","wellKnownSymbol","uid","InternalStateModule","enforceInternalState","enforce","getInternalState","Int8Array","Int8ArrayPrototype","Uint8ClampedArray","Uint8ClampedArrayPrototype","TypedArray","TypedArrayPrototype","ObjectPrototype","Object","TO_STRING_TAG","TYPED_ARRAY_TAG","TYPED_ARRAY_CONSTRUCTOR","NATIVE_ARRAY_BUFFER_VIEWS","opera","TYPED_ARRAY_TAG_REQUIRED","TypedArrayConstructorsList","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigIntArrayConstructorsList","BigInt64Array","BigUint64Array","getTypedArrayConstructor","it","proto","isTypedArray","klass","configurable","aTypedArray","aTypedArrayConstructor","C","exportTypedArrayMethod","KEY","property","forced","ARRAY","TypedArrayConstructor","error2","exportTypedArrayStaticMethod","isView","fails","F","makeBuiltIn","defineProperty","descriptor","getter","setter","f","uncurryThis","aCallable","getOwnPropertyDescriptor","classofRaw","toObject","sharedKey","CORRECT_PROTOTYPE_GETTER","IE_PROTO","$Object","O","uncurryThisAccessor","requireObjectCoercible","aPossiblePrototype","CORRECT_SETTER","__proto__","toPositiveInteger","$RangeError","RangeError","BYTES","offset","toIntegerOrInfinity","ArrayBufferViewCore","lengthOfArrayLike","toOffset","toIndexedObject","$set","WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS","array","TO_OBJECT_BUG","arrayLike","arguments","src","len","internalSort","FF","IE_OR_EDGE","V8","WEBKIT","nativeSort","ACCEPT_INCORRECT_ARGUMENTS","STABLE_SORT","mod","expected","a","comparefn","getSortCompare"],"sourceRoot":""}