"use strict";(self.webpackChunkgatsby_starter_blog=self.webpackChunkgatsby_starter_blog||[]).push([[28],{1984:function(e,t,r){r.r(t),r.d(t,{Head:function(){return q},default:function(){return N}});var n=r(6540),i=r(8693),o=r(4967),s=r(9259),a=r(7528);r(8845),r(373);Symbol("beforeBuild");const c=Symbol.for("reflexo-obj");var d;!function(e){e[e.PIXEL_PER_PT=3]="PIXEL_PER_PT"}(d=d||(d={}));class l{pageInfos;loadPageCount;imageScaleFactor;container;canvasList;textLayerList;commonList;textLayerParentList;semanticLayerList;constructor(e,t,r){this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??d.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const n=(e,r,n)=>{const i=Math.ceil(r.width)*this.imageScaleFactor,o=Math.ceil(r.height)*this.imageScaleFactor,s=this.canvasList[e]=document.createElement("canvas"),a=this.semanticLayerList[e]=document.createElement("div"),c=this.textLayerList[e]=document.createElement("div"),d=this.textLayerParentList[e]=document.createElement("div");if(s.getContext("2d")){const e=document.createElement("div");s.width=i,s.height=o,e.appendChild(s),n.appendChild(e),e.style.position="absolute"}{d.appendChild(c),d.className="typst-html-semantics";const e=t.offsetWidth,i=e/r.width;d.style.width=`${e}px`,d.style.height=r.height*i+"px",d.style.setProperty("--data-text-width",`${i}px`),d.style.setProperty("--data-text-height",`${i}px`),n.classList.add("typst-page"),n.classList.add("canvas"),n.style.width=`${e}px`,n.style.height=o*i+"px",n.style.position="relative",a.appendChild(d),n.appendChild(a)}};for(let i=0;i<this.pageInfos.length;i++){const e=this.pageInfos[i];let r;r=this.commonList[i]=document.createElement("div"),t.appendChild(r),n(i,e,r)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,n=Math.ceil(t.height)*this.imageScaleFactor,i=this.canvasList[e].parentElement;if(!i)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const o=this.commonList[e],s=this.textLayerParentList[e],a=this.container.offsetWidth,c=a/r;s.style.width=`${a}px`,s.style.height=n*c+"px",o.style.width=`${a}px`,o.style.height=n*c+"px";const d=this.container.offsetWidth/r;i.style.transformOrigin="0px 0px",i.style.transform=`scale(${d})`}}}class h{wasmBin;initOnce;constructor(e){if("function"!=typeof e)throw new Error("initFn is not a function");this.initOnce=(e=>{let t,r=!1;return()=>r?t:(r=!0,t=e())})((async()=>{await e(this.wasmBin)}))}async init(e){this.wasmBin=e,await this.initOnce()}}let u,p;const f=new WeakMap,g=new WeakMap,m=new WeakMap,w=new WeakMap,y=new WeakMap;let v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return g.get(e);if("objectStoreNames"===t)return e.objectStoreNames||m.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return C(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function S(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(p||(p=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(_(this),t),C(f.get(this))}:function(...t){return C(e.apply(_(this),t))}:function(t,...r){const n=e.call(_(this),t,...r);return m.set(n,t.sort?t.sort():[t]),C(n)}}function E(e){return"function"==typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(g.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));g.set(e,t)}(e),t=e,(u||(u=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,v):e);var t}function C(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(C(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&f.set(t,e)})).catch((()=>{})),y.set(t,e),t}(e);if(w.has(e))return w.get(e);const t=E(e);return t!==e&&(w.set(e,t),y.set(t,e)),t}const _=e=>y.get(e);const b=["get","getKey","getAll","getAllKeys","count"],P=["put","add","delete","clear"],x=new Map;function R(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(x.get(t))return x.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=P.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!b.includes(r))return;const o=async function(e,...t){const o=this.transaction(e,i?"readwrite":"readonly");let s=o.store;return n&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),i&&o.done]))[0]};return x.set(t,o),o}v=(e=>({...e,get:(t,r,n)=>R(t,r)||e.get(t,r,n),has:(t,r)=>!!R(t,r)||e.has(t,r)}))(v);class L{loadedFonts=new Set;fetcher=fetch;setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),n=this.fetcher||=await async function(){const{fetchBuilder:e,FileSystemCache:t}=await r("node-fetch-cache"),n=new t({cacheDirectory:".cache/typst/fonts"}),i=e.withCache(n);return function(e,t){const r=setTimeout((()=>{console.warn("font fetching is stucking:",e)}),15e3);return i(e,t).finally((()=>{clearTimeout(r)}))}}(),i=t.filter((e=>e instanceof Uint8Array||!this.loadedFonts.has(e)&&(this.loadedFonts.add(e),!0))),o=await Promise.all(i.map((async t=>{if(!(t instanceof Uint8Array))return new Uint8Array(await(await n(t)).arrayBuffer());await e.add_raw_font(t)})));for(const s of o)s&&await e.add_raw_font(s)}async build(e,t,r){const n={ref:this,builder:t,hooks:r};for(const i of e?.beforeBuild??[])await i(void 0,n);r.latelyBuild&&r.latelyBuild(n);return await t.build()}}var A;!function(e){e[e.Doc=0]="Doc",e[e.Slide=1]="Slide"}(A=A||(A={}));class k{hookedElem;kModule;opts;modes=[];partialRendering=!0;renderMode="svg";r=void 0;previewMode=A.Doc;isContentPreview=!1;isMixinOutline=!1;backgroundColor="black";pageColor="white";pixelPerPt=3;retrieveDOMState;isRendering=!1;moduleInitialized=!1;patchQueue=[];disposeList=[];canvasRenderCToken;currentRealScale=1;currentScaleRatio=1;vpTimeout=void 0;sampledRenderTime=0;partialRenderPage=0;outline=void 0;cursorPosition=void 0;cachedDOMState={width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}};constructor(e){this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:t,previewMode:r,isContentPreview:n,retrieveDOMState:i}=e||{};this.partialRendering=!1,this.renderMode=t??this.renderMode,this.previewMode=r??this.previewMode,this.isContentPreview=n||!1,this.retrieveDOMState=i??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-x"),this.previewMode===A.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach((e=>e()))}static derive(e,t){return["rescale","rerender","postRender"].reduce(((r,n)=>(r[n]=e[`${n}$${t}`].bind(e),console.assert(void 0!==r[n],`${n}$${t} is undefined`),r)),{})}registerMode(e){const t=k.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=t=>{if(t.ctrlKey){t.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),null!==window.onresize&&(window.onresize=null);const r=this.currentScaleRatio;if(t.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter((e=>e>this.currentScaleRatio)).at(0)}else{if(!(t.deltaY>0))return;if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter((e=>e<this.currentScaleRatio)).at(-1)}const n=this.currentScaleRatio/r,i=t.pageX*(n-1),o=t.pageY*(n-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-x"),this.previewMode===A.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.remove("hide-scrollbar-x"),this.previewMode===A.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.remove("hide-scrollbar-y")));const s=this.hookedElem.firstElementChild;if(s){const e=this.getSvgScaleRatio(),t=Number.parseFloat(s.getAttribute("data-height")),r=Math.ceil(t*e);this.hookedElem.style.height=2*r+"px"}return window.scrollBy(i,o),this.addViewportChange(),!1}};if("dom"!==this.renderMode){"undefined"!=typeof acquireVsCodeApi?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push((()=>{window.removeEventListener("wheel",t)}))):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push((()=>{document.body.removeEventListener("wheel",t)})))}}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),n=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===A.Slide?Math.min(t.width/r,t.height/n):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return"new"===t&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return!!this.moduleInitialized||(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),0===this.patchQueue.length)return this.isRendering=!1,void this.postprocessChanges();try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let n=!1;for(;this.patchQueue.length>0;)n=this.processQueue(this.patchQueue.shift())||n;let i=performance.now();n&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let o=performance.now();const s=(e,t,r)=>`${e} ${(r-t).toFixed(2)} ms`;this.sampledRenderTime=o-t,console.log([s("parse",t,i),s("rerender",i,o),s("total",t,o)].join(", ")),requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===A.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach((e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`}))}addChangement(e){"new"===e[0]&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};void 0!==this.vpTimeout&&clearTimeout(this.vpTimeout),"viewport-change"===e[0]&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}}class M{isCancellationRequested=!1;_onCancelled;_onCancelledResolveResolved;constructor(){let e,t;this._onCancelled=new Promise((r=>{e=r,t&&t(r)})),this._onCancelledResolveResolved=new Promise((r=>{t=r,e&&r(e)}))}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}var D,T,I;function O(e){return class extends e{tmpl=document.createElement("template");stub=this.createElement("<stub></stub>");plugin;docKernel;resourceHeader=void 0;pages=[];domScale=1;track_mode=D.Doc;current_task=void 0;viewport;constructor(...e){if(super(...e),this.registerMode("dom"),this.disposeList.push((()=>{this.dispose()})),this.plugin=this.opts.renderer,void 0!==this.opts.domScale){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const e of this.pages)e.dispose();this.docKernel&&this.docKernel.free()}createElement(e){return this.tmpl.innerHTML=e,this.tmpl.content.firstElementChild}async mountDom(e){if(console.log("mountDom",e),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[c],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:e=>{let t=this.createElement(e);console.log("populateGlyphs",t);let r=t.firstElementChild;this.resourceHeader.append(r)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){const e=this.current_task;this.current_task=void 0,await e.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(e,t){const r=t.left,n=-t.top,i=t.right,o=e.innerHeight-t.top,s={x:0,y:n/this.domScale,width:Math.max(i-r,0)/this.domScale,height:Math.max(o-n,0)/this.domScale};return(s.width<=0||s.height<=0)&&(s.x=s.y=s.width=s.height=0),s}async rerender$dom(){const e=this.retrieveDOMState(),{x:t,y:r,width:n,height:i}=this.getDomViewport(e.window,e.boundingRect);if(!await this.docKernel.relayout(t,r,n,i))return;const o=new M;this.doRender$dom(o),this.current_task=o}async doRender$dom(e){const t=this.retrieveDOMPages().map((e=>{const{innerWidth:t,innerHeight:r}=window,n=e.getBoundingClientRect();return{inWindow:!(n.left>t||n.right<0||n.top>r||n.bottom<0),page:e}})),r=async r=>{if(await new Promise((e=>requestAnimationFrame(e))),e.isCancelRequested())return void console.log("cancel stage",T.Layout,r);const n=t[r].page,i=n.getBoundingClientRect(),o=this.getDomViewport(window,i),s=e=>this.docKernel.need_repaint(r,o.x,o.y,o.width,o.height,e),a=e=>this.docKernel.repaint(r,o.x,o.y,o.width,o.height,e),c=t=>{if(!e.isCancelRequested())return((t,r)=>{if(t&&!e.isCancelRequested()&&r)return r()})(s(t),(()=>a(t)))};await c(T.Layout);const d=(i.width?Number.parseFloat(n.getAttribute("data-width"))/i.width:1)*this.domScale,l=(i.height?Number.parseFloat(n.getAttribute("data-height"))/i.height:1)*this.domScale;if(o.x*=d,o.y*=l,o.y-=100,o.width*=d,o.height*=l,o.height+=200,await c(T.Svg),await c(T.Semantics),e.isCancelRequested())console.log("cancel stage",T.Semantics,r);else if(s(T.PrepareCanvas)){(async()=>{if(await a(T.PrepareCanvas),!e.isCancelRequested())return c(T.Canvas)})()}else await c(T.Canvas)},n=async n=>{for(let i=0;i<t.length;++i){if(e.isCancelRequested())return void console.log("cancel page",T.Layout,i);t[i].inWindow===n&&await r(i)}};this.cancelAnyway$dom(),await n(!0),await n(!1),e.isCancelRequested()||console.log("finished",T.Layout)}}}!function(e){e[e.Doc=0]="Doc",e[e.Pages=1]="Pages"}(D||(D={})),function(e){e[e.Layout=0]="Layout",e[e.Svg=1]="Svg",e[e.Semantics=2]="Semantics",e[e.PrepareCanvas=3]="PrepareCanvas",e[e.Canvas=4]="Canvas"}(T||(T={}));class B extends(function(e){return class{impl;kModule;constructor(t){if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new e(t),!this.impl.r)throw new Error(`mode is not supported, ${t?.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(e){this.impl.addChangement(e)}addViewportChange(){this.impl.addViewportChange()}setPageColor(e){this.impl.pageColor=e,this.addViewportChange()}setPartialRendering(e){this.impl.partialRendering=e}setCursor(e,t,r){this.impl.cursorPosition=[e,t,r]}setPartialPageNumber(e){return!(e<=0||e>this.kModule.retrievePagesInfo().length)&&(this.impl.partialRenderPage=e-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(e){this.impl.outline=e,this.addViewportChange()}}}(function(e,...t){return t.reduce(((e,t)=>t(e)),e)}(k,O))){}class F{plugin;[c];constructor(e,t){this.plugin=e,this[c]=t}set backgroundColor(e){void 0!==e&&(this[c].background_color=e)}get backgroundColor(){return this[c].background_color}set pixelPerPt(e){void 0!==e&&(this[c].pixel_per_pt=e)}get pixelPerPt(){return this[c].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[c].doc_width}get docWidth(){return this[c].doc_width}get doc_height(){return this[c].doc_height}get docHeight(){return this[c].doc_height}retrievePagesInfo(){const e=this[c].pages_info,t=[],r=e.page_count;for(let n=0;n<r;n++){const r=e.page(n);t.push({pageOffset:r.page_off,width:r.width_pt,height:r.height_pt})}return t}getSourceLoc(e){return this[c].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[c].source_span(e)}render_in_window(e,t,r,n){return this[c].render_in_window(e,t,r,n)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}}!function(e){e[e.Delete=0]="Delete",e[e.New=1]="New",e[e.Update=2]="Update"}(I||(I={}));class ${plugin;[c];constructor(e,t){this.plugin=e,this[c]=t}manipulateData(e,t){return this[c].manipulate_data(e,t)}managedCanvasElemList=new Map;canvasCounter=Math.random();renderCanvas(e){const t=this.managedCanvasElemList;for(const[s,a]of t)a[0]=I.Delete;for(const s of e){const e=s.canvas;let r=e.dataset.manageId,n=I.Update;r||(r=this.canvasCounter.toFixed(5),this.canvasCounter+=1,e.dataset.manageId=r,n=I.New);let i=t.get(r);if(i&&i[0]!==I.Delete)throw new Error("cannot update a canvas for two times in batch");t.set(r,[n,{...s}])}const r=Array.from(t.entries()),n=new Uint8Array(r.length),i=new Array(r.length),o=r.map((([e,[r,o]],s)=>(r||t.delete(e),n[s]=r,i[s]=o.canvas,this.plugin.canvasOptionsToRust(o))));return this[c].render_canvas(n,i,o)}async retrievePagesInfo(){const e=await this[c].get_pages_info();console.log(e);const t=[],r=e.page_count;for(let n=0;n<r;n++){const r=e.page(n);t.push({pageOffset:r.page_off,width:r.width_pt,height:r.height_pt})}return t}}let W=!0;class V{renderer;rendererJs;constructor(){}async init(e){this.rendererJs=await(e?.getWrapper?.()||r.e(990).then(r.bind(r,9990)));const t=this.rendererJs.TypstRendererBuilder;var n;this.renderer=await async function(e,t,r,n){return await t.init(e?.getModule?.()),await(new L).build(e,new r,n)}(e,(n=this.rendererJs,new h((async e=>await n.default(e)))),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return void 0!==e.format&&(t.format=e.format),void 0!==e.artifactContent&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){const t=new this.rendererJs.RenderPageImageOptions;if(void 0===e.pageOffset)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,void 0!==e.cacheKey&&(t.cache_key=e.cacheKey),void 0!==e.backgroundColor&&(t.background_color=e.backgroundColor),void 0!==e.pixelPerPt&&(t.pixel_per_pt=e.pixelPerPt),void 0!==e.dataSelection){let r=0;e.dataSelection.body?r|=1:e.canvas&&W&&(W=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=8),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,(async t=>this.renderer.render_page_to_canvas(t[c],e.canvas||void 0,this.canvasOptionsToRust(e))))}async inAnimationFrame(e){return new Promise(((t,r)=>{requestAnimationFrame((()=>{try{t(e())}catch(n){r(n)}}))}))}async renderDisplayLayer(e,t,r){const n=e[c].pages_info.page_count,i=async(n,i)=>{const o=t[n].getContext("2d");if(!o)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:o,renderSession:e,pageOffset:i})},o=performance.now(),s=await(async()=>{const e=[];for(let t=0;t<n;t++)e.push(await this.inAnimationFrame((()=>i(t,t))));return e})(),a=performance.now();return console.log(`display layer used: render = ${(a-o).toFixed(1)}ms`),s}renderTextLayer(e,t){const r=performance.now();e.forEach(((e,r)=>{e.innerHTML=t[r].htmlSemantics[0]}));const n=performance.now();console.log(`text layer used: render = ${(n-r).toFixed(1)}ms`)}async render(e){if("format"in e&&"vector"!==e.format){if(["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`)}return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&"vector"!==e.format){if(["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`)}return this.withinOptionSession(e,(async t=>{const r=new B({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r}))}async renderToCanvas(e){let t,r;const n=e.container;n.style.visibility="hidden";const i=async(i,o)=>{try{r=await this.renderDisplayLayer(t,i,e),o()}finally{n.style.visibility="visible"}};return this.withinOptionSession(e,(async o=>{if(t=o,0===t[c].pages_info.page_count)throw new Error("No page found in session");if(void 0!==e.pixelPerPt&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let s=e.backgroundColor;if(void 0!==s&&!/^#[0-9a-f]{6}$/.test(s))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+s);t.pixelPerPt=e.pixelPerPt??d.PIXEL_PER_PT,t.backgroundColor=s??"#ffffff";const a=performance.now(),h=new l(this.retrievePagesInfoFromSession(t),n,e),u=performance.now();console.log(`layer used: retrieve = ${(u-a).toFixed(1)}ms`),await i(h.canvasList,(()=>h.resetLayout())),this.renderTextLayer(h.textLayerList,r)}))}createModule(e){return Promise.resolve(new F(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new $(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof F||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,(async t=>{let r;return e.data_selection&&(r=0,e.data_selection.body&&(r|=1),e.data_selection.defs&&(r|=2),e.data_selection.css&&(r|=4),e.data_selection.js&&(r|=8)),Promise.resolve(this.renderer.svg_data(t[c],r))}))}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[c],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[c],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,(async t=>Promise.resolve(this.renderer.render_svg(t[c],e.container))))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[c]))}resetSession(e){return this.renderer.reset(e[c])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[c],e.action??"reset",e.data)}withinOptionSession(e,t){if("renderSession"in e)return t(e.renderSession);if(function(e){return"artifactContent"in e}(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,n=t;t||(r=void 0,n=e);const i=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const e=await n(new F(this,i));return i.free(),e}catch(o){throw i.free(),o}}}new h((async e=>{const t=await r.e(349).then(r.bind(r,2349));return await t.default(e)}));const j=e=>{let{artifact:t,domScale:r}=e;const{0:i,1:o}=(0,n.useState)(!1),s=e=>"granted"===e.state?(o(!0),!0):(o(!1),!1);(0,n.useEffect)((()=>{navigator.permissions.query({name:"local-fonts"}).then((e=>{if(s(e))return!1;e.addEventListener("change",(t=>{console.log(t,e),s(e)}))}))}));const a=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(!t)return;let e=new V;console.log(e);const n=fetch("/typst/typst_ts_renderer_bg.wasm");e.init({getModule:()=>n}).then((()=>new Uint8Array(t))).then((t=>new Promise((n=>{e.runWithSession((n=>new Promise((i=>{const o=performance.now();e.renderDom({renderSession:n,container:a.current,pixelPerPt:4.5,domScale:null!=r?r:1}).then((e=>{console.log(e),e.addChangement(["new",t]),console.log("render time",performance.now()-o),window.addEventListener("resize",(()=>e.addViewportChange())),window.addEventListener("scroll",(()=>e.addViewportChange()))}))}))))}))))}),[a,t]),n.createElement("div",null,n.createElement("div",{className:"typst-app",ref:a}))},q=e=>{let{data:{post:t}}=e;return n.createElement(a.A,{title:t.frontmatter.title,description:t.frontmatter.description||t.excerpt})};var N=e=>{var t;let{data:{previous:r,next:a,site:c,post:d},location:l}=e;const h=(null===(t=c.siteMetadata)||void 0===t?void 0:t.title)||"Title",[u,p]=n.useState(void 0);return n.useEffect((()=>{fetch(d.source.artifact).then((e=>e.arrayBuffer())).then((e=>{console.log("fetch got artifact data with length",e.byteLength),p(e)}))}),[d]),n.createElement(s.A,{location:l,title:h},n.createElement("article",{className:"blog-post",itemScope:!0,itemType:"http://schema.org/Article"},n.createElement("header",null,n.createElement("h1",{itemProp:"headline"},d.frontmatter.title),n.createElement("p",null,d.frontmatter.date)),n.createElement("section",{itemProp:"articleBody"},n.createElement(j,{artifact:u,domScale:1.17})),n.createElement("hr",null),n.createElement("footer",null,n.createElement(o.A,null))),n.createElement("nav",{className:"blog-post-nav"},n.createElement("ul",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",listStyle:"none",padding:0}},n.createElement("li",null,r&&n.createElement(i.Link,{to:r.slug,rel:"prev"},"← ",r.frontmatter.title)),n.createElement("li",null,a&&n.createElement(i.Link,{to:a.slug,rel:"next"},a.frontmatter.title," →")))))}},3506:function(e,t,r){var n=r(3925),i=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o("Can't set "+i(e)+" as a prototype")}},7811:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},4644:function(e,t,r){var n,i,o,s=r(7811),a=r(3724),c=r(4576),d=r(4901),l=r(34),h=r(9297),u=r(6955),p=r(6823),f=r(6699),g=r(6840),m=r(2106),w=r(1625),y=r(2787),v=r(2967),S=r(8227),E=r(3392),C=r(1181),_=C.enforce,b=C.get,P=c.Int8Array,x=P&&P.prototype,R=c.Uint8ClampedArray,L=R&&R.prototype,A=P&&y(P),k=x&&y(x),M=Object.prototype,D=c.TypeError,T=S("toStringTag"),I=E("TYPED_ARRAY_TAG"),O="TypedArrayConstructor",B=s&&!!v&&"Opera"!==u(c.opera),F=!1,$={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},W={BigInt64Array:8,BigUint64Array:8},V=function(e){var t=y(e);if(l(t)){var r=b(t);return r&&h(r,O)?r[O]:V(t)}},j=function(e){if(!l(e))return!1;var t=u(e);return h($,t)||h(W,t)};for(n in $)(o=(i=c[n])&&i.prototype)?_(o)[O]=i:B=!1;for(n in W)(o=(i=c[n])&&i.prototype)&&(_(o)[O]=i);if((!B||!d(A)||A===Function.prototype)&&(A=function(){throw new D("Incorrect invocation")},B))for(n in $)c[n]&&v(c[n],A);if((!B||!k||k===M)&&(k=A.prototype,B))for(n in $)c[n]&&v(c[n].prototype,k);if(B&&y(L)!==k&&v(L,k),a&&!h(k,T))for(n in F=!0,m(k,T,{configurable:!0,get:function(){return l(this)?this[I]:void 0}}),$)c[n]&&f(c[n],I,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:B,TYPED_ARRAY_TAG:F&&I,aTypedArray:function(e){if(j(e))return e;throw new D("Target is not a typed array")},aTypedArrayConstructor:function(e){if(d(e)&&(!v||w(A,e)))return e;throw new D(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(a){if(r)for(var i in $){var o=c[i];if(o&&h(o.prototype,e))try{delete o.prototype[e]}catch(s){try{o.prototype[e]=t}catch(d){}}}k[e]&&!r||g(k,e,r?t:B&&x[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(a){if(v){if(r)for(n in $)if((i=c[n])&&h(i,e))try{delete i[e]}catch(o){}if(A[e]&&!r)return;try{return g(A,e,r?t:B&&A[e]||t)}catch(o){}}for(n in $)!(i=c[n])||i[e]&&!r||g(i,e,t)}},getTypedArrayConstructor:V,isView:function(e){if(!l(e))return!1;var t=u(e);return"DataView"===t||h($,t)||h(W,t)},isTypedArray:j,TypedArray:A,TypedArrayPrototype:k}},2211:function(e,t,r){var n=r(9039);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},2106:function(e,t,r){var n=r(283),i=r(4913);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),i.f(e,t,r)}},6706:function(e,t,r){var n=r(9504),i=r(9306);e.exports=function(e,t,r){try{return n(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(o){}}},7476:function(e,t,r){var n=r(2195),i=r(9504);e.exports=function(e){if("Function"===n(e))return i(e)}},3925:function(e,t,r){var n=r(34);e.exports=function(e){return n(e)||null===e}},2787:function(e,t,r){var n=r(9297),i=r(4901),o=r(8981),s=r(6119),a=r(2211),c=s("IE_PROTO"),d=Object,l=d.prototype;e.exports=a?d.getPrototypeOf:function(e){var t=o(e);if(n(t,c))return t[c];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof d?l:null}},2967:function(e,t,r){var n=r(6706),i=r(34),o=r(7750),s=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(a){}return function(r,n){return o(r),s(n),i(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},8229:function(e,t,r){var n=r(9590),i=RangeError;e.exports=function(e,t){var r=n(e);if(r%t)throw new i("Wrong offset");return r}},9590:function(e,t,r){var n=r(1291),i=RangeError;e.exports=function(e){var t=n(e);if(t<0)throw new i("The argument can't be less than 0");return t}},8845:function(e,t,r){var n=r(4576),i=r(9565),o=r(4644),s=r(6198),a=r(8229),c=r(8981),d=r(9039),l=n.RangeError,h=n.Int8Array,u=h&&h.prototype,p=u&&u.set,f=o.aTypedArray,g=o.exportTypedArrayMethod,m=!d((function(){var e=new Uint8ClampedArray(2);return i(p,e,{length:1,0:3},1),3!==e[1]})),w=m&&o.NATIVE_ARRAY_BUFFER_VIEWS&&d((function(){var e=new h(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));g("set",(function(e){f(this);var t=a(arguments.length>1?arguments[1]:void 0,1),r=c(e);if(m)return i(p,this,r,t);var n=this.length,o=s(r),d=0;if(o+t>n)throw new l("Wrong length");for(;d<o;)this[t+d]=r[d++]}),!m||w)},373:function(e,t,r){var n=r(4576),i=r(7476),o=r(9039),s=r(9306),a=r(4488),c=r(4644),d=r(3709),l=r(3763),h=r(9519),u=r(3607),p=c.aTypedArray,f=c.exportTypedArrayMethod,g=n.Uint16Array,m=g&&i(g.prototype.sort),w=!(!m||o((function(){m(new g(2),null)}))&&o((function(){m(new g(2),{})}))),y=!!m&&!o((function(){if(h)return h<74;if(d)return d<67;if(l)return!0;if(u)return u<602;var e,t,r=new g(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(m(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));f("sort",(function(e){return void 0!==e&&s(e),y?m(this,e):a(p(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!y||w)}}]);
//# sourceMappingURL=component---src-templates-blog-post-typst-js-5f04fc921a60d52120c5.js.map